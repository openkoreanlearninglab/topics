<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKorean - 무슨 요일이야?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&family=Jua&family=Noto+Sans+KR:wght@400;500;700;900&family=Sunflower:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        html{font-size:clamp(12px,1.1vw,16px)}@font-face{font-family:'NoonnuBasicGothic';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noon-2410@1.0/NoonnuBasicGothicRegular.woff2') format('woff2');font-weight:normal;font-display:swap}body{font-family:'NoonnuBasicGothic',sans-serif;background-color:#f9fafb;color:#334155}.font-basic{font-family:'NoonnuBasicGothic',sans-serif}.font-jua{font-family:'Jua',sans-serif}.font-noto{font-family:'Noto Sans KR',sans-serif}.font-sunflower{font-family:'Sunflower',sans-serif}@font-face{font-family:'Cafe24SurroundAir';src:url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24SsurroundAir.woff') format('woff');font-weight:normal;font-display:swap}.font-cafe24{font-family:'Cafe24SurroundAir',sans-serif}@font-face{font-family:'Cafe24Surround';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24Ssurround.woff') format('woff');font-weight:normal;font-display:swap}.font-cafe24-surround{font-family:'Cafe24Surround',sans-serif}@font-face{font-family:'Cafe24Decoshadow';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoshadow.woff2') format('woff2');font-weight:normal;font-display:swap}.font-cafe24-deco{font-family:'Cafe24Decoshadow',sans-serif}@font-face{font-family:'Cafe24Decoschool';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoschool.woff2') format('woff2');font-weight:normal;font-display:swap}.font-cafe24-school{font-family:'Cafe24Decoschool',sans-serif}@font-face{font-family:'Cafe24Anemone';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/Cafe24Ohsquare.woff') format('woff');font-weight:normal;font-display:swap}.font-cafe24-anemone{font-family:'Cafe24Anemone',sans-serif}@font-face{font-family:'SchoolSafetyRoundedSmile';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-R.woff2') format('woff2');font-weight:normal;font-display:swap}@font-face{font-family:'SchoolSafetyRoundedSmile';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-B.woff2') format('woff2');font-weight:700;font-display:swap}.font-school-smile{font-family:'SchoolSafetyRoundedSmile',sans-serif}@font-face{font-family:'Juache';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');font-weight:normal;font-display:swap}.font-juache{font-family:'Juache',sans-serif}@font-face{font-family:'SchoolSafetyFreeTime';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2508-2@1.0/HakgyoansimJayusiganR.woff2') format('woff2');font-weight:normal;font-style:normal}.font-school-free{font-family:'SchoolSafetyFreeTime',sans-serif}::-webkit-scrollbar{width:0.375rem;height:0.375rem}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:0.1875rem}::-webkit-scrollbar-thumb:hover{background:#94a3b8}@keyframes fadeIn{from{opacity:0;transform:translateY(0.625rem)}to{opacity:1;transform:translateY(0)}}.animate-fade-in{animation:fadeIn 0.3s ease-out forwards}input[type=range]{-webkit-appearance:none;background:transparent}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:1rem;width:1rem;border-radius:50%;background:var(--thumb-color,#22c55e);cursor:pointer;margin-top:-0.375rem;border:0.125rem solid white;box-shadow:0 0.0625rem 0.1875rem rgba(0,0,0,0.2)}input[type=range]::-webkit-slider-runnable-track{width:100%;height:0.25rem;cursor:pointer;background:#e2e8f0;border-radius:0.125rem}
        /* NanumSquareRound Font */
        @font-face { font-family: 'NanumSquareRound'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/NanumSquareRound.woff') format('woff'); font-weight: normal; font-display: swap; }
        body, .font-basic { font-family: 'NanumSquareRound', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        const { createPortal } = ReactDOM;

        // Data
        const VIDEO_DATA=[{id:0,title:"Part 1: 지옥 버전 (Hell Ver.)",subTitle:"월요일은 싫어!",videoId:"AOylqCIDuHc",script:[{id:'v1_1',speaker:'리듬빵',kor:'오늘 무슨 요일이야?',time:[0.000,1.567],eng:"What day is it today?"},{id:'v1_2',speaker:'리듬빵',kor:'월요일은 지옥',time:[1.600,3.067],eng:"Monday is hell."},{id:'v1_3',speaker:'리듬빵',kor:'화요일은 화만나',time:[3.100,4.367],eng:"Tuesday makes me angry."},{id:'v1_4',speaker:'리듬빵',kor:'수요일은 지루해',time:[4.400,5.767],eng:"Wednesday is boring."},{id:'v1_5',speaker:'리듬빵',kor:'목요일은 기대감',time:[5.800,7.200],eng:"Thursday is anticipation."},{id:'v1_6',speaker:'리듬빵',kor:'금요일은 드디어',time:[7.233,8.633],eng:"Friday is finally!"},{id:'v1_7',speaker:'리듬빵',kor:'토요일은 도파민',time:[8.667,10.233],eng:"Saturday is dopamine."},{id:'v1_8',speaker:'리듬빵',kor:'일요일은 우울해지네',time:[10.267,14.600],eng:"Sunday makes me depressed."},{id:'v1_9',speaker:'리듬빵',kor:'너는 무슨 요일이야?',time:[14.633,16.000],eng:"What day are you?"},{id:'v1_10',speaker:'리듬빵',kor:'나는 지금 지옥!',time:[16.033,17.913],eng:"I am in hell right now!"}]},{id:1,title:"Part 2: 천국 버전 (Heaven Ver.)",subTitle:"월요일이 좋아!",videoId:"wKgKzkcOzJs",script:[{id:'v2_1',speaker:'리듬빵',kor:'오늘 무슨 요일이야?',time:[0.000,1.567],eng:"What day is it today?"},{id:'v2_2',speaker:'리듬빵',kor:'월요일은 천국',time:[1.600,3.067],eng:"Monday is heaven."},{id:'v2_3',speaker:'리듬빵',kor:'화요일은 도파민',time:[3.100,4.367],eng:"Tuesday is dopamine."},{id:'v2_4',speaker:'리듬빵',kor:'수요일은 기대감',time:[4.400,5.767],eng:"Wednesday is anticipation."},{id:'v2_5',speaker:'리듬빵',kor:'목요일은 화만나',time:[5.800,7.200],eng:"Thursday makes me angry."},{id:'v2_6',speaker:'리듬빵',kor:'금요일은 지루해',time:[7.233,8.633],eng:"Friday is boring."},{id:'v2_7',speaker:'리듬빵',kor:'토요일은 우울해',time:[8.667,10.233],eng:"Saturday is depressing."},{id:'v2_8',speaker:'리듬빵',kor:'일요일은 행복해지네',time:[10.267,14.600],eng:"Sunday makes me happy."},{id:'v2_9',speaker:'리듬빵',kor:'너는 무슨 요일이야?',time:[14.633,16.000],eng:"What day are you?"},{id:'v2_10',speaker:'리듬빵',kor:'나는 지금 천국!',time:[16.033,17.913],eng:"I am in heaven right now!"}]}];
        const VOCAB_DATA=[{term:'오늘 무슨 요일이야?',mainDef:'What day is it today?',variants:['오늘 무슨 요일이야?'],examples:[{kor:"오늘 무슨 요일이야? - 월요일이야.",eng:"What day is it today? - It's Monday."}],subDefs:[{subTerm:'오늘',subDef:'today'},{subTerm:'무슨',subDef:'what / which'},{subTerm:'요일',subDef:'day of the week'},{subTerm:'-야/이야?',subDef:'casual question ending'}]},{term:'월요일',mainDef:'Monday',variants:['월요일은'],examples:[{kor:"월요일이 싫어요.",eng:"I hate Mondays."}],subDefs:[]},{term:'화요일',mainDef:'Tuesday',variants:['화요일은'],examples:[{kor:"화요일에 만나요.",eng:"See you on Tuesday."}],subDefs:[]},{term:'수요일',mainDef:'Wednesday',variants:['수요일은'],examples:[{kor:"수요일은 바빠요.",eng:"I am busy on Wednesday."}],subDefs:[]},{term:'목요일',mainDef:'Thursday',variants:['목요일은'],examples:[{kor:"목요일은 어때요?",eng:"How about Thursday?"}],subDefs:[]},{term:'금요일',mainDef:'Friday',variants:['금요일은'],examples:[{kor:"금요일 밤이에요.",eng:"It's Friday night."}],subDefs:[]},{term:'토요일',mainDef:'Saturday',variants:['토요일은'],examples:[{kor:"토요일은 쉬어요.",eng:"I rest on Saturday."}],subDefs:[]},{term:'일요일',mainDef:'Sunday',variants:['일요일은'],examples:[{kor:"일요일에 교회 가요.",eng:"I go to church on Sunday."}],subDefs:[]},{term:'천국',mainDef:'Heaven',variants:['천국'],examples:[{kor:"여기가 천국이야.",eng:"Here is heaven."}],subDefs:[]},{term:'지옥',mainDef:'Hell',variants:['지옥'],examples:[{kor:"월요일 출근길은 지옥이야.",eng:"Commuting on Monday is hell."}],subDefs:[]},{term:'화만나',mainDef:'Makes me angry (Pun on 화요일)',variants:['화만나'],examples:[{kor:"요즘 자꾸 화만 나.",eng:"I keep getting angry these days."}],subDefs:[{subTerm:'화가 나다',subDef:'to get angry'}]},{term:'지루해',mainDef:'It is boring',variants:['지루해'],examples:[{kor:"이 영화는 지루해.",eng:"This movie is boring."}],subDefs:[{subTerm:'지루하다',subDef:'to be boring'}]},{term:'기대감',mainDef:'Anticipation / Expectation',variants:['기대감'],examples:[{kor:"기대감이 커요.",eng:"Expectations are high."}],subDefs:[{subTerm:'기대하다',subDef:'to expect / look forward to'}]},{term:'드디어',mainDef:'Finally',variants:['드디어'],examples:[{kor:"드디어 금요일이다!",eng:"Finally, it's Friday!"}],subDefs:[]},{term:'도파민',mainDef:'Dopamine (Excitement)',variants:['도파민'],examples:[{kor:"도파민이 필요해.",eng:"I need dopamine."}],subDefs:[]},{term:'우울해지네',mainDef:'Getting depressed',variants:['우울해지네','우울해'],examples:[{kor:"비가 오니까 우울해지네.",eng:"It's getting depressing because of the rain."}],subDefs:[{subTerm:'우울하다',subDef:'to be depressed'},{subTerm:'-아/어지다',subDef:'to become (change of state)'},{subTerm:'-네요',subDef:'exclamatory ending'}]},{term:'행복해지네',mainDef:'Getting happy',variants:['행복해지네'],examples:[{kor:"너를 보니까 행복해지네.",eng:"Seeing you makes me happy."}],subDefs:[{subTerm:'행복하다',subDef:'to be happy'},{subTerm:'-아/어지다',subDef:'to become'}]},{term:'너는 무슨 요일이야?',mainDef:"What day are you? (Wordplay: Asking 'How do you feel today?' metaphorically using days of the week)",variants:['너는 무슨 요일이야?'],examples:[{kor:"너는 무슨 요일이야? - 나는 지금 지옥(월요일)이야!",eng:"What day are you? - I am Hell (Monday) right now!"}],subDefs:[{subTerm:'무슨',subDef:'what / which'},{subTerm:'요일',subDef:'day of the week'},{subTerm:'-야/이야?',subDef:'a casual question ending form of -예요/이에요?'}]}];
        const QUIZ_LIST=[{id:1,questionKor:"첫 번째 노래(지옥 버전)에서 무슨 요일이 지옥이에요?",questionEng:"Which day is hell in the first song (Hell ver.)?",sentence_pre:"",sentence_post:"이 지옥이에요.",correct_word:"월요일",translationHidden:"____ is hell.",translationRevealed:"Monday is hell.",hint:"Monday",options:[{text:"월요일",isCorrect:true,feedback:"Correct! Monday is described as hell."},{text:"화요일",isCorrect:false,feedback:"Incorrect. Tuesday is the day that makes the speaker angry."},{text:"토요일",isCorrect:false,feedback:"Incorrect. Saturday is described as dopamine."},{text:"일요일",isCorrect:false,feedback:"Incorrect. Sunday is the day the speaker gets depressed."}]},{id:2,questionKor:"첫 번째 노래(지옥 버전)에서 무슨 요일에 화가 나요?",questionEng:"On which day do you get angry in the first song (Hell ver.)?",sentence_pre:"",sentence_post:"에 화가 나요.",correct_word:"화요일",translationHidden:"I get angry on ____.",translationRevealed:"I get angry on Tuesday.",hint:"Tuesday",options:[{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is hell."},{text:"화요일",isCorrect:true,feedback:"Correct! Tuesday makes the speaker angry."},{text:"수요일",isCorrect:false,feedback:"Incorrect. Wednesday is described as boring."},{text:"목요일",isCorrect:false,feedback:"Incorrect. Thursday is anticipation."}]},{id:3,questionKor:"첫 번째 노래(지옥 버전)에서 무슨 요일에 지루해요?",questionEng:"On which day is it boring in the first song (Hell ver.)?",sentence_pre:"",sentence_post:"에 지루해요.",correct_word:"수요일",translationHidden:"It is boring on ____.",translationRevealed:"It is boring on Wednesday.",hint:"Wednesday",options:[{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is hell."},{text:"수요일",isCorrect:true,feedback:"Correct! Wednesday is boring."},{text:"금요일",isCorrect:false,feedback:"Incorrect. Friday is 'finally!'."},{text:"일요일",isCorrect:false,feedback:"Incorrect. Sunday is when the speaker gets depressed."}]},{id:4,questionKor:"첫 번째 노래(지옥 버전)에서 무슨 요일에 우울해요?",questionEng:"On which day is it depressing in the first song (Hell ver.)?",sentence_pre:"",sentence_post:"에 우울해요.",correct_word:"일요일",translationHidden:"It is depressing on ____.",translationRevealed:"It is depressing on Sunday.",hint:"Sunday",options:[{text:"토요일",isCorrect:false,feedback:"Incorrect. Saturday is dopamine."},{text:"일요일",isCorrect:true,feedback:"Correct! Sunday makes the speaker depressed."},{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is hell."},{text:"화요일",isCorrect:false,feedback:"Incorrect. Tuesday makes the speaker angry."}]},{id:5,questionKor:"첫 번째 노래(지옥 버전)에서 무슨 요일이 도파민이에요?",questionEng:"Which day is dopamine in the first song (Hell ver.)?",sentence_pre:"",sentence_post:"이 도파민이에요.",correct_word:"토요일",translationHidden:"____ is dopamine.",translationRevealed:"Saturday is dopamine.",hint:"Saturday",options:[{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is hell."},{text:"목요일",isCorrect:false,feedback:"Incorrect. Thursday is anticipation."},{text:"금요일",isCorrect:false,feedback:"Incorrect. Friday is 'finally!'."},{text:"토요일",isCorrect:true,feedback:"Correct! Saturday is dopamine."}]},{id:6,questionKor:"두 번째 노래(천국 버전)에서 무슨 요일에 화가 나요?",questionEng:"On which day do you get angry in the second song (Heaven ver.)?",sentence_pre:"",sentence_post:"에 화가 나요.",correct_word:"목요일",translationHidden:"I get angry on ____.",translationRevealed:"I get angry on Thursday.",hint:"Thursday",options:[{text:"월요일",isCorrect:false,feedback:"Incorrect. In this version, Monday is heaven."},{text:"수요일",isCorrect:false,feedback:"Incorrect. Wednesday is anticipation."},{text:"목요일",isCorrect:true,feedback:"Correct! In the Heaven version, Thursday makes the speaker angry."},{text:"일요일",isCorrect:false,feedback:"Incorrect. Sunday makes the speaker happy."}]},{id:7,questionKor:"두 번째 노래(천국 버전)에서 무슨 요일에 지루해요?",questionEng:"On which day is it boring in the second song (Heaven ver.)?",sentence_pre:"",sentence_post:"에 지루해요.",correct_word:"금요일",translationHidden:"It is boring on ____.",translationRevealed:"It is boring on Friday.",hint:"Friday",options:[{text:"화요일",isCorrect:false,feedback:"Incorrect. Tuesday is dopamine."},{text:"수요일",isCorrect:false,feedback:"Incorrect. Wednesday is anticipation."},{text:"금요일",isCorrect:true,feedback:"Correct! In this version, Friday is boring."},{text:"토요일",isCorrect:false,feedback:"Incorrect. Saturday is depressing."}]},{id:8,questionKor:"두 번째 노래(천국 버전)에서 무슨 요일이 도파민이에요?",questionEng:"Which day is dopamine in the second song (Heaven ver.)?",sentence_pre:"",sentence_post:"이 도파민이에요.",correct_word:"화요일",translationHidden:"____ is dopamine.",translationRevealed:"Tuesday is dopamine.",hint:"Tuesday",options:[{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is heaven."},{text:"화요일",isCorrect:true,feedback:"Correct! Tuesday is dopamine in this version."},{text:"수요일",isCorrect:false,feedback:"Incorrect. Wednesday is anticipation."},{text:"목요일",isCorrect:false,feedback:"Incorrect. Thursday makes the speaker angry."}]},{id:9,questionKor:"두 번째 노래(천국 버전)에서 무슨 요일에 행복해요?",questionEng:"On which day are you happy in the second song (Heaven ver.)?",sentence_pre:"",sentence_post:"에 행복해요.",correct_word:"일요일",translationHidden:"I am happy on ____.",translationRevealed:"I am happy on Sunday.",hint:"Sunday",options:[{text:"금요일",isCorrect:false,feedback:"Incorrect. Friday is boring."},{text:"토요일",isCorrect:false,feedback:"Incorrect. Saturday is depressing."},{text:"일요일",isCorrect:true,feedback:"Correct! Sunday makes the speaker happy."},{text:"월요일",isCorrect:false,feedback:"Incorrect. Monday is heaven."}]},{id:10,questionKor:"두 번째 노래(천국 버전)에서 무슨 요일이 천국이에요?",questionEng:"Which day is heaven in the second song (Heaven ver.)?",sentence_pre:"",sentence_post:"이 천국이에요.",correct_word:"월요일",translationHidden:"____ is heaven.",translationRevealed:"Monday is heaven.",hint:"Monday",options:[{text:"월요일",isCorrect:true,feedback:"Correct! In the Heaven version, Monday is heaven."},{text:"수요일",isCorrect:false,feedback:"Incorrect. Wednesday is anticipation."},{text:"금요일",isCorrect:false,feedback:"Incorrect. Friday is boring."},{text:"일요일",isCorrect:false,feedback:"Incorrect. Sunday makes the speaker happy."}]}];

        const LEVEL_DEFINITIONS = {"A1":{title:"Novice",desc:"Can use and understand very simple everyday expressions."},"A1+":{title:"Pre-Beginner",desc:"Still beginner, but can handle slightly more than A1."},"A2":{title:"Beginner",desc:"Can understand frequently used sentences (family, shopping, work)."},"A2+":{title:"Upper Beginner",desc:"Can speak a bit more smoothly about daily life."},"B1":{title:"Pre-Intermediate",desc:"Can understand the main points of clear standard speech."},"B1+":{title:"Lower Intermediate",desc:"More comfortable carrying conversations with some gaps."},"B2":{title:"Intermediate",desc:"Can understand the main ideas of complex texts."},"B2+":{title:"Upper Intermediate",desc:"Near C1. Can argue a point logically."},"C1":{title:"Advanced",desc:"Can understand long, demanding texts and implied meanings."},"C1+":{title:"Upper Advanced",desc:"Very strong C1, approaching native-like flexibility."},"C2":{title:"Proficient",desc:"Can understand virtually everything heard or read."}};
        const LEVEL_STYLES = {"A1":"bg-lime-50 text-lime-600 border-lime-100","A1+":"bg-lime-50 text-lime-600 border-lime-100","A2":"bg-green-50 text-green-600 border-green-100","A2+":"bg-green-50 text-green-600 border-green-100","B1":"bg-sky-50 text-sky-600 border-sky-100","B1+":"bg-sky-50 text-sky-600 border-sky-100","B2":"bg-blue-50 text-blue-600 border-blue-100","B2+":"bg-blue-50 text-blue-600 border-blue-100","C1":"bg-fuchsia-50 text-fuchsia-600 border-fuchsia-100","C1+":"bg-fuchsia-50 text-fuchsia-600 border-fuchsia-100","C2":"bg-purple-50 text-purple-700 border-purple-100"};

        // Icons
        const HomeIcon=({className})=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>;
        const LearnIcon=({className,filled})=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="4" width="20" height="16" rx="4" fill={filled?"currentColor":"none"}/><polygon points="10 8 16 12 10 16 10 8" stroke={filled?"#fff":"currentColor"} fill={filled?"#fff":"none"}/></svg>;
        const VocabIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3.5 12.5 12.5 3.5h6a2 2 0 0 1 2 2v6l-9 9a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8Z" stroke="currentColor" strokeWidth="1.8"/><path d="M16.5 7.5h.01" stroke="currentColor" strokeWidth="3.2" strokeLinecap="round"/></svg>;
        const QuizIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.8"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/><path d="M12 17h.01" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
        const DiscussIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-2v3l-4.5-3H6a3 3 0 0 1-3-3V6Z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round"/><path d="M7 8h10M7 12h7" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/></svg>;
        const LineIcon=({d,className})=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d}/></svg>;
        const PlayIconLine=(props)=><LineIcon {...props} d="M5 3l14 9-14 9V3z"/>;
        const OpenBookSolidIcon=({className})=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 6 C2 3 8 2 12 6 C16 2 22 3 22 6 V20 C22 17 16 16 12 20 C8 16 2 17 2 20 Z"/><path d="M12 6 V20"/><path d="M4.5 15 L7 9 L9.5 15" strokeWidth="1.5"/><path d="M5.5 13 H8.5" strokeWidth="1.5"/><path d="M15 10 H19" strokeWidth="1.5"/><path d="M15 13 H19" strokeWidth="1.5"/><path d="M15 16 H18" strokeWidth="1.5"/></svg>;
        const TranslateIcon=({className})=><svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.09-.02.67-.02zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>;
        const ExternalLinkIcon=({className})=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>;
        const CheckCircleIcon=({className})=><svg viewBox="0 0 24 24" fill="currentColor" className={className}><path fillRule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clipRule="evenodd"/></svg>;
        const ChevronLeft=({className})=><LineIcon d="m15 18-6-6 6-6" className={className}/>;
        const ChevronRight=({className})=><LineIcon d="m9 18 6-6-6-6" className={className}/>;
        const SpeedSolidIcon=({className})=><svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/></svg>;
        const SparklesIcon=({className})=><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 00-1.423 1.423z"/></svg>;
        const QuizHeaderIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.8"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/><path d="M12 17h.01" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
        const VocabHeaderIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3.5 12.5 12.5 3.5h6a2 2 0 0 1 2 2v6l-9 9a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8Z" stroke="currentColor" strokeWidth="1.8"/><path d="M16.5 7.5h.01" stroke="currentColor" strokeWidth="3.2" strokeLinecap="round"/></svg>;
        const DiscussHeaderIcon=({className})=><svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-2v3l-4.5-3H6a3 3 0 0 1-3-3V6Z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round"/><path d="M7 8h10M7 12h7" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/></svg>;

        const getLevelTheme = (level) => {
            switch (level) {
                case 'A1': case 'A1+': return 'lime'; case 'A2': case 'A2+': return 'green'; case 'B1': case 'B1+': return 'sky';
                case 'B2': case 'B2+': return 'blue'; case 'C1': case 'C1+': return 'fuchsia'; case 'C2': return 'purple'; default: return 'green';
            }
        };
        const callGeminiWithBackoff = async (payload) => {
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i <= delays.length; i++) {
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    return await response.json();
                } catch (error) { if (i === delays.length) throw error; await new Promise(resolve => setTimeout(resolve, delays[i])); }
            }
        };

        const LevelBadge = ({ levelCode }) => {
            const [isHovered, setIsHovered] = useState(false);
            const info = LEVEL_DEFINITIONS[levelCode] || LEVEL_DEFINITIONS["A2+"];
            const base = levelCode.substring(0, 2);
            const badgeStyle = LEVEL_STYLES[levelCode] || LEVEL_STYLES[base] || "bg-gray-50 text-slate-600 border-gray-100";
            return (
                <div className="relative inline-flex items-center cursor-help z-50" onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}>
                    <span className={`px-2 py-0.5 rounded text-[0.625rem] font-bold border uppercase tracking-wide shadow-sm font-sunflower ${badgeStyle}`}>Level: {info.title}</span>
                    {isHovered && (<div className="absolute top-full left-0 mt-2 w-64 bg-slate-900/95 backdrop-blur text-white text-xs rounded-xl p-4 shadow-xl z-[100] animate-fade-in text-left"><p className={`font-bold mb-1.5 text-sm ${badgeStyle.split(' ')[1]}`}>{levelCode} – {info.title}</p><p className="opacity-90 leading-relaxed font-medium">{info.desc}</p><div className="absolute -top-1 left-4 w-2 h-2 bg-slate-900/95 rotate-45"></div></div>)}
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, isCollapsed, toggleSidebar, userLevel, themeColor, setCollapseManual }) => {
            const menus = [{ id: 'home', label: '시작 페이지', subLabel: 'Home Page', icon: HomeIcon }, { id: 'learn', label: '동영상 자료', subLabel: 'Video Resources', icon: LearnIcon }, { id: 'vocab', label: '핵심 어휘', subLabel: 'Key Vocabulary', icon: VocabIcon }, { id: 'quiz', label: '내용 확인 퀴즈', subLabel: 'Comprehension Quiz', icon: QuizIcon }, { id: 'discuss', label: '생각해 보기', subLabel: 'Food For Thought', icon: DiscussIcon }];
            const currentStyle = LEVEL_STYLES[userLevel] || LEVEL_STYLES[userLevel.substring(0,2)];
            const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, info: null });
            return (
                <aside className={`bg-white border-r border-gray-200 fixed h-full hidden md:flex flex-col z-50 transition-all duration-300 ease-in-out font-cafe24-anemone ${isCollapsed ? 'w-[5.5rem]' : 'w-[18.5rem]'}`} style={{ fontSize: isCollapsed ? '1rem' : '1.15rem' }}>
                    <div className={`p-6 flex items-center gap-3 relative ${isCollapsed ? 'justify-center px-0' : ''}`}>
                        <img src="https://raw.githubusercontent.com/openkoreanlearninglab/Lets-talk-about-this-topic/02d57eda9b250e56fab00389758ecad51ce0c54a/OpenKoreanLearningLab_Logo.jpeg" alt="Logo" className={`rounded-2xl shadow-lg shrink-0 transition-all duration-300 object-cover ${isCollapsed ? 'w-[3rem] h-[3rem]' : 'w-[3.75rem] h-[3.75rem]'}`} />
                        {!isCollapsed && (<div className="animate-fade-in overflow-hidden whitespace-nowrap flex flex-col justify-center"><span className="font-extrabold text-[1.25em] text-black leading-tight font-cafe24-deco">Open</span><span className={`font-bold text-[0.875em] leading-tight font-cafe24-school ${currentStyle.split(' ')[1]}`}>KoreanLearningLab</span></div>)}
                        <button onClick={toggleSidebar} className="absolute -right-3 top-1/2 -translate-y-1/2 bg-white border border-gray-200 rounded-full p-1 shadow-sm text-slate-500 hover:text-slate-700 hover:bg-gray-50 transition-colors z-10">{isCollapsed ? <ChevronRight className="w-3 h-3" /> : <ChevronLeft className="w-3 h-3" />}</button>
                    </div>
                    <nav className={`flex-1 space-y-3 mt-4 ${isCollapsed ? 'px-3' : 'px-3'}`}>{menus.map((menu) => { const isActive = activeTab === menu.id; return (<button key={menu.id} onClick={() => { setActiveTab(menu.id); if (menu.id === 'learn') setCollapseManual(true); else if (isCollapsed && menu.id !== 'learn') toggleSidebar(); }} onDoubleClick={toggleSidebar} className={`w-full flex items-center transition-all duration-200 group relative ${isCollapsed ? 'justify-center h-14 rounded-2xl' : 'gap-3 px-3 py-4 rounded-2xl'} ${isActive ? `bg-${themeColor}-50 text-${themeColor}-600` : 'text-slate-700 hover:bg-gray-50 hover:text-slate-900'}`}>{isActive && isCollapsed && <div className={`absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-8 bg-${themeColor}-500 rounded-r-lg`}></div>}{isActive && !isCollapsed && <div className={`absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-${themeColor}-500 rounded-r-lg`}></div>}<menu.icon className={`shrink-0 transition-all duration-200 ${isCollapsed ? 'w-8 h-8' : 'w-7 h-7'} ${isActive ? `text-${themeColor}-600` : 'text-slate-400 group-hover:text-slate-900'}`} filled={isActive} />{!isCollapsed && (<div className="flex flex-col items-start animate-fade-in overflow-hidden whitespace-nowrap"><span className={`text-[0.875em] leading-tight transition-all ${isActive ? `font-cafe24-surround font-extrabold text-${themeColor}-600` : 'font-cafe24 font-medium text-slate-700 group-hover:font-semibold group-hover:text-slate-900'}`}>{menu.label}</span><span className="text-[0.625em] font-normal text-slate-400 mt-0.5 leading-tight">{menu.subLabel}</span></div>)}{isCollapsed && (<div className="absolute left-full ml-3 px-3 py-1.5 bg-slate-900 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-xl flex flex-col items-start"><span className="text-xs font-bold">{menu.label}</span><span className="text-[10px] opacity-80">{menu.subLabel}</span><div className="absolute top-1/2 -left-1 -translate-y-1/2 w-2 h-2 bg-slate-900 rotate-45"></div></div>)}</button>); })}</nav>
                    <div className="p-2 border-t border-gray-100"><div className={`flex items-center gap-3 p-2 rounded-xl transition-colors hover:bg-gray-50 cursor-pointer ${isCollapsed ? 'justify-center' : ''}`}><div className={`w-[2.75rem] h-[2.75rem] rounded-xl flex items-center justify-center shrink-0 transition-colors duration-300 ${currentStyle.split(' ')[0]} border ${currentStyle.split(' ')[2]}`}><span className={`text-[1em] font-extrabold font-school-smile ${currentStyle.replace('bg-', 'text-').replace('50', '600')}`}>{userLevel}</span></div>{!isCollapsed && (<div className="animate-fade-in overflow-hidden whitespace-nowrap flex-1"><p className="text-[0.875em] font-bold text-slate-900 mb-[1px] font-cafe24-anemone">학습자(Learner)</p><div className="mt-[1px]"><span className={`block w-fit px-[2px] py-0.5 rounded text-[0.625em] font-semibold border uppercase tracking-wide shadow-sm text-left cursor-help font-cafe24-anemone ${currentStyle}`} onMouseEnter={(e) => { const rect = e.target.getBoundingClientRect(); setTooltip({ show: true, x: rect.right, y: rect.top, info: LEVEL_DEFINITIONS[userLevel] }); }} onMouseLeave={() => setTooltip(prev => ({ ...prev, show: false }))}>Level: {LEVEL_DEFINITIONS[userLevel].title}</span></div></div>)}</div></div>
                    {tooltip.show && tooltip.info && createPortal(<div className="fixed z-[9999] pointer-events-none animate-fade-in" style={{ left: tooltip.x, top: tooltip.y }}><div className="relative bg-slate-900/95 backdrop-blur text-white text-xs rounded-xl p-4 shadow-2xl transform -translate-y-full -translate-x-6 -mt-3 w-64 border border-slate-700/50"><p className={`font-bold mb-1.5 text-sm text-${themeColor}-300`}>{userLevel} – {tooltip.info.title}</p><p className="opacity-90 leading-relaxed font-medium text-slate-200">{tooltip.info.desc}</p><div className="absolute -bottom-1.5 left-4 w-3 h-3 bg-slate-900/95 border-r border-b border-slate-700/50 rotate-45"></div></div></div>, document.body)}
                </aside>
            );
        };

        const HomeView = ({ setActiveTab, progress, userLevel, themeColor }) => {
            const completedVideos = progress.learn.filter(Boolean).length;
            const quizScoreDisplay = typeof progress.quiz === 'number' ? `${progress.quiz}%` : (progress.quiz ? '100%' : '0%');
            const quizColorClass = (progress.quiz === 100 || progress.quiz === true) ? `text-${themeColor}-600` : 'text-slate-900';
            const quizIconBg = (progress.quiz === 100 || progress.quiz === true) ? `bg-${themeColor}-100 text-${themeColor}-600` : `bg-${themeColor}-50 text-${themeColor}-600`;
            return (
                <div className="space-y-10 animate-fade-in max-w-full mx-auto" style={{ fontSize: '1.25rem' }}>
                    <div className="space-y-3"><div className="flex items-center gap-2"><span className={`px-2 py-1 bg-${themeColor}-100 text-${themeColor}-700 text-[0.75em] font-extrabold rounded-md tracking-wider font-juache`}>요일송</span><span className={`text-[0.75em] font-bold text-${themeColor}-600 tracking-wide uppercase font-school-smile`}>Days of the Week Song</span></div><h1 className="text-[3em] font-black text-slate-900 tracking-tight font-cafe24-surround">무슨 요일이야?</h1><p className="text-slate-500 text-[1.125em] font-cafe24-surround">What day is it today?</p></div>
                    <div className="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden flex flex-col md:flex-row h-auto md:h-80">
                        <div className="md:w-5/12 relative group bg-black cursor-pointer overflow-hidden" onClick={() => setActiveTab('learn')}><img src={`https://img.youtube.com/vi/${VIDEO_DATA[0].videoId}/maxresdefault.jpg`} alt="Thumbnail" className="w-full h-full object-cover opacity-80 group-hover:opacity-60 transition-opacity duration-300" /><div className="absolute top-6 left-6"><span className="bg-[#ea3323] text-white text-[0.625em] font-bold px-2 py-1 rounded border border-[#ea3323] shadow-sm tracking-wider">ON AIR</span></div><div className="absolute inset-0 flex items-center justify-center"><div className="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"><PlayIconLine className={`w-6 h-6 text-${themeColor}-600 fill-current ml-1`} /></div></div></div>
                        <div className="md:w-7/12 p-8 md:p-10 flex flex-col justify-center"><div className="flex items-center gap-2 mb-4"><span className="px-2 py-1 bg-gray-100 text-slate-600 text-[0.625em] font-bold rounded uppercase tracking-wide">Listening</span><LevelBadge levelCode={userLevel} /></div><div className="mb-3"><h2 className="text-[1.5em] font-black text-slate-900 font-cafe24-surround">동영상 자료</h2><span className="text-[0.875em] font-bold text-slate-400 font-cafe24-surround">Video Resources ({completedVideos}/{VIDEO_DATA.length})</span></div><div className="text-slate-600 text-[0.875em] leading-relaxed mb-8 pr-4"><p>두 가지 버전의 영상을 보고 요일에 대한 다양한 표현을 배워보세요.</p><p className="mt-1 text-slate-400 text-[0.75em]">Watch two versions of the video and learn various expressions about days of the week.</p></div><div className="flex items-center gap-3"><button onClick={() => setActiveTab('learn')} className="px-6 py-3 bg-[#111827] text-white rounded-xl hover:bg-black transition-colors shadow-md flex flex-col items-center leading-tight"><span className="text-[0.875em] font-bold">동영상 보러 가기</span><span className="text-[0.625em] opacity-70 font-medium">Watch Video</span></button></div></div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-40 hover:shadow-md transition-shadow"><div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">핵심 어휘</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Key Vocabulary</span></div><p className="text-[2rem] font-black text-slate-900 mt-1 font-jua">{VOCAB_DATA.length}개</p></div><div className={`w-10 h-10 bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}><VocabIcon className="w-5 h-5" /></div></div><button onClick={() => setActiveTab('vocab')} className="group flex items-center gap-1 transition-colors"><div className="flex flex-col items-start"><span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>핵심 어휘 확인</span><span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Check Vocabulary</span></div><span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-1`}>→</span></button></div>
                        <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-40 hover:shadow-md transition-shadow"><div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">내용 확인 퀴즈</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Comprehension Quiz</span></div><p className={`text-[2rem] font-black mt-1 transition-all duration-500 font-jua ${quizColorClass}`}>{quizScoreDisplay}</p></div><div className={`w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${quizIconBg}`}><QuizIcon className="w-5 h-5" /></div></div><button onClick={() => setActiveTab('quiz')} className="group flex items-center gap-1 transition-colors"><div className="flex flex-col items-start"><span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>퀴즈 시작하기</span><span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Start Quiz</span></div><span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-1`}>→</span></button></div>
                        <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-40 hover:shadow-md transition-shadow"><div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">생각해 보기</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Food For Thought</span></div><div className="flex flex-col mt-3"><a href="https://gemini.google.com/share/2fbb87e8b5ec" target="_blank" rel="noopener noreferrer" className={`text-[1.0625em] font-black text-${themeColor}-600 hover:text-${themeColor}-800 hover:underline transition-colors flex items-center gap-1 leading-tight`}>Gemini AI Feedback <ExternalLinkIcon className="w-4 h-4" /></a></div></div><div className={`w-10 h-10 bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}><DiscussIcon className="w-5 h-5" /></div></div><button onClick={() => setActiveTab('discuss')} className="group flex items-center gap-1 transition-colors"><div className="flex flex-col items-start"><span className="text-[0.75em] font-bold text-slate-400 group-hover:text-blue-600">다음 질문들을 생각해 보세요.</span><span className="text-[0.625em] text-slate-300 group-hover:text-blue-400 font-medium">Have a think about the following questions.</span></div><span className="text-[1.125em] leading-none text-slate-400 group-hover:text-blue-600 ml-1">→</span></button></div>
                    </div>
                </div>
            );
        };

        const LearnView = ({ updateProgress, themeColor, autoScroll, showVocab, playbackRate, watchedVideos }) => {
            const [activeVideoIdx, setActiveVideoIdx] = useState(0);
            const [player, setPlayer] = useState(null);
            const playerRef = useRef(null); 
            const [currentTime, setCurrentTime] = useState(0);
            const [activeLine, setActiveLine] = useState(null);
            const [translations, setTranslations] = useState({});
            const [popup, setPopup] = useState({ show: false, fixed: false, data: null, x: 0, y: 0 });
            const [activeVocabTerm, setActiveVocabTerm] = useState(null);
            const sidebarVocabRefs = useRef({});
            const scriptRefs = useRef({});
            const intervalRef = useRef(null);
            const currentVideo = VIDEO_DATA[activeVideoIdx];
            const currentVideoRef = useRef(currentVideo);

            useEffect(() => { currentVideoRef.current = currentVideo; }, [currentVideo]);
            useEffect(() => {
                const initPlayer = () => {
                    new window.YT.Player('youtube-player', { videoId: currentVideo.videoId, width: '100%', height: '100%', playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0 },
                        events: { 'onReady': (event) => { playerRef.current = event.target; setPlayer(event.target); if (playbackRate !== 1.0) event.target.setPlaybackRate(playbackRate); },
                            'onStateChange': (event) => { if (event.data === window.YT.PlayerState.PLAYING) { startInterval(); updateProgress(activeVideoIdx); } else if (event.data === window.YT.PlayerState.ENDED) { stopInterval(); } else { stopInterval(); } } } });
                };
                if (!player && window.YT && window.YT.Player) initPlayer();
                else if (player && player.loadVideoById) { player.loadVideoById(currentVideo.videoId); setActiveLine(null); }
                else if (!window.YT) { const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; const firstScriptTag = document.getElementsByTagName('script')[0]; firstScriptTag.parentNode.insertBefore(tag, firstScriptTag); window.onYouTubeIframeAPIReady = initPlayer; }
            }, [activeVideoIdx, currentVideo.videoId]);

            useEffect(() => { if (player && player.setPlaybackRate) player.setPlaybackRate(playbackRate); }, [playbackRate, player]);
            const startInterval = () => { stopInterval(); intervalRef.current = setInterval(() => { const p = playerRef.current; if (p && p.getCurrentTime) { const time = p.getCurrentTime(); setCurrentTime(time); const currentLine = currentVideoRef.current.script.find(line => time >= line.time[0] && time < line.time[1]); if (currentLine) setActiveLine(currentLine.id); } }, 200); };
            const stopInterval = () => clearInterval(intervalRef.current);
            useEffect(() => { if (!popup.show && activeLine && autoScroll && scriptRefs.current[activeLine]) scriptRefs.current[activeLine].scrollIntoView({ behavior: 'smooth', block: 'center' }); }, [activeLine, autoScroll, popup.show]);
            useEffect(() => { const handleGlobalClick = () => { if (popup.fixed) setPopup(prev => ({ ...prev, show: false, fixed: false })); }; if (popup.fixed) window.addEventListener('click', handleGlobalClick); return () => window.removeEventListener('click', handleGlobalClick); }, [popup.fixed]);

            const handleLineClick = (time) => { if (player) { player.seekTo(time); player.playVideo(); } };
            const toggleTranslation = (id) => { setTranslations(prev => ({...prev, [id]: !prev[id]})); };
            const scrollToVocab = (term) => { const element = sidebarVocabRefs.current[term]; if (element) element.scrollIntoView({ behavior: 'smooth', block: 'center' }); };
            const handleVocabEnter = (e, wordData) => { if (popup.fixed) return; const rect = e.target.getBoundingClientRect(); setPopup({ show: true, fixed: false, data: wordData, x: rect.left + rect.width / 2, y: rect.bottom }); if (showVocab) { setActiveVocabTerm(wordData.term); scrollToVocab(wordData.term); } };
            const handleVocabLeave = () => { if (popup.fixed) return; setPopup(prev => ({ ...prev, show: false })); };
            const handleVocabClick = (e, wordData) => { e.stopPropagation(); if (popup.fixed && popup.data && popup.data.term === wordData.term) { setPopup(prev => ({ ...prev, show: false, fixed: false })); return; } const rect = e.target.getBoundingClientRect(); setPopup({ show: true, fixed: true, data: wordData, x: rect.left + rect.width / 2, y: rect.bottom }); if (showVocab) { setActiveVocabTerm(wordData.term); scrollToVocab(wordData.term); } };

            const renderTextWithVocab = (text) => {
                let parts = [text]; const allMatchers = [];
                VOCAB_DATA.forEach(vocab => { const forms = new Set([vocab.term, ...(vocab.variants || [])]); forms.forEach(form => { if (form) allMatchers.push({ text: form, data: vocab }); }); });
                allMatchers.sort((a, b) => b.text.length - a.text.length);
                allMatchers.forEach(matcher => { const nextParts = []; parts.forEach(part => { if (typeof part === 'string') { const split = part.split(matcher.text); split.forEach((s, i) => { if (s) nextParts.push(s); if (i < split.length - 1) { nextParts.push({ isVocab: true, ...matcher.data, displayText: matcher.text }); } }); } else { nextParts.push(part); } }); parts = nextParts; });
                return parts.map((part, index) => { if (typeof part === 'string') return part; const isActive = (popup.show && popup.data && popup.data.term === part.term) || (showVocab && activeVocabTerm === part.term); const textToShow = part.displayText || part.term; return (<span key={index} className={`cursor-pointer border-b-2 transition-all duration-200 font-bold inline-block leading-tight ${isActive ? `text-${themeColor}-700 border-${themeColor}-500 bg-${themeColor}-100 rounded-sm px-0.5 mx-0.5` : `text-slate-900 border-dashed border-gray-400 hover:text-${themeColor}-600 hover:border-${themeColor}-400 hover:bg-${themeColor}-50`}`} onMouseEnter={(e) => handleVocabEnter(e, part)} onMouseLeave={handleVocabLeave} onClick={(e) => handleVocabClick(e, part)}>{textToShow}</span>); });
            };

            return (
                <div className="flex flex-col h-[calc(100vh-4rem)] animate-fade-in overflow-hidden relative w-full mx-auto">
                    <div className="px-4 pt-2 pb-2 bg-white border-b border-gray-200 shrink-0 z-20"><div className="flex gap-2 p-1 bg-gray-100 rounded-xl overflow-x-auto">{VIDEO_DATA.map((video, idx) => { const isActive = activeVideoIdx === idx; const isWatched = watchedVideos[idx]; return (<button key={video.id} onClick={() => setActiveVideoIdx(idx)} className={`flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-lg text-sm font-bold transition-all duration-200 whitespace-nowrap ${isActive ? 'bg-white text-slate-900 shadow-sm ring-1 ring-black/5' : 'text-slate-500 hover:text-slate-700 hover:bg-gray-200/50'}`}><div className={`w-2 h-2 rounded-full ${isActive ? `bg-${themeColor}-500` : (isWatched ? `bg-${themeColor}-300` : 'bg-gray-300')}`}></div><span>{video.title}</span>{isWatched && <CheckCircleIcon className={`w-4 h-4 text-${themeColor}-500`} />}</button>); })}</div></div>
                    <div className="flex-1 flex gap-4 overflow-hidden p-4">
                        {popup.show && popup.data && createPortal(<div className="fixed z-[9999] bg-white rounded-xl shadow-xl border border-gray-200 p-[1.2rem] w-[21.6rem] animate-fade-in pointer-events-none font-school-free" style={{ left: popup.x, top: popup.y + 12, transform: 'translate(-50%, 0)', fontSize: 'calc(clamp(12px, 1vw, 16px) * 1.5)' }}><div className="flex items-center justify-between mb-2"><h3 className="text-[1.125em] font-black text-slate-900">{popup.data.term}</h3></div><p className="text-[0.875em] text-slate-700 font-medium mb-3 leading-snug">{popup.data.mainDef}</p>{popup.fixed && popup.data.subDefs && popup.data.subDefs.length > 0 && (<div className="space-y-1 mt-2">{popup.data.subDefs.map((sub, idx) => (<div key={idx} className={`bg-${themeColor}-50 rounded-lg p-2 border border-${themeColor}-100`}><p className={`text-[0.75em] text-${themeColor}-900 font-bold`}>{sub.subTerm}</p><p className={`text-[0.625em] text-${themeColor}-700`}>{sub.subDef}</p></div>))}</div>)}<div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-white border-l border-t border-gray-200 rotate-45"></div></div>, document.body)}
                        <div className={`flex flex-col gap-4 transition-all duration-300 ${showVocab ? 'w-5/12' : 'flex-1'} h-full`}><div className="bg-black rounded-xl overflow-hidden shadow-lg flex-1 min-h-[12.5rem]"><div id="youtube-player" className="w-full h-full"></div></div></div>
                        <div className={`flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm transition-all duration-300 ${showVocab ? 'w-4/12' : 'w-5/12'} h-full`}><div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 rounded-xl" style={{ fontSize: 'calc(clamp(12px, 1vw, 16px) * 1.5)' }}>{currentVideo.script.map(line => { const isActive = activeLine === line.id; return (<div key={line.id} ref={el => scriptRefs.current[line.id] = el} className="flex flex-col"><div className="flex items-center gap-2 mb-1 ml-1"><span className="text-[0.75em] font-bold text-slate-600">{line.speaker}</span><button onClick={(e) => { e.stopPropagation(); handleLineClick(line.time[0]); }} className={`text-[0.625em] text-${themeColor}-600 hover:underline flex items-center gap-0.5`}><PlayIconLine className="w-3 h-3 fill-current" /> 재생 (Play)</button></div><div onClick={() => handleLineClick(line.time[0])} className={`p-5 rounded-2xl border transition-all duration-300 cursor-pointer relative group ${isActive ? 'bg-yellow-100 border-yellow-400 shadow-md ring-1 ring-yellow-200 scale-[1.01]' : 'bg-white border-gray-200 hover:border-gray-300'}`}><p className="text-[1.125em] text-slate-800 leading-relaxed font-medium">{renderTextWithVocab(line.kor)}</p><div className="my-3 border-t border-dashed border-gray-200"></div>{translations[line.id] ? (<p className="text-[0.875em] text-slate-500 animate-fade-in">{line.eng}</p>) : (<button onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }} className="flex items-center gap-1 text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"><TranslateIcon className="w-3 h-3" /> 번역 (Translation)</button>)}{translations[line.id] && (<button onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }} className="absolute bottom-4 right-4 text-[0.625em] text-slate-300 hover:text-slate-500">접기</button>)}</div></div>); })}{activeVideoIdx < VIDEO_DATA.length - 1 && (<div className="pt-8 pb-4"><button onClick={() => setActiveVideoIdx(activeVideoIdx + 1)} className={`w-full py-4 rounded-xl bg-${themeColor}-100 text-${themeColor}-700 font-bold shadow-sm hover:bg-${themeColor}-200 transition-all flex items-center justify-center gap-2 group`}><span>다음 영상 보기 (Next Video)</span><span className="group-hover:translate-x-1 transition-transform">→</span></button></div>)}<div className="h-32"></div></div></div>
                        {showVocab && (<div className="w-3/12 flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm animate-fade-in h-full"><div className="p-4 border-b border-gray-100 flex items-center gap-2 bg-white rounded-t-xl shrink-0"><VocabIcon className={`w-5 h-5 text-${themeColor}-600`} /><div className="flex flex-col leading-none"><h2 className="font-bold text-slate-900 text-sm">핵심 어휘</h2><span className="text-[10px] text-slate-400 font-medium">Key Vocabulary</span></div></div><div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">{VOCAB_DATA.map((word, idx) => (<div key={idx} ref={el => sidebarVocabRefs.current[word.term] = el} className={`p-4 rounded-xl border transition-all duration-500 ${activeVocabTerm === word.term ? `border-${themeColor}-500 bg-${themeColor}-50 ring-2 ring-${themeColor}-200 shadow-md scale-105` : 'bg-white border-gray-200 shadow-sm'}`}><div className="flex justify-between items-start mb-2"><h3 className="text-lg font-extrabold text-slate-900">{word.term}</h3></div><p className="text-sm text-slate-600 mb-3 font-medium">{word.mainDef}</p>{word.subDefs && word.subDefs.length > 0 && (<div className={`space-y-2 bg-${themeColor}-50 p-2.5 rounded-lg border border-${themeColor}-100`}>{word.subDefs.map((sub, i) => (<div key={i}><p className={`text-xs text-${themeColor}-900 font-bold`}>{sub.subTerm}</p><p className={`text-[10px] text-${themeColor}-700`}>{sub.subDef}</p></div>))}</div>)}</div>))}</div></div>)}
                    </div>
                </div>
            );
        };

        const VocabCard = ({ word, themeColor }) => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-all h-full flex flex-col">
                    <div className="flex flex-col mb-4">
                        <div className="flex justify-between items-start"><h3 className="text-[1.5em] font-extrabold text-slate-900">{word.term}</h3></div>
                        {word.variants && word.variants.length > 0 && (<div className="flex flex-wrap gap-2 mt-1">{word.variants.map((v, i) => (<span key={i} className={`text-[0.75em] px-2 py-0.5 rounded-full bg-${themeColor}-50 text-${themeColor}-600 font-bold border border-${themeColor}-100`}>{v}</span>))}</div>)}
                    </div>
                    <div className={`pl-4 border-l-4 border-${themeColor}-500 mb-6`}><p className="text-[1.125em] text-slate-600 font-medium">{word.mainDef}</p></div>
                    <div className="flex-1 flex flex-col">
                        <button onClick={() => setIsOpen(!isOpen)} className="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition-all group border border-transparent hover:border-gray-200"><div className="flex items-center gap-2"><span className={`w-1.5 h-1.5 rounded-full transition-colors duration-300 ${isOpen ? `bg-${themeColor}-500` : 'bg-gray-400'}`}></span><span className={`text-[0.75em] font-bold uppercase tracking-wider transition-colors duration-300 ${isOpen ? `text-${themeColor}-700` : 'text-slate-500'}`}>Examples (예문)</span></div><ChevronRight className={`w-4 h-4 text-slate-400 transition-transform duration-300 ${isOpen ? 'rotate-90' : ''}`} /></button>
                        <div className={`overflow-hidden transition-all duration-300 ease-in-out ${isOpen ? 'max-h-96 opacity-100 mt-2' : 'max-h-0 opacity-0'}`}><div className="bg-gray-50 rounded-xl p-4 space-y-3 border border-gray-100">{word.examples.map((ex, i) => (<div key={i}><p className="font-bold text-slate-800 text-[0.875em] leading-relaxed">{ex.kor}</p><p className="text-slate-500 text-[0.75em] mt-0.5">{ex.eng}</p></div>))}</div></div>
                        {word.subDefs && word.subDefs.length > 0 && (<div className={`bg-${themeColor}-50 rounded-xl p-5 space-y-2 border border-${themeColor}-100 mt-4`}><h4 className={`font-bold text-${themeColor}-800 text-[0.75em] mb-2 flex items-center gap-2 uppercase tracking-wider`}><span className={`w-1.5 h-1.5 rounded-full bg-${themeColor}-400`}></span>Related & Grammar</h4>{word.subDefs.map((sub, i) => (<div key={i} className="flex flex-col"><span className={`font-bold text-${themeColor}-900 text-[0.875em]`}>{sub.subTerm}</span><span className={`text-[0.75em] text-${themeColor}-600`}>{sub.subDef}</span></div>))}</div>)}
                    </div>
                </div>
            );
        };

        const VocabView = ({ updateProgress, themeColor }) => {
            useEffect(() => { updateProgress('vocab'); }, []);
            return (
            <div className="max-w-fit animate-fade-in mx-auto" style={{ fontSize: '1.4rem' }}>
                <div className="flex items-center gap-4 mb-8"><div className={`w-16 h-16 bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><VocabIcon className={`w-10 h-10 text-${themeColor}-600`} /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">핵심 어휘</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Key Vocabulary</span></div></div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">{VOCAB_DATA.map((word, idx) => (<VocabCard key={idx} word={word} themeColor={themeColor} />))}</div>
            </div>
            );
        };

        const FeedbackSection = ({ value, onChange, placeholder, question, keyPhrases, themeColor }) => {
            const [feedback, setFeedback] = useState(null); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(null);
            const checkSentence = async () => {
                if (!value || value.trim() === '') { setError("문장을 입력해야 피드백을 받을 수 있어요."); setFeedback(null); return; }
                setIsLoading(true); setError(null); setFeedback(null);
                const payload = { contents: [{ role: "user", parts: [{ text: `You are an advanced Korean language tutor AI for A2 level learners. Analyze the user's sentence in response to a specific question.\nThe user's answer is in Korean.\nYour goal is to provide feedback in ENGLISH to help the learner understand.\n\nInstructions:\n1. "feedback_message_eng": Write the feedback status or brief comment in English.\n2. "explanation_eng": Explain the grammar or vocabulary mistake in English. You can quote Korean words but the explanation must be in English.\n3. "corrected_sentence": Provide the natural and correct Korean sentence.\n4. "relevance_feedback_eng": If the answer is irrelevant, explain why in English.\n\nQuestion: "${question}"\nUser's Answer: "${value}"\n\nYour response MUST be a JSON object with the specified schema.` }, { text: `Please provide feedback on my answer.\n\nQuestion: "${question}"\nUser's Answer: "${value}"` }] }], generationConfig: { responseMimeType: "application/json", responseSchema: { type: "OBJECT", properties: { "is_relevant": { "type": "BOOLEAN" }, "relevance_feedback_eng": { "type": "STRING", "nullable": true }, "is_correct": { "type": "BOOLEAN", "nullable": true }, "feedback_message_eng": { "type": "STRING", "nullable": true }, "corrected_sentence": { "type": "STRING", "nullable": true }, "explanation_eng": { "type": "STRING", "nullable": true }, "alternative_expressions": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "expression_kor": { "type": "STRING" }, "expression_eng": { "type": "STRING" } }, "required": ["expression_kor", "expression_eng"] } } }, "required": ["is_relevant"] } } };
                try { const result = await callGeminiWithBackoff(payload); if (result.candidates?.[0]?.content?.parts?.[0]?.text) { setFeedback(JSON.parse(result.candidates[0].content.parts[0].text)); } else { setError("AI의 응답을 처리하는 데 문제가 발생했어요."); } } catch (err) { console.error(err); setError("문장 검사에 실패했어요. 다시 시도해 주세요."); } finally { setIsLoading(false); }
            };
            return (
                <div>
                    {keyPhrases}
                    <div>
                        <h4 className="font-bold text-slate-900 mb-3 text-[1em]">핵심 표현을 사용해서 질문에 대답해 보세요.</h4>
                        <textarea value={value} onChange={onChange} placeholder={placeholder} className={`w-full p-4 rounded-xl border border-gray-200 focus:border-${themeColor}-500 focus:ring-1 focus:ring-${themeColor}-500 outline-none min-h-[120px] resize-none text-[1em] text-slate-800 placeholder-gray-400 mb-3`}></textarea>
                        <button onClick={checkSentence} disabled={!value.trim() || isLoading} className={`flex items-center gap-2 px-5 py-[6px] text-[0.75em] leading-[1.2] rounded-xl font-bold transition-all shadow-sm ${!value.trim() || isLoading ? 'bg-gray-100 text-slate-400 cursor-not-allowed' : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md'}`}>{isLoading ? (<><div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div><span>분석 중... (Analyzing)</span></>) : (<><SparklesIcon className="w-5 h-5" /><span>AI Feedback (피드백 받기)</span></>)}</button>
                        {error && (<div className="mt-4 p-4 bg-red-50 text-red-600 rounded-xl border border-red-200 text-[0.875em] font-medium animate-fade-in">{error}</div>)}
                        {feedback && (<div className={`mt-6 rounded-2xl p-6 border animate-fade-in ${feedback.is_correct ? `bg-${themeColor}-50 border-${themeColor}-200` : 'bg-yellow-50 border-yellow-200'}`}><div className="flex items-center gap-2 mb-4"><span className="text-[1.5em]">🤖</span><h4 className="font-extrabold text-slate-900 text-[1.125em]">AI Tutor Feedback</h4></div><div className="mb-4"><span className={`font-black text-[0.875em] px-3 py-1 rounded-full bg-white border shadow-sm ${feedback.is_correct ? `text-${themeColor}-600 border-${themeColor}-200` : 'text-yellow-600 border-yellow-200'}`}>{feedback.is_correct ? '🎉 Great Job!' : '⚠️ Needs Improvement'}</span></div><div className="space-y-4">{feedback.feedback_message_eng && (<div className="flex flex-col sm:flex-row gap-1 sm:gap-4"><span className="font-bold text-slate-500 text-[0.875em] sm:w-24 shrink-0">Feedback</span><p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.feedback_message_eng}</p></div>)}{feedback.explanation_eng && (<div className="flex flex-col sm:flex-row gap-1 sm:gap-4"><span className="font-bold text-slate-500 text-[0.875em] sm:w-24 shrink-0">Explanation</span><p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.explanation_eng}</p></div>)}{feedback.corrected_sentence && (<div className="flex flex-col sm:flex-row gap-1 sm:gap-4"><span className="font-bold text-slate-500 text-[0.875em] sm:w-24 shrink-0">Correction</span><p className="text-slate-900 text-[1.125em] font-black leading-relaxed">{feedback.corrected_sentence}</p></div>)}{!feedback.is_relevant && (<div className="flex flex-col sm:flex-row gap-1 sm:gap-4"><span className="font-bold text-slate-500 text-[0.875em] sm:w-24 shrink-0">Relevance</span><p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.relevance_feedback_eng || "This answer doesn't seem relevant to the question."}</p></div>)}</div></div>)}
                    </div>
                </div>
            );
        };

        const QuizView = ({ updateProgress, themeColor }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0); const [answers, setAnswers] = useState({}); const [firstAttempts, setFirstAttempts] = useState({}); const [showHint, setShowHint] = useState(false); const [showTranslation, setShowTranslation] = useState(false); const [isFinished, setIsFinished] = useState(false);
            const currentQuestion = QUIZ_LIST[currentQuestionIndex]; const shuffledOptions = useMemo(() => { return [...currentQuestion.options].sort(() => Math.random() - 0.5); }, [currentQuestion]); const selectedOption = answers[currentQuestionIndex] || null; const isCorrect = selectedOption?.isCorrect;
            const handleOptionClick = (option) => { if (selectedOption?.isCorrect) return; if (firstAttempts[currentQuestionIndex] === undefined) { setFirstAttempts(prev => ({ ...prev, [currentQuestionIndex]: option.isCorrect })); } setAnswers(prev => ({ ...prev, [currentQuestionIndex]: option })); setShowHint(false); };
            const handlePrev = () => { if (currentQuestionIndex > 0) { setCurrentQuestionIndex(prev => prev - 1); setShowHint(false); setShowTranslation(false); } };
            const handleNext = () => { if (currentQuestionIndex < QUIZ_LIST.length - 1) { setCurrentQuestionIndex(prev => prev + 1); setShowHint(false); setShowTranslation(false); } else { setIsFinished(true); const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length; updateProgress('quiz', Math.round((correctCount / QUIZ_LIST.length) * 100)); } };
            const handleRetry = () => { setCurrentQuestionIndex(0); setAnswers({}); setFirstAttempts({}); setIsFinished(false); updateProgress('quiz', 0); };

            if (isFinished) { const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length; return (<div className="max-w-fit animate-fade-in mx-auto text-center py-10" style={{ fontSize: 'calc(clamp(12px, 1vw, 16px) * 2.0)' }}><div className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[2.5em]"><div className={`w-[5em] h-[5em] bg-${themeColor}-100 text-${themeColor}-600 rounded-full flex items-center justify-center mx-auto mb-[1.5em]`}><QuizIcon className="w-[2.5em] h-[2.5em]" /></div><h2 className="text-[1.875em] font-black text-slate-900 mb-2 font-cafe24-surround">퀴즈 완료!</h2><p className="text-slate-500 mb-8">총 {QUIZ_LIST.length}문제 중 {correctCount}문제를 한 번에 맞혔습니다.</p><div className={`text-[3em] font-black text-${themeColor}-600 mb-10 font-school-smile`}>{Math.round((correctCount / QUIZ_LIST.length) * 100)}%</div><button onClick={handleRetry} className={`px-8 py-3 rounded-xl bg-${themeColor}-600 text-white font-bold hover:bg-${themeColor}-700 transition-colors`}>다시 풀기 (Try Again)</button></div></div>); }
            return (
                <div className="max-w-fit animate-fade-in mx-auto" style={{ fontSize: 'calc(clamp(12px, 1vw, 16px) * 2.0)' }}>
                    <div className="flex items-center gap-[1em] mb-[1.5em]"><div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><QuizIcon className="w-[2.5em] h-[2.5em] text-current" /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">내용 확인 퀴즈</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Comprehension Quiz ({currentQuestionIndex + 1}/{QUIZ_LIST.length})</span></div></div>
                    <div className="mb-[1.5em] p-[1em] bg-gray-50 rounded-xl border border-gray-200"><p className="font-bold text-slate-800">다음 빈칸에 알맞은 말을 고르세요.</p><p className="text-slate-500 text-[0.875em]">Choose the correct word for the blank.</p></div>
                    <div className="bg-white rounded-2xl border border-gray-200 shadow-sm p-[0.5em]"><div className="flex items-start gap-[0.75em] p-[1em]"><span className={`bg-${themeColor}-100 text-${themeColor}-700 font-black rounded-lg px-[0.5em] py-[0.25em] text-[0.875em] shrink-0`}>Q{currentQuestion.id}</span><div className="flex flex-col"><h3 className="font-bold text-slate-900 text-[1.125em] leading-snug">{currentQuestion.questionKor}</h3><p className="text-slate-500 font-medium text-[0.875em] mt-1">{currentQuestion.questionEng}</p></div></div><div className="bg-gray-50 rounded-xl p-[1em] mb-[1em] mx-[0.25em]"><div><div className="flex items-center flex-wrap gap-[0.5em] leading-relaxed"><span className="text-[1.25em] font-bold text-slate-900">{currentQuestion.sentence_pre}</span><div className={`px-[1em] py-[0.25em] rounded-md font-bold text-[1.25em] transition-all duration-300 min-w-[5em] text-center border-b-2 ${isCorrect ? `bg-${themeColor}-50 text-${themeColor}-700 border-${themeColor}-500` : (showHint ? 'bg-yellow-100 text-yellow-800 border-yellow-400' : (selectedOption ? 'bg-red-50 text-red-700 border-red-500' : 'bg-yellow-100 text-transparent border-yellow-400 select-none'))}`}>{isCorrect ? selectedOption.text : (showHint ? `[ ${currentQuestion.hint} ]` : (selectedOption ? selectedOption.text : "___"))}</div><span className="text-[1.25em] font-bold text-slate-900">{currentQuestion.sentence_post}{selectedOption && (<span className={`ml-2 text-[1.125em] ${isCorrect ? `text-${themeColor}-600` : 'text-red-600'}`}>{isCorrect ? '✓' : '✗'}</span>)}</span></div>{showTranslation && (<div className="mt-[1em] pt-[1em] border-t border-gray-200 text-slate-500 italic text-[0.875em] animate-fade-in font-medium">{isCorrect ? currentQuestion.translationRevealed : currentQuestion.translationHidden}</div>)}</div></div><div className="flex gap-[0.5em] mb-[1em] px-[0.5em]"><button onClick={() => { setShowHint(!showHint); }} disabled={selectedOption?.isCorrect} className={`px-[0.75em] py-[0.375em] rounded-lg text-[0.75em] font-bold transition-colors ${selectedOption?.isCorrect ? 'opacity-50 cursor-not-allowed bg-gray-100 text-slate-400' : (showHint ? 'bg-yellow-200 text-yellow-800 ring-2 ring-yellow-400' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200')}`}>힌트 (Hint)</button><button onClick={() => setShowTranslation(!showTranslation)} className="inline-flex items-center gap-[0.25em] text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"><TranslateIcon className="w-[0.75em] h-[0.75em]" /><span>{showTranslation ? '번역 숨기기 (Hide)' : '번역 (Translation)'}</span></button></div><div className="grid grid-cols-2 md:grid-cols-4 gap-[0.75em] mb-[1em] px-[0.5em]">{shuffledOptions.map((option, idx) => { const isSelected = selectedOption === option; let btnClass = "bg-white border-gray-200 text-slate-700 hover:bg-gray-50 hover:border-gray-300"; if (isSelected) { btnClass = option.isCorrect ? `bg-${themeColor}-500 border-${themeColor}-600 text-white shadow-md ring-2 ring-${themeColor}-200` : "bg-red-500 border-red-600 text-white shadow-md ring-2 ring-red-200"; } else if (selectedOption?.isCorrect) { btnClass = "bg-gray-50 border-gray-200 text-slate-400 cursor-not-allowed"; } return ( <button key={idx} onClick={() => handleOptionClick(option)} disabled={selectedOption?.isCorrect} className={`py-[0.75em] px-[1em] rounded-xl border font-bold text-[1em] transition-all duration-200 ${btnClass}`}>{option.text}</button> ); })}</div>{selectedOption && (<div className="p-[1em] rounded-xl border-l-4 mb-[1em] mx-[0.5em] animate-fade-in transition-all bg-[#f8fafc] border-gray-300"><div className={`${isCorrect ? `bg-${themeColor}-50 border-${themeColor}-500` : 'bg-red-50 border-red-500'} p-[1em] rounded-lg border-l-4`}><h4 className={`font-bold text-[0.875em] mb-1 ${isCorrect ? `text-${themeColor}-800` : 'text-red-800'}`}>{isCorrect ? 'Correct!' : 'Try again.'}</h4><p className={`text-[0.875em] italic ${isCorrect ? `text-${themeColor}-700` : 'text-red-700'}`}>{selectedOption.feedback}</p></div></div>)}<div className="flex justify-between items-center mt-[1em] border-t border-gray-100 pt-[1em] px-[0.5em] pb-[0.5em]"><button onClick={handlePrev} disabled={currentQuestionIndex === 0} className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] transition-colors ${currentQuestionIndex === 0 ? 'text-slate-300 cursor-not-allowed' : 'text-slate-600 hover:bg-gray-100'}`}><span className="text-[1.125em]">←</span><span className="text-[0.75em]">이전 문제 (Prev)</span></button><span className="text-[0.75em] font-bold text-slate-600">{currentQuestionIndex + 1} / {QUIZ_LIST.length}</span><button onClick={handleNext} disabled={!isCorrect} className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] shadow-md transition-colors ${!isCorrect ? 'bg-gray-300 text-slate-500 cursor-not-allowed' : 'bg-gray-900 text-white hover:bg-black'}`}><span className="text-[0.75em]">{currentQuestionIndex < QUIZ_LIST.length - 1 ? '다음 문제 (Next)' : '결과 보기 (Finish)'}</span><span className="text-[1.125em]">→</span></button></div></div>
                </div>
            );
        };

        const DiscussView = ({ updateProgress, themeColor }) => {
            const [answers, setAnswers] = useState({}); const [showTranslations, setShowTranslations] = useState({});
            const QUESTIONS=[{id:1,question:"오늘은 무슨 요일이에요?",translation:"What day is it today?",keyPhrases:["무슨 요일: What day / Which day"]},{id:2,question:"어제는 무슨 요일이었어요?",translation:"What day was it yesterday?",keyPhrases:["무슨 요일: What day / Which day"]},{id:3,question:"내일은 무슨 요일이에요?",translation:"What day is it tomorrow?",keyPhrases:["무슨 요일: What day / Which day"]},{id:4,question:"여러분에게 무슨 요일이 지옥이에요?",translation:"Which day is hell for you?",keyPhrases:["여러분에게: to you / for you","무슨 요일: which day","지옥: hell"]},{id:5,question:"여러분은 무슨 요일에 화가 나요?",translation:"On which day do you get angry?",keyPhrases:["여러분: you / everyone","무슨 요일: which day","화가 나다: to get angry"]},{id:6,question:"여러분은 무슨 요일에 지루해요?",translation:"On which day do you feel bored?",keyPhrases:["여러분: you / everyone","무슨 요일: which day","지루하다: to be boring"]},{id:7,question:"여러분은 무슨 요일에 우울해요?",translation:"On which day do you feel depressed?",keyPhrases:["여러분: you / everyone","무슨 요일: which day","우울하다: to be depressed"]},{id:8,question:"여러분은 무슨 요일에 행복해요?",translation:"On which day do you feel happy?",keyPhrases:["여러분: you / everyone","무슨 요일: which day","행복하다: to be happy"]},{id:9,question:"여러분에게 무슨 요일이 천국이에요?",translation:"Which day is heaven for you?",keyPhrases:["여러분에게: to you / for you","무슨 요일: which day","천국: heaven"]},{id:10,question:"여러분은 지금 무슨 요일이에요?",translation:"What day are you right now? (Metaphorically)",keyPhrases:["여러분: you / everyone","지금: now","무슨 요일: what day"]}];
            const toggleTranslation = (id) => { setShowTranslations(prev => ({ ...prev, [id]: !prev[id] })); };
            const handleAnswerChange = (id, val) => { setAnswers(prev => ({ ...prev, [id]: val })); };
            const renderKeyPhrases = (phrases) => (<div className="mb-[1.5em] space-y-3"><div className="flex items-center gap-[0.5em]"><span className="text-red-500 text-[1.125em]">📍</span><h4 className="font-bold text-slate-900 text-[0.875em]">핵심 표현 (Essential phrases)</h4></div><div className="flex flex-wrap gap-[0.5em]">{phrases.map((phrase, idx) => (<span key={idx} className={`px-[0.5em] py-[0.25em] rounded-lg bg-${themeColor}-50 text-${themeColor}-700 text-[0.75em] font-bold border border-${themeColor}-100`}>{phrase}</span>))}</div></div>);
            
            return (
                <div className="max-w-full mx-auto animate-fade-in pb-[5em]" style={{ fontSize: 'calc(clamp(12px, 1vw, 16px) * 1.9)' }}>
                    <div className="flex items-center gap-[1em] mb-[2em]"><div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><DiscussIcon className="w-[2.5em] h-[2.5em] text-current" /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">생각해 보기</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Food For Thought</span></div></div>
                    <div className={`mb-[2em] p-[1em] rounded-2xl bg-${themeColor}-50 border border-${themeColor}-100`}><div className="text-slate-800 text-[0.875em] font-medium leading-relaxed"><p>AI Feedback은 Gemini 웹페이지에서만 작용하기 때문에 Github 웹페이지에서 사용할 수 없어요.</p><p className="text-slate-500 text-[0.75em] mt-1 mb-[1em]">AI Feedback only works on the Gemini webpage, so it cannot be used on the GitHub webpage.</p><p className="flex flex-wrap items-center gap-1">AI Feedback 기능을 사용하기 원할 경우, 다음 링크를 클릭하세요: <a href="https://gemini.google.com/share/2fbb87e8b5ec" target="_blank" rel="noopener noreferrer" className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-0.5`}>Gemini AI Feedback<ExternalLinkIcon className="w-[0.75em] h-[0.75em]" /></a></p><p className="text-slate-500 text-[0.75em] mt-1 flex flex-wrap items-center gap-1">To use the AI feedback feature, please click the following link: <a href="https://gemini.google.com/share/2fbb87e8b5ec" target="_blank" rel="noopener noreferrer" className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-0.5`}>Gemini AI Feedback<ExternalLinkIcon className="w-[0.75em] h-[0.75em]" /></a></p></div></div>
                    <div className="space-y-[2em]">{QUESTIONS.map((q) => (<div key={q.id} className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[1.5em] md:p-[2em]"><div className="mb-[1.5em]"><h3 className="text-[1.25em] font-bold text-slate-900 mb-[0.5em]">{q.id}. {q.question}</h3>{showTranslations[q.id] && (<p className="text-slate-500 text-[0.875em] mb-[0.75em] animate-fade-in font-medium">{q.translation}</p>)}<button onClick={() => toggleTranslation(q.id)} className="inline-flex items-center gap-[0.25em] text-[0.625em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"><TranslateIcon className="w-[0.75em] h-[0.75em]" /><span>{showTranslations[q.id] ? '번역 숨기기 (Hide)' : '번역 (Translation)'}</span></button></div><FeedbackSection themeColor={themeColor} question={q.question} value={answers[q.id] || ''} onChange={(e) => handleAnswerChange(q.id, e.target.value)} placeholder="여기에 답변을 입력하세요 (Type your response here)" keyPhrases={renderKeyPhrases(q.keyPhrases)} /></div>))}</div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home'); const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false); const [userLevel, setUserLevel] = useState("A1+"); const [autoScroll, setAutoScroll] = useState(true); const [showVocab, setShowVocab] = useState(false); const [playbackRate, setPlaybackRate] = useState(1.0); const [progress, setProgress] = useState({ learn: [false, false], vocab: false, quiz: 0, discuss: false });
            const themeColor = useMemo(() => getLevelTheme(userLevel), [userLevel]);
            const currentThemeHex = { 'lime': '#84cc16', 'green': '#22c55e', 'sky': '#0ea5e9', 'blue': '#3b82f6', 'fuchsia': '#d946ef', 'purple': '#a855f7' }[themeColor] || '#22c55e';
            const updateProgress = (key, value) => { setProgress(prev => { if (key === 'learn') { const newLearn = [...prev.learn]; newLearn[value] = true; return { ...prev, learn: newLearn }; } if (prev[key] === (value ?? true)) return prev; return { ...prev, [key]: value ?? true }; }); };
            const handleSpeedChange = (e) => { setPlaybackRate(parseFloat(e.target.value)); };
            const mainPaddingClass = useMemo(() => { switch(activeTab) { case 'home': return 'p-[20px]'; case 'learn': return 'p-[2px]'; case 'vocab': return 'p-[16px]'; case 'quiz': return 'p-[4px]'; case 'discuss': return 'p-[2px]'; default: return 'p-[20px]'; } }, [activeTab]);
            useEffect(() => { const handleResize = () => { if (window.innerWidth < 1024) setIsSidebarCollapsed(true); else setIsSidebarCollapsed(false); }; window.addEventListener('resize', handleResize); handleResize(); return () => window.removeEventListener('resize', handleResize); }, []);
            const toggleSidebar = () => setIsSidebarCollapsed(!isSidebarCollapsed);
            const setCollapseManual = (collapsed) => setIsSidebarCollapsed(collapsed);
            const sidebarWidthClass = isSidebarCollapsed ? 'md:ml-[5.5rem]' : 'md:ml-[18.5rem]';
            const headerLeftClass = isSidebarCollapsed ? 'md:left-[5.5rem]' : 'md:left-[18.5rem]';

            const renderHeader = () => {
                if (activeTab === 'learn') {
                    return (
                        <div className="flex items-center justify-between h-full px-6 border-b border-gray-100 bg-white/90 backdrop-blur"><div className="flex items-center gap-3"><div className={`p-2 rounded-lg bg-${themeColor}-50`}><LearnIcon className={`w-5 h-5 text-${themeColor}-600`} /></div><div className="flex flex-col"><h1 className="text-lg font-bold text-slate-900 font-cafe24-surround leading-none">동영상 & 스크립트</h1><span className="text-[11px] font-bold text-slate-400 leading-none mt-1 font-cafe24-surround">Video & Transcript</span></div></div><div className="flex items-center gap-4"><div className="flex items-center gap-2 cursor-pointer group" onClick={() => setAutoScroll(!autoScroll)}><div className={`w-9 h-5 rounded-full relative transition-colors duration-200 ease-in-out ${autoScroll ? `bg-${themeColor}-500` : 'bg-gray-300'}`}><div className={`absolute top-1 w-3 h-3 bg-white rounded-full shadow-sm transition-transform duration-200 ${autoScroll ? 'left-5' : 'left-1'}`}></div></div><span className="text-sm font-bold text-slate-600 group-hover:text-slate-800 transition-colors whitespace-nowrap hidden sm:inline">Auto Scroll</span></div><div className="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200"><SpeedSolidIcon className="w-4 h-4 text-slate-500" /><div className="flex items-center gap-2"><span className="text-[10px] font-medium text-slate-400">0.5x</span><input type="range" min="0.5" max="1.0" step="0.01" value={playbackRate} onChange={handleSpeedChange} className="w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer" style={{ '--thumb-color': currentThemeHex }} /><span className="text-[10px] font-medium text-slate-400">1.0x</span></div><span className={`text-xs font-bold text-${themeColor}-700 min-w-[2.5rem] text-center`}>{playbackRate.toFixed(2)}x</span></div><button onClick={() => setShowVocab(!showVocab)} className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all shadow-sm ${showVocab ? 'bg-gray-100 border-gray-300' : 'bg-white border-gray-200 hover:bg-gray-50'}`}><OpenBookSolidIcon className="w-4 h-4 text-slate-600" /><span className="text-sm font-bold text-slate-700 whitespace-nowrap hidden sm:inline">Vocabulary</span></button></div></div>
                    );
                }
                return null;
            };

            const renderContent = () => {
                switch(activeTab) {
                    case 'home': return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                    case 'learn': return <LearnView updateProgress={(videoIdx) => updateProgress('learn', videoIdx)} themeColor={themeColor} autoScroll={autoScroll} showVocab={showVocab} playbackRate={playbackRate} watchedVideos={progress.learn} />;
                    case 'vocab': return <VocabView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'quiz': return <QuizView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'discuss': return <DiscussView updateProgress={updateProgress} themeColor={themeColor} />;
                    default: return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                }
            };

            return (
                <div className="flex min-h-screen bg-[#f9fafb]">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} isCollapsed={isSidebarCollapsed} toggleSidebar={toggleSidebar} userLevel={userLevel} themeColor={themeColor} setCollapseManual={setCollapseManual} />
                    <div className={`flex-1 flex flex-col transition-all duration-300 ease-in-out ${sidebarWidthClass}`}><header className={`h-16 bg-white sticky top-0 z-40 transition-all duration-300 ${headerLeftClass}`}>{renderHeader()}</header><main className={`flex-1 ${mainPaddingClass} overflow-hidden flex flex-col`}>{renderContent()}</main></div>
                    <nav className="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-3 z-50">{['home','learn','vocab','quiz','discuss'].map(t=><button key={t} onClick={()=>setActiveTab(t)} className={`p-2 rounded-lg ${activeTab===t ? `text-${themeColor}-600 bg-${themeColor}-50` : 'text-slate-400'}`}>{t==='home'?<HomeIcon className="w-6 h-6"/>:t==='learn'?<LearnIcon className="w-6 h-6"/>:t==='vocab'?<VocabIcon className="w-6 h-6"/>:t==='quiz'?<QuizIcon className="w-6 h-6"/>:<DiscussIcon className="w-6 h-6"/>}</button>)}</nav>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
