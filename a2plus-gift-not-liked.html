<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKoreanLearningLab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- 폰트 링크: IBM Plex Sans KR, Jua, Noto Sans KR, Sunflower -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&family=Jua&family=Noto+Sans+KR:wght@400;500;700;900&family=Sunflower:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        /* NoonnuBasicGothic (기본 글꼴) */
        @font-face {
            font-family: 'NoonnuBasicGothic';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noon-2410@1.0/NoonnuBasicGothicRegular.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        
        /* ROOT FONT SIZE: 
           Base value (1.0x) = clamp(12px, 1vw, 16px)
           This makes 1rem fluid based on viewport width.
        */
        :root {
            --base-size: clamp(12px, 1vw, 16px);
        }
        html { 
            font-size: var(--base-size); 
        }

        /* 기본 글꼴 설정 */
        body { font-family: 'NoonnuBasicGothic', sans-serif; background-color: #f9fafb; color: #334155; }
        
        /* 사용자 지정 폰트 유틸리티 클래스 */
        .font-basic { font-family: 'NoonnuBasicGothic', sans-serif; }
        .font-jua { font-family: 'Jua', sans-serif; }
        .font-noto { font-family: 'Noto Sans KR', sans-serif; }
        .font-sunflower { font-family: 'Sunflower', sans-serif; }
        
        /* Cafe24SurroundAir 폰트 추가 (사이드바 기본) */
        @font-face {
            font-family: 'Cafe24SurroundAir';
            src: url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24SsurroundAir.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        .font-cafe24 { font-family: 'Cafe24SurroundAir', sans-serif; }

        /* Cafe24Surround 폰트 추가 (타이틀용, 사이드바 선택됨) */
        @font-face {
            font-family: 'Cafe24Surround';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24Ssurround.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        .font-cafe24-surround { font-family: 'Cafe24Surround', sans-serif; }

        /* Cafe24Decoshadow 폰트 추가 (로고용 1) */
        @font-face {
            font-family: 'Cafe24Decoshadow';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoshadow.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-cafe24-deco { font-family: 'Cafe24Decoshadow', sans-serif; }

        /* Cafe24Decoschool 폰트 추가 (로고용 2) */
        @font-face {
            font-family: 'Cafe24Decoschool';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoschool.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-cafe24-school { font-family: 'Cafe24Decoschool', sans-serif; }

        /* Cafe24Anemone 폰트 추가 (프로필 텍스트용) */
        @font-face {
            font-family: 'Cafe24Anemone';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/Cafe24Ohsquare.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        .font-cafe24-anemone { font-family: 'Cafe24Anemone', sans-serif; }

        /* SchoolSafetyRoundedSmile 폰트 추가 (레벨 박스 텍스트, 팟캐스트 태그용) */
        @font-face {
            font-family: 'SchoolSafetyRoundedSmile';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-R.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'SchoolSafetyRoundedSmile';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-B.woff2') format('woff2');
            font-weight: 700;
            font-display: swap;
        }
        .font-school-smile { font-family: 'SchoolSafetyRoundedSmile', sans-serif; }

        /* SchoolSafetyFreeTime 폰트 추가 (필요시 사용) */
        @font-face {
            font-family: 'SchoolSafetyFreeTime';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2508-2@1.0/HakgyoansimJayusiganR.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        .font-school-free { font-family: 'SchoolSafetyFreeTime', sans-serif; }

        /* Juache 폰트 추가 (카테고리 태그용) */
        @font-face {
            font-family: 'Juache';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        .font-juache { font-family: 'Juache', sans-serif; }

        /* SchoolSafetyOcarina (단어용) */
        @font-face {
            font-family: 'SchoolSafetyOcarina';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/HakgyoansimOcarinaR.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-ocarina { font-family: 'SchoolSafetyOcarina', sans-serif; }

        /* SchoolSafetyPictureDiary (뜻풀이용) */
        @font-face {
            font-family: 'SchoolSafetyPictureDiary';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimGeurimilgiTTF-R.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-diary { font-family: 'SchoolSafetyPictureDiary', sans-serif; }

        /* SchoolSafeBoardMarker (예문 한국어용) */
        @font-face {
            font-family: 'SchoolSafeBoardMarker';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/HakgyoansimBoadmarkerR.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-marker { font-family: 'SchoolSafeBoardMarker', sans-serif; }

        /* SchoolSafeDictation (관련 표현 설명용) */
        @font-face {
            font-family: 'SchoolSafeDictation';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimBadasseugiTTF-L.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        .font-dictation { font-family: 'SchoolSafeDictation', sans-serif; }

        /* Cafe24Gowoonbam (예문 영어용) */
        @font-face {
            font-family: 'Cafe24Gowoonbam';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_twelve@1.1/Cafe24Oneprettynight.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        .font-gowoonbam { font-family: 'Cafe24Gowoonbam', sans-serif; }

        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 0.375rem; height: 0.375rem; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 0.2rem; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* 애니메이션 */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(0.625rem); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

        /* Range Slider Custom Style */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 1rem;
            width: 1rem;
            border-radius: 50%;
            background: var(--thumb-color, #22c55e); /* 동적 색상을 위해 CSS 변수 사용 */
            cursor: pointer;
            margin-top: -0.375rem;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 0.25rem;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        const { createPortal } = ReactDOM;

        // --- Data: Level Definitions & Styles ---
        const LEVEL_DEFINITIONS = {
            "A1": { title: "Novice", desc: "Can use and understand very simple everyday expressions. Can introduce themselves, ask and answer basic questions (name, age, where they live, etc.)." },
            "A1+": { title: "Pre-Beginner", desc: "Still beginner, but can handle slightly more than A1: simple short conversations about familiar topics if the other person speaks slowly and clearly." },
            "A2": { title: "Beginner", desc: "Can understand frequently used sentences (family, shopping, work, hobbies). Can handle simple routine tasks and short social exchanges." },
            "A2+": { title: "Upper Beginner", desc: "Between A2 and B1. Can speak a bit more smoothly about daily life, give simple opinions, and manage short conversations with some support." },
            "B1": { title: "Pre-Intermediate", desc: "Can understand the main points of clear standard speech or texts on familiar topics (school, work, leisure). Can describe experiences, plans, and briefly explain opinions." },
            "B1+": { title: "Lower Intermediate", desc: "Stronger B1. More comfortable carrying conversations, handling some unexpected situations, and linking ideas more coherently, but still with gaps." },
            "B2": { title: "Intermediate", desc: "Can understand the main ideas of complex texts, interact quite fluently with natives, and produce clear, detailed speech and writing on many topics." },
            "B2+": { title: "Upper Intermediate", desc: "Near C1. Can argue a point logically, follow more abstract discussions, and use a wide range of vocabulary with fewer mistakes, though not fully “advanced”." },
            "C1": { title: "Advanced", desc: "Can understand long, demanding texts and implied meanings; express ideas fluently and spontaneously; use language flexibly in academic, professional, and social settings." },
            "C1+": { title: "Upper Advanced", desc: "Very strong C1, approaching native-like flexibility. Still occasional non-native patterns, but can operate comfortably in almost all situations." },
            "C2": { title: "Proficient", desc: "Can understand virtually everything heard or read; express themselves very precisely, subtly, and naturally, even in complex, nuanced situations." }
        };

        // Helper to determine color theme based on level
        const getLevelTheme = (level) => {
            switch (level) {
                case 'A1':
                case 'A1+': return 'lime';
                case 'A2':
                case 'A2+': return 'green';
                case 'B1':
                case 'B1+': return 'sky';
                case 'B2':
                case 'B2+': return 'blue';
                case 'C1':
                case 'C1+': return 'fuchsia';
                case 'C2': return 'purple';
                default: return 'green';
            }
        };

        const LEVEL_STYLES = {
            "A1": "bg-lime-50 text-lime-600 border-lime-100", 
            "A1+": "bg-lime-50 text-lime-600 border-lime-100", 
            "A2": "bg-green-50 text-green-600 border-green-100",    
            "A2+": "bg-green-50 text-green-600 border-green-100",    
            "B1": "bg-sky-50 text-sky-600 border-sky-100",        
            "B1+": "bg-sky-50 text-sky-600 border-sky-100",        
            "B2": "bg-blue-50 text-blue-600 border-blue-100", 
            "B2+": "bg-blue-50 text-blue-600 border-blue-100", 
            "C1": "bg-fuchsia-50 text-fuchsia-600 border-fuchsia-100", 
            "C1+": "bg-fuchsia-50 text-fuchsia-600 border-fuchsia-100", 
            "C2": "bg-purple-50 text-purple-700 border-purple-100",        
        };

        const LEVEL_OPTIONS = ["A1", "A1+", "A2", "A2+", "B1", "B1+", "B2", "B2+", "C1", "C1+", "C2"];

        // --- Icons ---
        const HomeIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                <path d="M8 21h8" />
                <path d="M12 17v4" />
            </svg>
        );
        const DashboardIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"/></svg>);
        const LearnIcon = ({ className, filled }) => (
            <svg 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="1.8" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {/* 박스: filled가 true면 currentColor로 채움, 아니면 투명 */}
                <rect x="2" y="4" width="20" height="16" rx="4" fill={filled ? "currentColor" : "none"} />
                
                {/* 플레이 버튼(삼각형): filled가 true면 흰색(#fff), 아니면 currentColor(테두리) */}
                <polygon points="10 8 16 12 10 16 10 8" stroke={filled ? "#fff" : "currentColor"} fill={filled ? "#fff" : "none"} />
            </svg>
        );
        const VocabIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <path d="M3.5 12.5 12.5 3.5h6a2 2 0 0 1 2 2v6l-9 9a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8Z" stroke="currentColor" strokeWidth="1.8"/>
                <path d="M16.5 7.5h.01" stroke="currentColor" strokeWidth="3.2" strokeLinecap="round"/>
            </svg>
        );
        const QuizIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.8"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M12 17h.01" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );
        const DiscussIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <path d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-2v3l-4.5-3H6a3 3 0 0 1-3-3V6Z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round"/>
                <path d="M7 8h10M7 12h7" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/>
            </svg>
        );
        const UserIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>);
        const QuizHeaderIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.8"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M12 17h.01" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );
        const VocabHeaderIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <path d="M3.5 12.5 12.5 3.5h6a2 2 0 0 1 2 2v6l-9 9a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8Z" stroke="currentColor" strokeWidth="1.8"/>
                <path d="M16.5 7.5h.01" stroke="currentColor" strokeWidth="3.2" strokeLinecap="round"/>
            </svg>
        );
        const DiscussHeaderIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className}>
                <path d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-2v3l-4.5-3H6a3 3 0 0 1-3-3V6Z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round"/>
                <path d="M7 8h10M7 12h7" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/>
            </svg>
        );
        const LineIcon = ({ d, className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>);
        const PlayIconLine = (props) => <LineIcon {...props} d="M5 3l14 9-14 9V3z" />;
        
        // Vocabulary 버튼 아이콘 변경 (책 펼친 모양 + A/줄)
        const OpenBookSolidIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {/* Book Outline */}
                <path d="M2 6 C2 3 8 2 12 6 C16 2 22 3 22 6 V20 C22 17 16 16 12 20 C8 16 2 17 2 20 Z" />
                <path d="M12 6 V20" /> {/* Spine */}
                
                {/* Left Page: 'A' */}
                <path d="M4.5 15 L7 9 L9.5 15" strokeWidth="1.5" />
                <path d="M5.5 13 H8.5" strokeWidth="1.5" />
                
                {/* Right Page: Lines */}
                <path d="M15 10 H19" strokeWidth="1.5" />
                <path d="M15 13 H19" strokeWidth="1.5" />
                <path d="M15 16 H18" strokeWidth="1.5" />
            </svg>
        );
        
        // TranslateIcon을 Google Translate 스타일 아이콘으로 변경
        const TranslateIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.09-.02.67-.02zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z" />
            </svg>
        );

        // 외부 링크 아이콘 추가
        const ExternalLinkIcon = ({ className }) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                <polyline points="15 3 21 3 21 9" />
                <line x1="10" y1="14" x2="21" y2="3" />
            </svg>
        );

        const ChevronLeft = ({ className }) => <LineIcon d="m15 18-6-6 6-6" className={className}/>;
        const ChevronRight = ({ className }) => <LineIcon d="m9 18 6-6-6-6" className={className}/>;
        const SpeedSolidIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/></svg>);
        const SparklesIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 00-1.423 1.423z" /></svg>);

        // --- Component: Level Badge ---
        const LevelBadge = ({ levelCode }) => {
            const [isHovered, setIsHovered] = useState(false);
            const info = LEVEL_DEFINITIONS[levelCode] || LEVEL_DEFINITIONS["A2+"];
            
            const getLevelStyle = (code) => {
                if (LEVEL_STYLES[code]) return LEVEL_STYLES[code];
                const base = code.substring(0, 2);
                return LEVEL_STYLES[base] || "bg-gray-50 text-slate-600 border-gray-100";
            };
            
            const badgeStyle = getLevelStyle(levelCode);

            return (
                <div 
                    className="relative inline-flex items-center cursor-help z-50"
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                >
                    <span className={`px-2 py-0.5 rounded text-[0.625em] font-bold border uppercase tracking-wide shadow-sm font-sunflower ${badgeStyle}`}>
                        Level: {info.title}
                    </span>
                    {isHovered && (
                        <div className="absolute top-full left-0 mt-2 w-64 bg-slate-900/95 backdrop-blur text-white text-xs rounded-xl p-4 shadow-xl z-[100] animate-fade-in text-left">
                            <p className={`font-bold mb-1.5 text-sm ${badgeStyle.split(' ')[1]}`}>{levelCode} – {info.title}</p>
                            <p className="opacity-90 leading-relaxed font-medium">{info.desc}</p>
                            <div className="absolute -top-1 left-4 w-2 h-2 bg-slate-900/95 rotate-45"></div>
                        </div>
                    )}
                </div>
            );
        };

        const VOCAB_DATA = [
            {
                "term": "이 주제로 이야기해 봐요",
                "mainDef": "Let's Talk About This Topic.",
                "variants": ["이 주제로 이야기해 봐요"],
                "subDefs": [
                    { "subTerm": "▢▢을/를 주제로 이야기하다", "subDef": "to talk about [something] as a topic." },
                    { "subTerm": "-아/어 보다", "subDef": "used to make gentle suggestions without sounding pushy." }
                ],
                "examples": [
                    { "kor": "우리 이 주제로 이야기해 봐요.", "eng": "Let's talk about this topic." },
                    { "kor": "다음에는 다른 주제로 이야기해 봐요.", "eng": "Let's talk about a different topic next time." }
                ]
            },
            {
                "term": "동료",
                "mainDef": "Colleague; Co-worker.",
                "variants": ["동료", "동료가", "동료한테"],
                "subDefs": [],
                "examples": [
                    { "kor": "회사 동료와 점심을 먹었어요.", "eng": "I had lunch with my coworker." },
                    { "kor": "그 사람은 좋은 동료예요.", "eng": "He is a good colleague." }
                ]
            },
            {
                "term": "-이라는 뜻이에요",
                "mainDef": "It means that... (used to explain definition).",
                "variants": ["이라는 뜻이에요"],
                "subDefs": [],
                "examples": [
                    { "kor": "'동료'는 같이 일하는 사람이라는 뜻이에요.", "eng": "'동료' means a person you work with." },
                    { "kor": "이것은 ‘금지’라는 뜻이에요.", "eng": "This means prohibited." }
                ]
            },
            {
                "term": "마음에 안 들다",
                "mainDef": "To not like; to be not to one's liking.",
                "variants": ["마음에 안 들어요", "마음에 안 드는데", "마음에 안 드는"],
                "subDefs": [
                    { "subTerm": "-는데", "subDef": "used to show contrast, or set up background often softening the tone." }
                ],
                "examples": [
                    { "kor": "이 옷은 색깔이 마음에 안 들어요.", "eng": "I don't like the color of this clothes." },
                    { "kor": "선물이 마음에 안 드는데 어떻게 하죠?", "eng": "I don't like the gift, what should I do?" }
                ]
            },
            {
                "term": "-라는 뜻이에요",
                "mainDef": "It means that... (used to explain definition)",
                "variants": ["라는 뜻이에요"],
                "subDefs": [],
                "examples": [
                    { "kor": "'화려하다'는 색깔이 많다는 뜻이에요.", "eng": "'화려'하다 means there are many colors." },
                    { "kor": "이 표시는 '멈추세요'라는 뜻이에요.", "eng": "This sign means 'stop'." }
                ]
            },
            {
                "term": "화려하다",
                "mainDef": "To be fancy; colorful; flashy.",
                "variants": ["화려해요", "화려하다", "화려하고"],
                "subDefs": [],
                "examples": [
                    { "kor": "그 옷은 너무 화려해요.", "eng": "That dress is too fancy." },
                    { "kor": "화려한 도시의 밤을 좋아해요.", "eng": "I like the night of the flashy city." }
                ]
            },
            {
                "term": "색깔",
                "mainDef": "Color.",
                "variants": ["색깔이"],
                "subDefs": [],
                "examples": [
                    { "kor": "어떤 색깔을 좋아해요?", "eng": "What color do you like?" },
                    { "kor": "색깔이 아주 예뻐요.", "eng": "The color is very pretty." }
                ]
            },
            {
                "term": "밝다",
                "mainDef": "To be bright.",
                "variants": ["밝다"],
                "subDefs": [],
                "examples": [
                    { "kor": "방이 아주 밝아요.", "eng": "The room is very bright." },
                    { "kor": "내일은 날씨가 밝을 거예요.", "eng": "The weather will be bright (sunny) tomorrow." }
                ]
            },
            {
                "term": "그러면",
                "mainDef": "Then; in that case.",
                "variants": ["그러면"],
                "subDefs": [],
                "examples": [
                    { "kor": "비가 와요? 그러면 우산을 가져가세요.", "eng": "Is it raining? Then take an umbrella." },
                    { "kor": "그러면 우리 내일 만날까요?", "eng": "Then shall we meet tomorrow?" }
                ]
            },
            {
                "term": "-한테",
                "mainDef": "To (someone) - colloquial particle.",
                "variants": ["동료한테", "저한테"],
                "subDefs": [],
                "examples": [
                    { "kor": "친구한테 선물을 줬어요.", "eng": "I gave a gift to my friend." },
                    { "kor": "엄마한테 전화했어요.", "eng": "I called my mom." }
                ]
            },
            {
                "term": "바로",
                "mainDef": "Immediately; right away; straight.",
                "variants": ["바로"],
                "subDefs": [],
                "examples": [
                    { "kor": "지금 바로 갈게요.", "eng": "I'll go right away." },
                    { "kor": "집에 오자마자 바로 잤어요.", "eng": "I slept immediately after coming home." }
                ]
            },
            {
                "term": "교환하다",
                "mainDef": "To exchange.",
                "variants": ["교환할", "교환하다", "교환해서"],
                "subDefs": [
                    { "subTerm": "-ㄹ 수 있어요", "subDef": "can; to be able to." },
                    { "subTerm": "-아서/어서", "subDef": "It usually means 'because'; however, when it's used with verbs of movement or process (like 교환하다, 가다, 오다, 사다), it usually means 'and then' or 'by doing'." }
                ],
                "examples": [
                    { "kor": "이 옷을 다른 사이즈로 교환하고 싶어요.", "eng": "I want to exchange this clothes for a different size." },
                    { "kor": "가게에 가서 물건을 교환했어요.", "eng": "I went to the store and exchanged the item." }
                ]
            },
            {
                "term": "다른 것",
                "mainDef": "Something else; different thing.",
                "variants": ["다른 것", "다른 것으로"],
                "subDefs": [
                    { "subTerm": "다른", "subDef": "different." },
                    { "subTerm": "것", "subDef": "thing." }
                ],
                "examples": [
                    { "kor": "이거 말고 다른 것 주세요.", "eng": "Give me something else, not this." },
                    { "kor": "다른 것으로 보여 주세요.", "eng": "Please show me a different one." }
                ]
            },
            {
                "term": "그렇게",
                "mainDef": "Like that; in that way.",
                "variants": ["그렇게"],
                "subDefs": [],
                "examples": [
                    { "kor": "왜 그렇게 말해요?", "eng": "Why do you say it like that?" },
                    { "kor": "그렇게 하면 안 돼요.", "eng": "You shouldn't do it like that." }
                ]
            },
            {
                "term": "솔직하다",
                "mainDef": "To be honest; frank.",
                "variants": ["솔직한", "솔직하다", "솔직하게"],
                "subDefs": [],
                "examples": [
                    { "kor": "저는 솔직한 사람이 좋아요.", "eng": "I like honest people." },
                    { "kor": "솔직하게 말해 주세요.", "eng": "Please tell me honestly." }
                ]
            },
            {
                "term": "솔직한 게",
                "mainDef": "Being honest (is)...",
                "variants": ["솔직한 게"],
                "subDefs": [
                    { "subTerm": "-ㄴ/은/는 게", "subDef": "contraction of -ㄴ/은/는 것이." },
                    { "subTerm": "-ㄴ/은 것", "subDef": "used to nominalize verbs by turning a descriptive verb into a noun phrase meaning ‘the act of …,’ ‘the fact of …,’ or ‘the thing that …’" }
                ],
                "examples": [
                    { "kor": "솔직한 게 제일 좋아요.", "eng": "Being honest is the best." },
                    { "kor": "가끔은 솔직한 게 어려워요.", "eng": "Sometimes being honest is difficult." }
                ]
            },
            {
                "term": "제가 좋아하는 선물",
                "mainDef": "A gift that I like.",
                "variants": ["제가 좋아하는 선물을"],
                "subDefs": [
                    { "subTerm": "-는", "subDef": "used to turn a present-tense verb into an ‘adjective-ish’ phrase that describes the following noun." }
                ],
                "examples": [
                    { "kor": "이것은 제가 좋아하는 음식이에요.", "eng": "This is the food I like." },
                    { "kor": "제가 좋아하는 노래를 불렀어요.", "eng": "I sang a song I like." }
                ]
            },
            {
                "term": "상처받다",
                "mainDef": "To get hurt (emotionally).",
                "variants": ["상처받았을", "상처받다"],
                "subDefs": [
                    { "subTerm": "-았을/었을 거예요", "subDef": "must have been... (past conjecture)." }
                ],
                "examples": [
                    { "kor": "친구의 말에 상처받았어요.", "eng": "I was hurt by my friend's words." },
                    { "kor": "상처받지 마세요.", "eng": "Don't get hurt." }
                ]
            },
            {
                "term": "마음",
                "mainDef": "Heart; mind; sincerity.",
                "variants": ["마음이", "마음이에요", "마음", "마음이니까요"],
                "subDefs": [],
                "examples": [
                    { "kor": "제 마음을 받아 주세요.", "eng": "Please accept my heart." },
                    { "kor": "선물보다 마음이 중요해요.", "eng": "Sincerity is more important than gifts." }
                ]
            },
            {
                "term": "안 입을 옷",
                "mainDef": "Clothes (I) will not wear.",
                "variants": ["안 입을 옷을"],
                "subDefs": [
                    { "subTerm": "-ㄹ/을", "subDef": "used to turn a future-tense verb into an ‘adjective-ish’ phrase that describes the following noun" }
                ],
                "examples": [
                    { "kor": "이것은 제가 안 입을 옷이에요.", "eng": "These are clothes I won't wear." },
                    { "kor": "안 먹을 음식을 시키지 마세요.", "eng": "Don't order food you won't eat." }
                ]
            },
            {
                "term": "마음에 드는 걸",
                "mainDef": "Something (I) like.",
                "variants": ["마음에 드는 걸"],
                "subDefs": [
                    { "subTerm": "-는 걸", "subDef": "contraction of -는 것을." },
                    { "subTerm": "-는 것", "subDef": "used to nominalize verbs by turning a verb into a noun phrase meaning ‘the act of …,’ ‘the fact of …,’ or ‘the thing that …’" }
                ],
                "examples": [
                    { "kor": "마음에 드는 걸 고르세요.", "eng": "Choose something you like." },
                    { "kor": "저는 마음에 드는 걸 샀어요.", "eng": "I bought something I liked." }
                ]
            },
            {
                "term": "받는 게",
                "mainDef": "Receiving (is)...",
                "variants": ["받는 게"],
                "subDefs": [
                    { "subTerm": "-ㄴ/은/는 게", "subDef": "contraction of -ㄴ/은/는 것이." },
                    { "subTerm": "-는 것", "subDef": "used to nominalize verbs by turning a verb into a noun phrase meaning ‘the act of …,’ ‘the fact of …,’ or ‘the thing that …’" }
                ],
                "examples": [
                    { "kor": "선물을 받는 게 주는 것보다 좋아요?", "eng": "Is receiving gifts better than giving them?" },
                    { "kor": "사랑을 받는 게 행복해요.", "eng": "Receiving love makes me happy." }
                ]
            },
            {
                "term": "그래도",
                "mainDef": "Even so; nevertheless; still.",
                "variants": ["그래도"],
                "subDefs": [],
                "examples": [
                    { "kor": "비가 와요. 그래도 갈 거예요.", "eng": "It's raining. Even so, I will go." },
                    { "kor": "힘들어요. 그래도 포기하지 않아요.", "eng": "It's hard. Still, I don't give up." }
                ]
            },
            {
                "term": "직접 말하면 안 돼요",
                "mainDef": "You shouldn't say it directly.",
                "variants": ["직접 말하면 안 돼요"],
                "subDefs": [
                    { "subTerm": "직접 말하다", "subDef": "to say directly/personally." },
                    { "subTerm": "-면 안 돼요", "subDef": "should not; must not." }
                ],
                "examples": [
                    { "kor": "상사에게 직접 말하면 안 돼요.", "eng": "You shouldn't say it directly to the boss." },
                    { "kor": "비밀을 말하면 안 돼요.", "eng": "You shouldn't tell the secret." }
                ]
            },
            {
                "term": "서운하다",
                "mainDef": "To feel sorry/sad/disappointed (about something missing or lacking).",
                "variants": ["서운했을", "서운하다"],
                "subDefs": [
                    { "subTerm": "-았을/었을 거예요", "subDef": "must have been... (past conjecture)." }
                ],
                "examples": [
                    { "kor": "친구가 안 와서 서운했어요.", "eng": "I was sad because my friend didn't come." },
                    { "kor": "네가 가면 서운할 거야.", "eng": "I'll be sad if you leave." }
                ]
            },
            {
                "term": "아쉽다",
                "mainDef": "To be regretful; sorry (that something is over or lacking).",
                "variants": ["아쉽다"],
                "subDefs": [],
                "examples": [
                    { "kor": "벌써 헤어져야 해서 아쉬워요.", "eng": "I'm sorry we have to part already." },
                    { "kor": "이번 여행은 조금 아쉬웠어요.", "eng": "This trip was a bit regretful (left something to be desired)." }
                ]
            },
            {
                "term": "평생",
                "mainDef": "Lifetime; forever; one's whole life.",
                "variants": ["평생"],
                "subDefs": [],
                "examples": [
                    { "kor": "평생 함께 하고 싶어요.", "eng": "I want to be together forever." },
                    { "kor": "그 기억은 평생 남을 거예요.", "eng": "That memory will remain for a lifetime." }
                ]
            },
            {
                "term": "못생긴",
                "mainDef": "Ugly.",
                "variants": ["못생긴"],
                "subDefs": [
                    { "subTerm": "못생기다", "subDef": "to be ugly." },
                    { "subTerm": "-ㄴ/은", "subDef": "used to turn a descriptive verb, which means an adjective in English, into an ‘adjective-ish’ phrase that describes the following noun" }
                ],
                "examples": [
                    { "kor": "못생긴 인형이 귀여워요.", "eng": "The ugly doll is cute." },
                    { "kor": "저는 못생긴 옷은 싫어요.", "eng": "I don't like ugly clothes." }
                ]
            },
            {
                "term": "간직하다",
                "mainDef": "To keep; to cherish; to treasure.",
                "variants": ["간직해요", "간직하다", "간직하세요", "간직하고", "간직하는"],
                "subDefs": [],
                "examples": [
                    { "kor": "이 사진을 영원히 간직할게요.", "eng": "I will cherish this photo forever." },
                    { "kor": "추억을 마음에 간직하세요.", "eng": "Please keep the memories in your heart." }
                ]
            },
            {
                "term": "입기 싫으면",
                "mainDef": "If you don't want to wear (it).",
                "variants": ["입기 싫으면"],
                "subDefs": [
                    { "subTerm": "-기 싫다", "subDef": "to hate doing; not want to do." },
                    { "subTerm": "-면/으면", "subDef": "if." }
                ],
                "examples": [
                    { "kor": "먹기 싫으면 남기세요.", "eng": "If you don't want to eat, leave it." },
                    { "kor": "가기 싫으면 집에 있어요.", "eng": "If you don't want to go, stay at home." }
                ]
            },
            {
                "term": "안 입어도 돼요",
                "mainDef": "You don't have to wear (it).",
                "variants": ["안 입어도 돼요"],
                "subDefs": [
                    { "subTerm": "-아도/어도 돼요", "subDef": "it is okay to...; don't have to..." }
                ],
                "examples": [
                    { "kor": "숙제를 오늘 안 해도 돼요.", "eng": "You don't have to do homework today." },
                    { "kor": "돈을 안 내도 돼요.", "eng": "You don't have to pay." }
                ]
            },
            {
                "term": "버리지 말고",
                "mainDef": "Don't throw (it) away, and...",
                "variants": ["버리지 말고"],
                "subDefs": [
                    { "subTerm": "버리다", "subDef": "to throw away." },
                    { "subTerm": "-지 말고", "subDef": "don't do... but..." }
                ],
                "examples": [
                    { "kor": "쓰레기를 길에 버리지 말고 휴지통에 넣으세요.", "eng": "Don't throw trash on the street, put it in the bin." },
                    { "kor": "포기하지 말고 계속하세요.", "eng": "Don't give up and keep going." }
                ]
            },
            {
                "term": "마음이니까요",
                "mainDef": "Because it is (the) heart/sincerity.",
                "variants": ["마음이니까요"],
                "subDefs": [
                    { "subTerm": "-니까요/이니까요", "subDef": "because it is..." }
                ],
                "examples": [
                    { "kor": "왜냐하면 친구니까요.", "eng": "Because we are friends." },
                    { "kor": "오늘은 휴일이니까요.", "eng": "Because today is a holiday." }
                ]
            },
            {
                "term": "필요 없어요",
                "mainDef": "(I) don't need (it); It's unnecessary.",
                "variants": ["필요 없어요"],
                "subDefs": [],
                "examples": [
                    { "kor": "더 이상 필요 없어요.", "eng": "I don't need it anymore." },
                    { "kor": "도움은 필요 없어요.", "eng": "I don't need help." }
                ]
            },
            {
                "term": "그렇게 말하면",
                "mainDef": "If (you) say it like that.",
                "variants": ["그렇게 말하면"],
                "subDefs": [],
                "examples": [
                    { "kor": "그렇게 말하면 섭섭해요.", "eng": "I'm sad if you say it like that." },
                    { "kor": "그렇게 말하면 오해가 생길 수 있어요.", "eng": "If you speak like that, misunderstandings can arise." }
                ]
            },
            {
                "term": "관계가 나쁘다",
                "mainDef": "The relationship is bad.",
                "variants": ["관계가 나빠질", "관계가 나쁘다"],
                "subDefs": [
                    { "subTerm": "-ㄹ 수 있어요", "subDef": "can; might." }
                ],
                "examples": [
                    { "kor": "그 두 사람은 관계가 나빠요.", "eng": "Those two have a bad relationship." },
                    { "kor": "관계가 나빠지지 않게 조심하세요.", "eng": "Be careful not to let the relationship get bad." }
                ]
            },
            {
                "term": "사이",
                "mainDef": "Relationship; between.",
                "variants": ["사이가"],
                "subDefs": [],
                "examples": [
                    { "kor": "우리는 사이가 좋아요.", "eng": "We have a good relationship." },
                    { "kor": "친구 사이에는 비밀이 없어요.", "eng": "There are no secrets between friends." }
                ]
            },
            {
                "term": "중고마켓",
                "mainDef": "Second-hand market (e.g., Flea market app).",
                "variants": ["중고마켓", "중고마켓에"],
                "subDefs": [],
                "examples": [
                    { "kor": "안 쓰는 물건을 중고마켓에 팔았어요.", "eng": "I sold unused items on the second-hand market." },
                    { "kor": "중고마켓에서 책을 샀어요.", "eng": "I bought a book at the second-hand market." }
                ]
            },
            {
                "term": "그 돈으로",
                "mainDef": "With that money.",
                "variants": ["그 돈으로"],
                "subDefs": [
                    { "subTerm": "-으로/로", "subDef": "instrumental particle (with, by means of)." }
                ],
                "examples": [
                    { "kor": "그 돈으로 맛있는 것을 사 먹었어요.", "eng": "I bought and ate something delicious with that money." },
                    { "kor": "버스로 갈까요?", "eng": "Shall we go by bus?" }
                ]
            },
            {
                "term": "맛있는 치킨",
                "mainDef": "Delicious chicken.",
                "variants": ["맛있는 치킨을"],
                "subDefs": [
                    { "subTerm": "-는", "subDef": "used to turn a descriptive verb, which means an adjective in English, into an ‘adjective-ish’ phrase that describes the following noun." },
                    { "subTerm": "치킨", "subDef": "fried chicken." }
                ],
                "examples": [
                    { "kor": "저녁에 맛있는 치킨을 먹고 싶어요.", "eng": "I want to eat delicious chicken for dinner." },
                    { "kor": "한국 치킨은 정말 맛있어요.", "eng": "Korean chicken is really delicious." }
                ]
            },
            {
                "term": "사 먹을 거예요",
                "mainDef": "Will buy and eat.",
                "variants": ["사 먹을 거예요"],
                "subDefs": [
                    { "subTerm": "사 먹다", "subDef": "to buy and eat." }
                ],
                "examples": [
                    { "kor": "배가 고파서 빵을 사 먹을 거예요.", "eng": "I'm hungry so I will buy and eat bread." },
                    { "kor": "나중에 맛있는 밥을 사 먹자.", "eng": "Let's buy and eat a delicious meal later." }
                ]
            },
            {
                "term": "입어 봤어요?",
                "mainDef": "Have you tried wearing (it)?",
                "variants": ["입어 봤어요"],
                "subDefs": [
                    { "subTerm": "-아/어 봤어요?", "subDef": "have you tried…?; used to express past experience" }
                ],
                "examples": [
                    { "kor": "이 신발 신어 봤어요?", "eng": "Have you tried wearing these shoes?" },
                    { "kor": "한국 김치를 먹어 봤어요?", "eng": "Have you tried eating Korean kimchi?" }
                ]
            },
            {
                "term": "-라고 물어보다",
                "mainDef": "To ask \"...\".",
                "variants": ["라고 물어보면"],
                "subDefs": [
                    { "subTerm": "-면", "subDef": "if." }
                ],
                "examples": [
                    { "kor": "선생님에게 숙제가 뭐냐고 물어봤어요.", "eng": "I asked the teacher what the homework was." },
                    { "kor": "길을 모르면 사람들에게 물어보세요.", "eng": "If you don't know the way, ask people." }
                ]
            },
            {
                "term": "아까워서",
                "mainDef": "Because it's a waste/too precious.",
                "variants": ["아까워서"],
                "subDefs": [
                    { "subTerm": "아깝다", "subDef": "to be a waste; to be precious." },
                    { "subTerm": "-아서/어서", "subDef": "used to connect clauses indicating cause or reason (‘because…’, ‘therefore…’)." }
                ],
                "examples": [
                    { "kor": "시간이 아까워서 택시를 탔어요.", "eng": "I took a taxi because time was precious." },
                    { "kor": "음식이 남아서 아까워요.", "eng": "It's a waste because food is left over." }
                ]
            },
            {
                "term": "착한 거짓말",
                "mainDef": "White lie; Good lie.",
                "variants": ["착한 거짓말을"],
                "subDefs": [
                    { "subTerm": "착한", "subDef": "kind; good." },
                    { "subTerm": "거짓말", "subDef": "lie." }
                ],
                "examples": [
                    { "kor": "때로는 착한 거짓말이 필요해요.", "eng": "Sometimes a white lie is necessary." },
                    { "kor": "친구를 위해 착한 거짓말을 했어요.", "eng": "I told a white lie for my friend." }
                ]
            },
            {
                "term": "뻔뻔하다",
                "mainDef": "To be shameless; brazen.",
                "variants": ["뻔뻔하네요", "뻔뻔하다"],
                "subDefs": [
                    { "subTerm": "-네요", "subDef": "When you want to express 'Wow' or show that you are impressed/surprised by what you just saw or heard; (in this context) \"Wow, I just realized that you are truly shameless!\"." }
                ],
                "examples": [
                    { "kor": "그 사람은 정말 뻔뻔해요.", "eng": "That person is really shameless." },
                    { "kor": "거짓말을 하고도 뻔뻔하게 웃어요.", "eng": "He lies and yet laughs shamelessly." }
                ]
            },
            {
                "term": "부끄러워하다",
                "mainDef": "To feel ashamed; to be shy.",
                "variants": ["부끄러워하지"],
                "subDefs": [
                    { "subTerm": "부끄러워하지 않다", "subDef": "To not be shy, have no shame." }
                ],
                "examples": [
                    { "kor": "실수를 부끄러워하지 마세요.", "eng": "Don't be ashamed of mistakes." },
                    { "kor": "그는 낯선 사람 앞에서 부끄러워해요.", "eng": "He feels shy in front of strangers." }
                ]
            },
            {
                "term": "제일 좋은 방법",
                "mainDef": "The best method/way.",
                "variants": ["제일 좋은 방법은"],
                "subDefs": [
                    { "subTerm": "좋은", "subDef": "good." },
                    { "subTerm": "방법", "subDef": "method; way." }
                ],
                "examples": [
                    { "kor": "이것이 문제를 해결하는 제일 좋은 방법이에요.", "eng": "This is the best way to solve the problem." },
                    { "kor": "건강을 유지하는 제일 좋은 방법은 운동이에요.", "eng": "The best way to stay healthy is exercise." }
                ]
            },
            {
                "term": "간직하는 거예요",
                "mainDef": "(The best way) is to keep it.",
                "variants": ["간직하는 거예요"],
                "subDefs": [
                    { "subTerm": "간직하다", "subDef": "to keep; to cherish." },
                    { "subTerm": "-는 거예요", "subDef": "used to explain, clarify, or emphasize what something really is; ‘it is that … (explaining)’, ‘the fact is that … (explaining)’, or ‘what … means is … (explaining)." }
                ],
                "examples": [
                    { "kor": "비밀을 간직하는 것은 중요해요.", "eng": "Keeping a secret is important." },
                    { "kor": "추억을 사진으로 간직하는 거예요.", "eng": "It's about keeping memories in photos." }
                ]
            },
            {
                "term": "기분 좋다",
                "mainDef": "To feel good.",
                "variants": ["기분 좋고"],
                "subDefs": [],
                "examples": [
                    { "kor": "날씨가 좋아서 기분이 좋아요.", "eng": "I feel good because the weather is nice." },
                    { "kor": "칭찬을 들으면 기분이 좋아요.", "eng": "I feel good when I hear compliments." }
                ]
            },
            {
                "term": "거짓말을 안 해도 돼요",
                "mainDef": "(You) don't have to lie.",
                "variants": ["거짓말을 안 해도 돼요"],
                "subDefs": [
                    { "subTerm": "거짓말을 하다", "subDef": "to lie." },
                    { "subTerm": "-아도/어도 돼요", "subDef": "it's okay to...; don't have to..." }
                ],
                "examples": [
                    { "kor": "서두르지 않아도 돼요.", "eng": "You don't have to hurry." },
                    { "kor": "다 먹지 않아도 돼요.", "eng": "You don't have to eat it all." }
                ]
            },
            {
                "term": "화려하고 못생긴 티셔츠",
                "mainDef": "Flashy and ugly t-shirt.",
                "variants": ["화려하고 못생긴 티셔츠는"],
                "subDefs": [
                    { "subTerm": "화려하다", "subDef": "to be flashy." },
                    { "subTerm": "못생기다", "subDef": "to be ugly." },
                    { "subTerm": "-ㄴ/은", "subDef": "used to turn a descriptive verb, which means an adjective in English, into an ‘adjective-ish’ phrase that describes the following noun" }
                ],
                "examples": [
                    { "kor": "화려하고 예쁜 옷을 입고 싶어요.", "eng": "I want to wear flashy and pretty clothes." },
                    { "kor": "못생긴 과일이 더 맛일을 때가 있어요.", "eng": "Sometimes ugly fruits taste better." }
                ]
            },
            {
                "term": "분위기",
                "mainDef": "Atmosphere; vibe.",
                "variants": ["분위기를"],
                "subDefs": [],
                "examples": [
                    { "kor": "카페 분위기가 참 좋아요.", "eng": "The atmosphere of the cafe is really nice." },
                    { "kor": "즐거운 분위기에서 식사했어요.", "eng": "We ate in a joyful atmosphere." }
                ]
            },
            {
                "term": "즐겨 보세요",
                "mainDef": "Try enjoying (it).",
                "variants": ["즐겨 보세요"],
                "subDefs": [
                    { "subTerm": "즐기다", "subDef": "to enjoy." },
                    { "subTerm": "-아/어 보세요", "subDef": "have a try doing, give it a try." }
                ],
                "examples": [
                    { "kor": "음악을 즐겨 보세요.", "eng": "Try enjoying the music." },
                    { "kor": "주말을 편안하게 즐겨 보세요.", "eng": "Try enjoying your weekend comfortably." }
                ]
            },
            {
                "term": "좋은 생각",
                "mainDef": "Good idea.",
                "variants": ["좋은 생각이"],
                "subDefs": [
                    { "subTerm": "좋은", "subDef": "good." },
                    { "subTerm": "생각", "subDef": "idea; thought." }
                ],
                "examples": [
                    { "kor": "그거 참 좋은 생각이네요.", "eng": "That's a really good idea." },
                    { "kor": "좋은 생각이 나면 말해 주세요.", "eng": "Please tell me if you have a good idea." }
                ]
            },
            {
                "term": "티셔츠를 치킨으로 바꿀 거예요",
                "mainDef": "I will change the t-shirt to chicken.",
                "variants": ["티셔츠를 치킨으로 바꿀 거예요"],
                "subDefs": [
                    { "subTerm": "A를 B으로/로 바꾸다", "subDef": "exchange A for B." }
                ],
                "examples": [
                    { "kor": "달러를 원화로 바꿨어요.", "eng": "I exchanged dollars for won." },
                    { "kor": "오래된 차를 새 차로 바꿀 거예요.", "eng": "I will change my old car to a new one." }
                ]
            },
            {
                "term": "마법",
                "mainDef": "Magic.",
                "variants": ["마법"],
                "subDefs": [],
                "examples": [
                    { "kor": "마법 같은 일이 일어났어요.", "eng": "Something like magic happened." },
                    { "kor": "그는 마법사예요.", "eng": "He is a wizard." }
                ]
            },
            {
                "term": "못 말리겠네요",
                "mainDef": "I can't stop you; You're hopeless (joking).",
                "variants": ["못 말리겠네요"],
                "subDefs": [
                    { "subTerm": "못 말리다", "subDef": "cannot stop (someone)." },
                    { "subTerm": "-네요", "subDef": "When you want to express 'Wow' or show that you are impressed/surprised by what you just saw or heard; (in this context) \"Wow, you're really something else. I give up!\"." }
                ],
                "examples": [
                    { "kor": "당신의 고집은 정말 못 말리겠네요.", "eng": "I really can't stop your stubbornness." },
                    { "kor": "아이들의 장난은 못 말려요.", "eng": "You can't stop children's pranks." }
                ]
            },
            {
                "term": "내년",
                "mainDef": "Next year.",
                "variants": ["내년에는"],
                "subDefs": [],
                "examples": [
                    { "kor": "내년에 대학에 가요.", "eng": "I'm going to college next year." },
                    { "kor": "내년에는 더 행복하세요.", "eng": "Be happier next year." }
                ]
            },
            {
                "term": "미리",
                "mainDef": "In advance; beforehand.",
                "variants": ["미리"],
                "subDefs": [],
                "examples": [
                    { "kor": "표를 미리 사세요.", "eng": "Buy tickets in advance." },
                    { "kor": "미리 준비하면 좋아요.", "eng": "It's good to prepare in advance." }
                ]
            },
            {
                "term": "정리해 볼까요?",
                "mainDef": "Shall we summarize?",
                "variants": ["정리해 볼까요"],
                "subDefs": [
                    { "subTerm": "정리하다", "subDef": "to summarize, to organize." },
                    { "subTerm": "-아/어 볼까요?", "subDef": "used to suggest trying something together; \"Shall we…?\", \"How about…?\"" }
                ],
                "examples": [
                    { "kor": "오늘 배운 내용을 정리해 볼까요?", "eng": "Shall we summarize what we learned today?" },
                    { "kor": "책상을 정리해 볼까요?", "eng": "Shall we try organizing the desk?" }
                ]
            },
            {
                "term": "오늘도 치킨 먹어야 하거든요",
                "mainDef": "I have to eat chicken today too (you see).",
                "variants": ["오늘도 치킨 먹어야 하거든요"],
                "subDefs": [
                    { "subTerm": "-아야/어야 하다", "subDef": "have to; must." },
                    { "subTerm": "-거든요", "subDef": "used when you are giving the listener information or a reason they don't know yet; (in this context) \"I'm saying we should wrap this up because I have to eat chicken today too, you see.\"." }
                ],
                "examples": [
                    { "kor": "지금 가야 하거든요.", "eng": "I have to go now (you see)." },
                    { "kor": "내일 시험이 있거든요.", "eng": "I have an exam tomorrow (you see)." }
                ]
            },
            {
                "term": "마음에 안 드는 선물",
                "mainDef": "A gift (I) don't like.",
                "variants": ["마음에 안 드는 선물을"],
                "subDefs": [
                    { "subTerm": "마음에 안 들다", "subDef": "to not like." },
                    { "subTerm": "-는", "subDef": "used to turn a present-tense verb into an ‘adjective-ish’ phrase that describes the following noun." }
                ],
                "examples": [
                    { "kor": "마음에 안 드는 옷을 환불했어요.", "eng": "I refunded the clothes I didn't like." },
                    { "kor": "마음에 안 드는 사람과 일하기 힘들어요.", "eng": "It's hard to work with someone I don't like." }
                ]
            },
            {
                "term": "받으면",
                "mainDef": "If (you) receive.",
                "variants": ["받으면"],
                "subDefs": [
                    { "subTerm": "받다", "subDef": "to receive." },
                    { "subTerm": "-면/으면", "subDef": "if." }
                ],
                "examples": [
                    { "kor": "선물을 받으면 기분이 좋아요.", "eng": "If I receive a gift, I feel good." },
                    { "kor": "월급을 받으면 저축해요.", "eng": "If I receive my salary, I save it." }
                ]
            },
            {
                "term": "처럼",
                "mainDef": "Like; as.",
                "variants": ["저처럼"],
                "subDefs": [],
                "examples": [
                    { "kor": "나처럼 해 봐요.", "eng": "Try doing it like me." },
                    { "kor": "가족처럼 지내요.", "eng": "We live like family." }
                ]
            },
            {
                "term": "소중하게",
                "mainDef": "Preciously; with care.",
                "variants": ["소중하게"],
                "subDefs": [],
                "examples": [
                    { "kor": "이 선물을 소중하게 간직할게요.", "eng": "I will cherish this gift preciously." },
                    { "kor": "친구를 소중하게 생각해요.", "eng": "I think of my friend preciously." }
                ]
            },
            {
                "term": "솔직하게",
                "mainDef": "Honestly.",
                "variants": ["솔직하게"],
                "subDefs": [],
                "examples": [
                    { "kor": "솔직하게 말하면 용서해 줄게요.", "eng": "If you speak honestly, I will forgive you." },
                    { "kor": "자신의 감정을 솔직하게 표현하세요.", "eng": "Express your feelings honestly." }
                ]
            },
            {
                "term": "여러분의 생각을 알려 주세요",
                "mainDef": "Please tell (us) your thoughts.",
                "variants": ["여러분의 생각을 알려 주세요"],
                "subDefs": [
                    { "subTerm": "여러분", "subDef": "everyone; you all." },
                    { "subTerm": "알려 주다", "subDef": "to let know; to tell." },
                    { "subTerm": "-세요", "subDef": "please do." }
                ],
                "examples": [
                    { "kor": "정답을 알려 주세요.", "eng": "Please tell me the answer." },
                    { "kor": "도착 시간을 알려 주세요.", "eng": "Please let me know the arrival time." }
                ]
            },
            {
                "term": "오늘은 여기까지 할게요",
                "mainDef": "That’s all for today; We’ll wrap up here for today.",
                "variants": ["오늘은 여기까지 할게요"],
                "subDefs": [
                    { "subTerm": "정리하다", "subDef": "up to here, this far." },
                    { "subTerm": "-게요", "subDef": "used to politely express your decision or intention to do something, especially when it affects the listener." }
                ],
                "examples": [
                    { "kor": "수업은 여기까지 할게요.", "eng": "That's all for class today." },
                    { "kor": "회의는 여기까지 할게요.", "eng": "We'll wrap up the meeting here." }
                ]
            }
        ];
        
        const QUIZ_LIST = [
            { id: 1, questionKor: "우디는 누구한테 크리스마스 선물을 받았어요?", questionEng: "Who gave Woody a Christmas gift?", sentence_pre: "우디는 회사 \"", sentence_post: "\"한테 크리스마스 선물을 받았어요.", correct_word: "동료", translation: "Woody received a Christmas gift from his \"____\".", hint: "Someone who works with you.", options: [{ text: "친구", isCorrect: false, feedback: "'친구' means 'friend'." }, { text: "동료", isCorrect: true, feedback: "Woody says '회사 동료가 선물을 줬어요!' ('동료' means 'coworker')." }, { text: "가족", isCorrect: false, feedback: "'가족' means 'family'." }, { text: "선생님", isCorrect: false, feedback: "'선생님' means 'teacher'." }] },
            { id: 2, questionKor: "그 선물은 뭐였어요?", questionEng: "What was the gift?", sentence_pre: "\"", sentence_post: "\" 크리스마스 티셔츠였어요.", correct_word: "화려한", translation: "It was a \"____\" Christmas T-shirt.", hint: "Too many bright colors.", options: [{ text: "예쁜", isCorrect: false, feedback: "'예쁜' means 'pretty'." }, { text: "단순한", isCorrect: false, feedback: "'단순한' means 'simple'." }, { text: "화려한", isCorrect: true, feedback: "Woody says '너무 화려해요!' ('화려한' means 'flashy/colorful')." }, { text: "작은", isCorrect: false, feedback: "'작은' means 'small'." }] },
            { id: 3, questionKor: "우디는 그 티셔츠를 좋아했어요?", questionEng: "Did Woody like the T-shirt?", sentence_pre: "우디는 그 티셔츠가 \"", sentence_post: "\".", correct_word: "마음에 안 들었어요", translation: "Woody \"____\" the T-shirt.", hint: "He didn't like it.", options: [{ text: "좋았어요", isCorrect: false, feedback: "'좋았어요' means 'liked it'." }, { text: "마음에 들었어요", isCorrect: false, feedback: "'마음에 들었어요' means 'liked it'." }, { text: "마음에 안 들었어요", isCorrect: true, feedback: "Woody says '마음에 안 들어요.' ('마음에 안 들다' means 'to not like')." }, { text: "예뻤어요", isCorrect: false, feedback: "'예뻤어요' means 'was pretty'." }] },
            { id: 4, questionKor: "우디는 동료에게 \"고마워요\"라고 말했어요?", questionEng: "Did Woody say \"thank you\" to his coworker?", sentence_pre: "우디는 동료에게 \"그 티셔츠 못생겼어요\"라고 \"", sentence_post: "\" 말했어요.", correct_word: "솔직하게", translation: "Woody \"____\" told his coworker \"That T-shirt is ugly.\"", hint: "Telling the truth directly.", options: [{ text: "조용히", isCorrect: false, feedback: "'조용히' means 'quietly'." }, { text: "친절하게", isCorrect: false, feedback: "'친절하게' means 'kindly'." }, { text: "솔직하게", isCorrect: true, feedback: "Woody says '솔직한 게 제일 좋아요!' ('솔직하게' means 'honestly')." }, { text: "천천히", isCorrect: false, feedback: "'천천히' means 'slowly'." }] },
            { id: 5, questionKor: "우디는 동료의 선물을 안 좋아했어요. 그 동료의 마음은 어땠을까요?", questionEng: "Woody didn't like the coworker's gift. How did the coworker feel?", sentence_pre: "우디의 동료는 마음에 \"", sentence_post: "\".", correct_word: "상처를 받았을 거예요", translation: "Woody's coworker probably \"____\".", hint: "Emotionally hurt.", options: [{ text: "기뻤을 거예요", isCorrect: false, feedback: "'기뻤을 거예요' means 'would have been happy'." }, { text: "웃었을 거예요", isCorrect: false, feedback: "'웃었을 거예요' means 'would have laughed'." }, { text: "상처를 받았을 거예요", isCorrect: true, feedback: "Yuna says '동료가 상처받았을 거예요!' ('상처를 받다' means 'to be hurt')." }, { text: "놀랐을 거예요", isCorrect: false, feedback: "'놀랐을 거예요' means 'would have been surprised'." }] },
            { id: 6, questionKor: "우디는 나중에 그 티셔츠를 입었어요?", questionEng: "Did Woody wear the T-shirt later?", sentence_pre: "우디는 그 티셔츠를 치킨으로 \"", sentence_post: "\".", correct_word: "교환하고 싶어해요", translation: "Woody \"____\" the T-shirt for chicken.", hint: "He wants to exchange it.", options: [{ text: "입고 싶어해요", isCorrect: false, feedback: "'입고 싶어해요' means 'wants to wear'." }, { text: "버리고 싶어해요", isCorrect: false, feedback: "'버리고 싶어해요' means 'wants to throw away'." }, { text: "교환하고 싶어해요", isCorrect: true, feedback: "Woody says '티셔츠를 치킨으로 바꿀 거예요' ('교환하다/바꾸다' means 'to exchange')." }, { text: "선물하고 싶어해요", isCorrect: false, feedback: "'선물하고 싶어해요' means 'wants to give as a gift'." }] },
            { id: 7, questionKor: "만약 우디가 그 티셔츠를 팔면, 동료의 마음은 어떨까요?", questionEng: "If Woody sells the T-shirt, how will the coworker feel?", sentence_pre: "우디의 동료는 아마도 \"", sentence_post: "\".", correct_word: "서운할 거예요", translation: "Woody's coworker will probably \"____\".", hint: "Sad and disappointed.", options: [{ text: "행복할 거예요", isCorrect: false, feedback: "'행복할 거예요' means 'will be happy'." }, { text: "신날 거예요", isCorrect: false, feedback: "'신날 거예요' means 'will be excited'." }, { text: "서운할 거예요", isCorrect: true, feedback: "Yuna says '동료가 정말 서운했을 거예요.' ('서운하다' means 'to feel hurt/disappointed')." }, { text: "무서울 거예요", isCorrect: false, feedback: "'무서울 거예요' means 'will be scared'." }] },
            { id: 8, questionKor: "우디는 동료에게 어떻게 거짓말을 할 거예요?", questionEng: "How will Woody lie to his coworker?", sentence_pre: "우디는 선물을 \"", sentence_post: "\"라고 거짓말할 거예요.", correct_word: "간직하고 있어요", translation: "Woody will lie that he \"____\" the gift.", hint: "Keeping it carefully.", options: [{ text: "버렸어요", isCorrect: false, feedback: "'버렸어요' means 'threw it away'." }, { text: "팔았어요", isCorrect: false, feedback: "'팔았어요' means 'sold it'." }, { text: "간직하고 있어요", isCorrect: true, feedback: "Woody says '너무 아까워서 못 입고, 잘 간직하고 있어!' ('간직하다' means 'to treasure/keep')." }, { text: "입고 있어요", isCorrect: false, feedback: "'입고 있어요' means 'wearing it now'." }] },
            { id: 9, questionKor: "우디의 성격은 어때요?", questionEng: "What is Woody's personality like?", sentence_pre: "우디는 \"", sentence_post: "\".", correct_word: "뻔뻔해요", translation: "Woody is \"____\".", hint: "Shameless, not embarrassed.", options: [{ text: "착해요", isCorrect: false, feedback: "'착해요' means 'is kind/good'." }, { text: "조용해요", isCorrect: false, feedback: "'조용해요' means 'is quiet'." }, { text: "뻔뻔해요", isCorrect: true, feedback: "Yuna says '와, 정말 뻔뻔하네요.' ('뻔뻔하다' means 'shameless')." }, { text: "부지런해요", isCorrect: false, feedback: "'부지런해요' means 'is diligent'." }] },
            { id: 10, questionKor: "우디는 동료들과 잘 지낼 수 있을까요?", questionEng: "Will Woody be able to get along well with his coworkers?", sentence_pre: "우디는 동료와 \"", sentence_post: "\".", correct_word: "관계가 나빠질 수도 있어요", translation: "Woody's \"____\" with his coworker.", hint: "The relationship might become bad.", options: [{ text: "관계가 나빠질 수도 있어요", isCorrect: true, feedback: "Yuna says '동료 관계가 나빠질 수 있어요!' ('관계가 나쁘다' means 'relationship is bad')." }, { text: "관계가 좋아질 수도 있어요", isCorrect: false, feedback: "'관계가 좋아질 수도 있어요' means 'relationship might improve'." }, { text: "결혼할 수도 있어요", isCorrect: false, feedback: "'결혼할 수도 있어요' means 'might get married' - not related to the context." }, { text: "관계가 멀어질 수도 있어요", isCorrect: false, feedback: "'관계가 멀어질 수도 있어요' means 'relationship might become distant' - similar but Yuna specifically said '나빠질'." }] }
        ];

        const DISCUSS_QUESTIONS = [
            { 
                id: 1, 
                question: "친구나 회사 **동료**에게 선물을 자주 줘요?", 
                keyVocab: [
                    { term: "동료", meaning_eng: "Coworker" }
                ] 
            },
            { 
                id: 2, 
                question: "여러분이 선물을 줬는데, 친구가 그 선물을 안 좋아하면 **서운해요**?", 
                keyVocab: [
                    { term: "-는데", meaning_eng: "But/And (Background)" },
                    { term: "서운하다", meaning_eng: "To feel disappointed" }
                ]
            },
            { 
                id: 3, 
                question: "여러분은 **마음에 안 드는** 선물을 받은 적이 있어요?", 
                keyVocab: [
                    { term: "마음에 안 들다", meaning_eng: "To not like" },
                    { term: "마음에 안 드는 선물", meaning_eng: "Unwanted gift" },
                    { term: "-ㄴ 적이 있어요?", meaning_eng: "Have you ever...?" }
                ]
            },
            { 
                id: 4, 
                question: "여러분은 선물을 안 좋아해도, 버리지 않고, 잘 **간직해요**?", 
                keyVocab: [
                    { term: "-아도/어도", meaning_eng: "Even if" },
                    { term: "버리다", meaning_eng: "To throw away" },
                    { term: "간직하다", meaning_eng: "To keep/cherish" }
                ]
            },
            { 
                id: 5, 
                question: "선물이 마음에 안 들면, 우디처럼 **솔직하게** 말해요?", 
                keyVocab: [
                    { term: "마음에 안 들다", meaning_eng: "To not like" },
                    { term: "솔직하게", meaning_eng: "Honestly" }
                ]
            },
            { 
                id: 6, 
                question: "선물이 마음에 안 들면, 다른 것으로 **교환해요**?", 
                keyVocab: [
                    { term: "마음에 안 들다", meaning_eng: "To not like" },
                    { term: "다른 것", meaning_eng: "Something else" },
                    { term: "교환하다", meaning_eng: "To exchange" }
                ]
            },
            { 
                id: 7, 
                question: "여러분이 선물을 줬는데, 친구가 그 선물을 바꾸면 **상처받아요**?", 
                keyVocab: [
                    { term: "-는데", meaning_eng: "But/And" },
                    { term: "상처받다", meaning_eng: "To get hurt" }
                ]
            },
            { 
                id: 8, 
                question: "여러분은 선물 때문에 친구와 관계가 나빠진 적이 있어요?", 
                keyVocab: [
                    { term: "때문에", meaning_eng: "Because of" },
                    { term: "관계가 나빠지다", meaning_eng: "Relationship gets worse" },
                    { term: "-ㄴ 적이 있어요?", meaning_eng: "Have you ever...?" }
                ]
            },
            { 
                id: 9, 
                question: "만약 우디처럼 **화려한** 크리스마스 티셔츠를 선물로 받으면, 여러분은 어떻게 할 거예요?", 
                keyVocab: [
                    { term: "화려한", meaning_eng: "Flashy/Colorful" },
                    { term: "-을/를 선물로 받다", meaning_eng: "To receive as a gift" }
                ]
            },
            { 
                id: 10, 
                question: "만약 여러분이 선물을 팔았는데, 친구가 “그 옷을 입어 봤어?”라고 물어보면, 어떻게 할 거예요? <br> 우디처럼 “너무 아까워서 못 입고, 잘 간직하고 있어!”라고 뻔뻔하게 거짓말할 거예요?", 
                keyVocab: [
                    { term: "-는데", meaning_eng: "But/And" },
                    { term: "-라고 물어보다", meaning_eng: "To ask that..." },
                    { term: "아깝다", meaning_eng: "To be a waste/precious" },
                    { term: "간직하다", meaning_eng: "To keep" },
                    { term: "뻔뻔하게", meaning_eng: "Shamelessly" },
                    { term: "-라고 거짓말하다", meaning_eng: "To lie that..." }
                ]
            }
        ];

        const SCRIPT_DATA = [
            { id: 's1', speaker: '우디', kor: '안녕하세요!', time: [12.469, 13.687], eng: 'Hello!' },
            { id: 's2', speaker: '우디', kor: '<이 주제로 이야기해 봐요> 팟캐스트예요.', time: [13.764, 16.394], eng: 'This is the <Let\'s Talk About This Topic> podcast.' },
            { id: 's3', speaker: '우디', kor: '저는 우디예요.', time: [16.701, 18.176], eng: 'I\'m Woody.' },
            { id: 's4', speaker: '유나', kor: '안녕하세요! 저는 유나예요.', time: [18.600, 21.748], eng: 'Hello! I\'m Yuna.' },
            { id: 's5', speaker: '우디', kor: '유나 씨! 어제 크리스마스였어요!🎄', time: [22.595, 25.748], eng: 'Yuna! Yesterday was Christmas!' },
            { id: 's6', speaker: '유나', kor: '맞아요! 메리 크리스마스!', time: [26.069, 28.452], eng: 'Right! Merry Christmas!' },
            { id: 's7', speaker: '유나', kor: '선물 많이 받았어요?', time: [28.722, 30.746], eng: 'Did you get many gifts?' },
            { id: 's8', speaker: '우디', kor: '네! 회사 동료가 선물을 줬어요!', time: [31.400, 34.622], eng: 'Yes! My coworker gave me a gift!' },
            { id: 's9', speaker: '우디', kor: "'동료'는 '같이 일하는 사람’이라는 뜻이에요.", time: [35.251, 38.871], eng: '\'Coworker\' means \'a person you work with\'.' },
            { id: 's10', speaker: '유나', kor: '무슨 선물이에요?', time: [39.323, 40.820], eng: 'What kind of gift is it?' },
            { id: 's11', speaker: '우디', kor: '티셔츠예요!', time: [41.359, 42.640], eng: 'It\'s a T-shirt!' },
            { id: 's12', speaker: '우디', kor: '그런데... 마음에 안 들어요.😅', time: [42.756, 45.436], eng: 'But... I don\'t like it.' },
            { id: 's13', speaker: '우디', kor: "'마음에 안 들다'는 ‘안 좋아하다'라는 뜻이에요.", time: [45.653, 49.207], eng: '\'Not like\' means \'to not be fond of\'.' },
            { id: 's14', speaker: '유나', kor: '왜요?', time: [49.590, 50.366], eng: 'Why?' },
            { id: 's15', speaker: '우디', kor: '너무 화려해요!', time: [50.597, 52.446], eng: 'It\'s too flashy!' },
            { id: 's16', speaker: '우디', kor: "'화려하다'는 '색깔이 많고 밝다'라는 뜻이에요.", time: [52.959, 57.080], eng: '\'Flashy\' means \'having many bright colors\'.' },
            { id: 's17', speaker: '유나', kor: '그러면 안 입을 거예요?', time: [57.297, 59.397], eng: 'Then are you not going to wear it?' },
            { id: 's18', speaker: '우디', kor: '네, 동료한테 바로 말했어요!', time: [59.680, 62.182], eng: 'Yes, I told my coworker right away!' },
            { id: 's19', speaker: '우디', kor: '"이거 마음에 안 드는데, 가게에 가서 교환할 수 있어요?"', time: [62.529, 66.674], eng: '"I don\'t like this, can I go to the store and exchange it?"' },
            { id: 's20', speaker: '우디', kor: "'교환하다'는 '다른 것으로 바꾸다'라는 뜻이에요.", time: [67.186, 71.287], eng: '\'Exchange\' means \'to switch for something else\'.' },
            { id: 's21', speaker: '유나', kor: '헐!😱 우디 씨, 정말 그렇게 말했어요?', time: [71.677, 74.807], eng: 'Whoa! Woody, did you really say that?' },
            { id: 's22', speaker: '우디', kor: '네! 솔직한 게 제일 좋아요!', time: [75.000, 77.468], eng: 'Yes! Being honest is the best!' },
            { id: 's23', speaker: '우디', kor: "'솔직하다'는 '진짜 생각을 말하다'라는 뜻이에요.", time: [77.897, 82.007], eng: '\'Honest\' means \'telling your real thoughts\'.' },
            { id: 's24', speaker: '우디', kor: '그럼 동료가 다음에 제가 좋아하는 선물을 줄 거예요!', time: [82.514, 86.050], eng: 'Then my coworker will give me a gift I like next time!' },
            { id: 's25', speaker: '유나', kor: '우디 씨, 동료가 상처받았을 거예요!', time: [86.500, 89.774], eng: 'Woody, your coworker must have been hurt!' },
            { id: 's26', speaker: '유나', kor: "'상처받다'는 '마음이 아프다'라는 뜻이에요.", time: [90.069, 93.599], eng: '\'Get hurt\' means \'heart aches\'.' },
            { id: 's27', speaker: '유나', kor: '선물은 물건이 아니라 마음이에요.', time: [93.779, 97.159], eng: 'A gift isn\'t an object, it\'s the thought/heart.' },
            { id: 's28', speaker: '우디', kor: '하지만 제가 안 입을 옷을 왜 받아요?', time: [97.352, 100.358], eng: 'But why should I accept clothes I won\'t wear?' },
            { id: 's29', speaker: '우디', kor: '교환해서 제가 진짜 마음에 드는 걸 받는 게 더 좋아요!', time: [100.588, 104.932], eng: 'It\'s better to exchange it and get something I really like!' },
            { id: 's30', speaker: '유나', kor: '그래도 동료한테 직접 말하면 안 돼요!', time: [105.253, 108.558], eng: 'Still, you shouldn\'t say that directly to your coworker!' },
            { id: 's31', speaker: '유나', kor: '동료가 정말 서운했을 거예요.', time: [108.725, 111.516], eng: 'Your coworker must have been really disappointed/sad.' },
            { id: 's32', speaker: '유나', kor: "'서운하다'는 '슬프고 아쉽다'라는 뜻이에요.", time: [111.786, 115.905], eng: '\'Seounhada\' means \'sad and wistful/disappointed\'.' },
            { id: 's33', speaker: '우디', kor: '그럼 어떻게 해요?', time: [116.033, 118.226], eng: 'Then what should I do?' },
            { id: 's34', speaker: '우디', kor: '평생 그 못생긴 티셔츠를 간직해요?', time: [118.393, 120.945], eng: 'Should I keep that ugly T-shirt forever?' },
            { id: 's35', speaker: '우디', kor: "'간직하다'는 '잘 가지고 있다'라는 뜻이에요.", time: [121.160, 124.884], eng: '\'Cherish/Keep\' means \'to hold onto well\'.' },
            { id: 's36', speaker: '유나', kor: '입기 싫으면 안 입어도 돼요.', time: [125.191, 127.614], eng: 'If you don\'t want to wear it, you don\'t have to.' },
            { id: 's37', speaker: '유나', kor: '하지만 버리지 말고 잘 간직하세요.', time: [127.705, 131.102], eng: 'But don\'t throw it away, keep it safe.' },
            { id: 's38', speaker: '유나', kor: '선물은 마음이니까요.', time: [131.243, 133.133], eng: 'Because a gift is the heart/thought.' },
            { id: 's39', speaker: '우디', kor: '마음? 마음은 필요 없어요!😤', time: [133.210, 135.810], eng: 'Heart? I don\'t need heart!' },
            { id: 's40', speaker: '유나', kor: '😑 우디 씨… 그렇게 말하면, 동료 관계가 나빠질 수 있어요!', time: [135.900, 140.624], eng: 'Woody... if you say that, your relationship with your coworker might get bad!' },
            { id: 's41', speaker: '유나', kor: "'관계가 나쁘다'는 '사이가 안 좋다'라는 뜻이에요.", time: [140.894, 144.410], eng: '\'Bad relationship\' means \'not getting along\'.' },
            { id: 's42', speaker: '우디', kor: '그럼 그 티셔츠를 중고마켓에 팔 거예요! 💸', time: [144.807, 148.008], eng: 'Then I\'ll sell that T-shirt on a secondhand market!' },
            { id: 's43', speaker: '우디', kor: '그리고 그 돈으로 맛있는 치킨을 사 먹을 거예요!🍗', time: [148.098, 151.350], eng: 'And I\'ll buy delicious chicken with that money!' },
            { id: 's44', speaker: '유나', kor: '그런데 동료가 "그 티셔츠 입어 봤어요?"라고 물어보면, 어떻게 할 거예요?', time: [151.433, 157.574], eng: 'But what if your coworker asks "Did you try on that T-shirt?"?' },
            { id: 's45', speaker: '우디', kor: '"너무 아까워서 못 입고, 잘 간직하고 있어!"', time: [157.800, 161.830], eng: '"It\'s too precious to wear, so I\'m keeping it safe!"' },
            { id: 's46', speaker: '우디', kor: '이렇게 착한 거짓말을 할 거예요.', time: [162.124, 164.481], eng: 'I\'ll tell a white lie like this.' },
            { id: 's47', speaker: '유나', kor: '와, 정말 뻔뻔하네요.😠', time: [164.597, 166.711], eng: 'Wow, you are really shameless.' },
            { id: 's48', speaker: '유나', kor: "'뻔뻔하다'는 '부끄러워하지 않다'라는 뜻이에요.", time: [166.788, 170.467], eng: '\'Shameless\' means \'not feeling ashamed\'.' },
            { id: 's49', speaker: '우디', kor: '으악😖, 그럼 어떻게 해야 해요?😰', time: [170.700, 173.018], eng: 'Ugh, then what should I do?' },
            { id: 's50', speaker: '유나', kor: '제일 좋은 방법은 간직하는 거예요!', time: [173.403, 176.796], eng: 'The best way is to keep it!' },
            { id: 's51', speaker: '유나', kor: '그럼 동료도 기분 좋고, 우디 씨도 거짓말을 안 해도 돼요!', time: [176.903, 181.530], eng: 'Then your coworker feels good, and you don\'t have to lie!' },
            { id: 's52', speaker: '우디', kor: '하지만 화려하고 못생긴 티셔츠는 정말 싫어요!😭', time: [181.646, 185.902], eng: 'But I really hate flashy and ugly T-shirts!' },
            { id: 's53', speaker: '유나', kor: '그럼 12월에만 집에서 입어요!', time: [186.300, 188.721], eng: 'Then wear it at home only in December!' },
            { id: 's54', speaker: '유나', kor: '크리스마스 분위기를 즐겨 보세요! 🎄', time: [188.939, 191.086], eng: 'Enjoy the Christmas atmosphere!' },
            { id: 's55', speaker: '우디', kor: '저한테 더 좋은 생각이 있어요.', time: [191.215, 193.296], eng: 'I have a better idea.' },
            { id: 's56', speaker: '우디', kor: '티셔츠를 치킨으로 바꿀 거예요. 🍗', time: [193.385, 196.273], eng: 'I\'ll turn the T-shirt into chicken.' },
            { id: 's57', speaker: '우디', kor: '그건 크리스마스 마법이에요.✨', time: [196.376, 198.681], eng: 'That is Christmas magic.' },
            { id: 's58', speaker: '유나', kor: '😞🙂‍↔️ 못 말리겠네요.', time: [198.772, 200.164], eng: 'I can\'t stop you.' },
            { id: 's59', speaker: '유나', kor: '내년에는 미리 동료한테 "저는 검은색 옷을 좋아해요"라고 말하세요!', time: [200.344, 206.151], eng: 'Next year, tell your coworker in advance "I like black clothes"!' },
            { id: 's60', speaker: '우디', kor: '알겠어요.', time: [206.346, 207.778], eng: 'Okay.' },
            { id: 's61', speaker: '우디', kor: '일단, 오늘 배운 단어를 정리해 볼까요?', time: [207.958, 210.739], eng: 'First, shall we summarize the words we learned today?' },
            { id: 's62', speaker: '우디', kor: '오늘도 치킨 먹어야 하거든요. 🍗', time: [210.944, 212.942], eng: 'Because I have to eat chicken today too.' },
            { id: 's63', speaker: '유나', kor: '• 동료: 같이 일하는 사람', time: [214.143, 217.069], eng: 'Coworker: person working together' },
            { id: 's64', speaker: '유나', kor: '• 마음에 안 들다: 안 좋아하다', time: [217.518, 220.619], eng: 'Not like: to not like' },
            { id: 's65', speaker: '유나', kor: '• 화려하다: 색깔이 많고 밝다', time: [221.120, 224.878], eng: 'Flashy: many bright colors' },
            { id: 's66', speaker: '유나', kor: '• 교환하다: 다른 것으로 바꾸다', time: [225.252, 228.865], eng: 'Exchange: change to something else' },
            { id: 's67', speaker: '유나', kor: '• 솔직하다: 진짜 생각을 말하다', time: [229.289, 232.940], eng: 'Honest: telling real thoughts' },
            { id: 's68', speaker: '우디', kor: '• 상처받다: 마음이 아프다', time: [234.318, 237.179], eng: 'Get hurt: heart aches' },
            { id: 's69', speaker: '우디', kor: '• 서운하다: 슬프고 아쉽다', time: [237.449, 240.737], eng: 'Disappointed: sad and wistful' },
            { id: 's70', speaker: '우디', kor: '• 간직하다: 잘 가지고 있다', time: [241.108, 243.925], eng: 'Cherish/Keep: holding onto well' },
            { id: 's71', speaker: '우디', kor: '• 관계가 나쁘다: 사이가 안 좋다', time: [244.246, 247.577], eng: 'Bad relationship: not getting along' },
            { id: 's72', speaker: '우디', kor: '• 뻔뻔하다: 부끄러워하지 않다', time: [247.641, 250.521], eng: 'Shameless: not feeling ashamed' },
            { id: 's73', speaker: '유나', kor: '여러분은 마음에 안 드는 선물을 받으면 어떻게 해요?', time: [251.702, 255.764], eng: 'What do you do when you receive a gift you don\'t like?' },
            { id: 's74', speaker: '유나', kor: '저처럼 소중하게 간직해요?', time: [255.905, 258.169], eng: 'Do you cherish it like me?' },
            { id: 's75', speaker: '우디', kor: '저처럼 솔직하게 "마음에 안 들어요"라고 말해요?', time: [258.582, 262.544], eng: 'Do you honestly say "I don\'t like it" like me?' },
            { id: 's76', speaker: '우디', kor: '여러분의 생각을 알려 주세요!', time: [262.629, 264.541], eng: 'Please tell us your thoughts!' },
            { id: 's77', speaker: '유나', kor: '그럼 오늘은 여기까지 할게요!', time: [264.823, 267.000], eng: 'Then we\'ll stop here for today!' },
            { id: 's78', speaker: '유나', kor: '안녕히 계세요!', time: [267.081, 268.235], eng: 'Goodbye!' },
            { id: 's79', speaker: '우디', kor: '안녕히 계세요! 다음에 또 만나요!', time: [268.377, 270.691], eng: 'Goodbye! See you next time!' }
        ];

        // --- Sidebar Component ---
        const Sidebar = ({ activeTab, setActiveTab, isCollapsed, toggleSidebar, userLevel, themeColor }) => {
            const menus = [
                { id: 'home', label: '시작 페이지', subLabel: 'Home Page', icon: HomeIcon },
                { id: 'learn', label: '동영상 자료', subLabel: 'Video Resources', icon: LearnIcon },
                { id: 'vocab', label: '핵심 어휘', subLabel: 'Key Vocabulary', icon: VocabIcon },
                { id: 'quiz', label: '내용 확인 퀴즈', subLabel: 'Comprehension Quiz', icon: QuizIcon },
                { id: 'discuss', label: '생각해 보기', subLabel: 'Food For Thought', icon: DiscussIcon },
            ];
            
            const getLevelColor = (code) => {
                if (LEVEL_STYLES[code]) return LEVEL_STYLES[code];
                const base = code.substring(0, 2);
                return LEVEL_STYLES[base] || "bg-gray-50 text-slate-600 border-gray-100";
            };

            const currentStyle = getLevelColor(userLevel);
            const bgClass = currentStyle.split(' ')[0];
            const textClass = currentStyle.split(' ')[1];

            // [1] Tooltip state
            const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, info: null });

            // [2] Handlers
            const handleLevelTextEnter = (e) => {
                const rect = e.target.getBoundingClientRect();
                setTooltip({
                    show: true,
                    x: rect.right, 
                    y: rect.top,
                    info: LEVEL_DEFINITIONS[userLevel]
                });
            };

            const handleLevelTextLeave = () => {
                setTooltip(prev => ({ ...prev, show: false }));
            };

            // Sidebar styles based on collapsed state (1.15x for Expanded, 1.0x for Collapsed)
            const sidebarStyle = {
                fontSize: isCollapsed ? '1.0rem' : '1.15rem' 
            };

            return (
                <aside 
                    style={sidebarStyle}
                    className={`bg-white border-r border-gray-200 fixed h-full hidden md:flex flex-col z-50 transition-all duration-300 ease-in-out font-cafe24-anemone ${isCollapsed ? 'w-[5.5rem]' : 'w-[16rem]'}`}
                >
                    <div className={`p-[1.5em] flex items-center gap-[0.75em] relative ${isCollapsed ? 'justify-center px-0' : ''}`}>
                        <img 
                            src="https://raw.githubusercontent.com/openkoreanlearninglab/Lets-talk-about-this-topic/02d57eda9b250e56fab00389758ecad51ce0c54a/OpenKoreanLearningLab_Logo.jpeg" 
                            alt="Logo" 
                            className={`rounded-2xl shadow-lg shrink-0 transition-all duration-300 object-cover ${isCollapsed ? 'w-[3rem] h-[3rem]' : 'w-[3.75rem] h-[3.75rem]'}`}
                        />
                        {!isCollapsed && (
                            <div className="animate-fade-in overflow-hidden whitespace-nowrap flex flex-col justify-center">
                                <span className="font-extrabold text-[1.25em] text-black leading-tight font-cafe24-deco">Open</span>
                                <span className={`font-bold text-[0.875em] leading-tight font-cafe24-school ${textClass}`}>KoreanLearningLab</span>
                            </div>
                        )}
                        <button 
                            onClick={toggleSidebar}
                            className="absolute -right-3 top-1/2 -translate-y-1/2 bg-white border border-gray-200 rounded-full p-[0.25em] shadow-sm text-slate-500 hover:text-slate-700 hover:bg-gray-50 transition-colors z-10"
                        >
                            {isCollapsed ? <ChevronRight className="w-[0.75em] h-[0.75em]" /> : <ChevronLeft className="w-[0.75em] h-[0.75em]" />}
                        </button>
                    </div>
                    
                    <nav className={`flex-1 space-y-[0.75em] mt-[1em] ${isCollapsed ? 'px-[0.75em]' : 'px-[0.75em]'}`}>
                        {menus.map((menu) => {
                            const IconComp = menu.icon;
                            const isActive = activeTab === menu.id;
                            
                            const activeFontClass = isActive ? "font-cafe24-surround" : "font-cafe24";

                            return (
                                <button
                                    key={menu.id}
                                    onClick={() => {
                                        setActiveTab(menu.id);
                                        // "동영상 자료" (learn) 클릭 시 사이드바 접기
                                        if (menu.id === 'learn') {
                                            if (!isCollapsed) {
                                                toggleSidebar();
                                            }
                                        } 
                                        // 그 외 메뉴 클릭 시 사이드바 펼치기
                                        else {
                                            if (isCollapsed) {
                                                toggleSidebar();
                                            }
                                        }
                                    }}
                                    onDoubleClick={toggleSidebar}
                                    className={`w-full flex items-center transition-all duration-200 group relative ${
                                        isCollapsed 
                                        ? 'justify-center h-[3.5em] rounded-2xl' 
                                        : 'gap-[0.75em] px-[0.75em] py-[1em] rounded-2xl'
                                    } ${
                                        isActive 
                                        ? `bg-${themeColor}-50 text-${themeColor}-600` 
                                        : 'text-slate-700 hover:bg-gray-50 hover:text-slate-900'
                                    }`}
                                >
                                    {isActive && isCollapsed && (
                                        <div className={`absolute left-0 top-1/2 -translate-y-1/2 w-[0.375em] h-[2em] bg-${themeColor}-500 rounded-r-lg`}></div>
                                    )}
                                    {isActive && !isCollapsed && (
                                        <div className={`absolute left-0 top-1/2 -translate-y-1/2 w-[0.25em] h-[1.5em] bg-${themeColor}-500 rounded-r-lg`}></div>
                                    )}
                                    
                                    <IconComp 
                                        className={`shrink-0 transition-all duration-200 ${isCollapsed ? 'w-[2em] h-[2em]' : 'w-[1.75em] h-[1.75em]'} ${isActive ? `text-${themeColor}-600` : 'text-slate-400 group-hover:text-slate-900'}`} 
                                        filled={isActive}
                                    />
                                    
                                    {!isCollapsed && (
                                        <div className="flex flex-col items-start animate-fade-in overflow-hidden whitespace-nowrap">
                                            <span className={`text-[0.875em] leading-tight transition-all ${activeFontClass} ${
                                                isActive 
                                                ? `font-extrabold text-${themeColor}-600` 
                                                : 'font-medium text-slate-700 group-hover:font-semibold group-hover:text-slate-900'
                                            }`}>{menu.label}</span>
                                            
                                            <span className="text-[0.625em] font-normal text-slate-400 mt-[0.125em] leading-tight">{menu.subLabel}</span>
                                        </div>
                                    )}
                                    
                                    {isCollapsed && (
                                        <div className="absolute left-full ml-[0.75em] px-[0.75em] py-[0.375em] bg-slate-900 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-xl flex flex-col items-start">
                                            <span className="text-[0.75em] font-bold">{menu.label}</span>
                                            <span className="text-[0.625em] opacity-80">{menu.subLabel}</span>
                                            <div className="absolute top-1/2 -left-[0.25em] -translate-y-1/2 w-[0.5em] h-[0.5em] bg-slate-900 rotate-45"></div>
                                        </div>
                                    )}
                                </button>
                            );
                        })}
                    </nav>

                    <div className="p-[0.5em] border-t border-gray-100">
                        <div className={`flex items-center gap-[0.75em] p-[0.5em] rounded-xl transition-colors hover:bg-gray-50 cursor-pointer ${isCollapsed ? 'justify-center' : ''}`}>
                            <div className={`w-[2.75em] h-[2.75em] rounded-xl flex items-center justify-center shrink-0 transition-colors duration-300 ${bgClass} border ${currentStyle.split(' ')[2]}`}>
                                <span className={`text-[1em] font-extrabold font-school-smile ${currentStyle.replace('bg-', 'text-').replace('50', '600')}`}>{userLevel}</span>
                            </div>
                            {!isCollapsed && (
                                <div className="animate-fade-in overflow-hidden whitespace-nowrap flex-1">
                                    <p className="text-[0.875em] font-bold text-slate-900 mb-[1px] font-cafe24-anemone">학습자(Learner)</p>
                                    <div className="mt-[1px]">
                                        <span 
                                            className={`block w-fit px-[0.125em] py-[0.125em] rounded text-[0.625em] font-semibold border uppercase tracking-wide shadow-sm text-left cursor-help font-cafe24-anemone ${currentStyle}`}
                                            onMouseEnter={handleLevelTextEnter}
                                            onMouseLeave={handleLevelTextLeave}
                                        >
                                            Level: {LEVEL_DEFINITIONS[userLevel].title}
                                        </span>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Tooltip Portal */}
                    {tooltip.show && tooltip.info && createPortal(
                        <div 
                            className="fixed z-[9999] pointer-events-none animate-fade-in"
                            style={{ left: tooltip.x, top: tooltip.y }}
                        >
                            <div className="relative bg-slate-900/95 backdrop-blur text-white text-[0.75em] rounded-xl p-[1em] shadow-2xl transform -translate-y-full -translate-x-[1.5em] -mt-[0.75em] w-[16em] border border-slate-700/50">
                                <p className={`font-bold mb-[0.375em] text-[0.875em] text-${themeColor}-300`}>
                                    {userLevel} – {tooltip.info.title}
                                </p>
                                <p className="opacity-90 leading-relaxed font-medium text-slate-200">
                                    {tooltip.info.desc}
                                </p>
                                <div className="absolute -bottom-[0.375em] left-[1em] w-[0.75em] h-[0.75em] bg-slate-900/95 border-r border-b border-slate-700/50 rotate-45"></div>
                            </div>
                        </div>,
                        document.body
                    )}
                </aside>
            );
        };

        // --- View Components ---

        const HomeView = ({ setActiveTab, progress, userLevel, themeColor }) => {
            const completedCount = Object.values(progress).filter(val => val === true || (typeof val === 'number' && val > 0)).length;
            const percentage = Math.round((completedCount / 4) * 100);

            const quizScoreDisplay = typeof progress.quiz === 'number' ? `${progress.quiz}%` : (progress.quiz ? '100%' : '0%');
            const quizColorClass = (progress.quiz === 100 || progress.quiz === true) ? `text-${themeColor}-600` : 'text-slate-900';
            const quizIconBg = (progress.quiz === 100 || progress.quiz === true) ? `bg-${themeColor}-100 text-${themeColor}-600` : `bg-${themeColor}-50 text-${themeColor}-600`;

            return (
                <div style={{ fontSize: '1.25rem' }} className="space-y-[2.5em] animate-fade-in max-w-fit mx-auto">
                    <div className="space-y-[0.75em]">
                        <div className="flex items-center gap-[0.5em]">
                            <span className={`px-[0.5em] py-[0.25em] bg-${themeColor}-100 text-${themeColor}-700 text-[0.75em] font-extrabold rounded-md tracking-wider font-juache`}>팟캐스트 (PODCAST)</span>
                            <span className={`text-[0.75em] font-bold text-${themeColor}-600 tracking-wide uppercase font-school-smile`}>이 주제로 이야기해 봐요! (Let's talk about this topic)</span>
                        </div>
                        <h1 className="text-[3em] font-black text-slate-900 tracking-tight font-cafe24-surround">마음에 들지 않는 선물</h1>
                        <p className="text-slate-500 text-[1.125em] font-cafe24-surround">Unwanted Gift</p>
                    </div>

                    <div className="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden flex flex-col md:flex-row h-auto md:h-[20em]">
                        <div className="md:w-5/12 relative group bg-black cursor-pointer overflow-hidden" onClick={() => setActiveTab('learn')}>
                            <img src="https://img.youtube.com/vi/6wPteSottlc/maxresdefault.jpg" alt="Thumbnail" className="w-full h-full object-cover opacity-80 group-hover:opacity-60 transition-opacity duration-300" />
                            <div className="absolute top-[1.5em] left-[1.5em]">
                                <span className="bg-[#ea3323] text-white text-[0.625em] font-bold px-[0.5em] py-[0.25em] rounded border border-[#ea3323] shadow-sm tracking-wider">ON AIR</span>
                            </div>
                            <div className="absolute inset-0 flex items-center justify-center">
                                <div className="w-[3.5em] h-[3.5em] bg-white rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                                    <PlayIconLine className={`w-[1.5em] h-[1.5em] text-${themeColor}-600 fill-current ml-[0.25em]`} />
                                </div>
                            </div>
                        </div>

                        <div className="md:w-7/12 p-[2em] md:p-[2.5em] flex flex-col justify-center">
                            <div className="flex items-center gap-[0.5em] mb-[1em]">
                                <span className="px-[0.5em] py-[0.25em] bg-gray-100 text-slate-600 text-[0.625em] font-bold rounded uppercase tracking-wide">Listening</span>
                                <LevelBadge levelCode={userLevel} />
                            </div>
                            
                            <div className="mb-[0.75em]">
                                <h2 className="text-[1.5em] font-black text-slate-900 font-cafe24-surround">동영상 자료</h2>
                                <span className="text-[0.875em] font-bold text-slate-400 font-cafe24-surround">Video Resources</span>
                            </div>
                            
                            <div className="text-slate-600 text-[0.875em] leading-relaxed mb-[2em] pr-[1em]">
                                <p>팟캐스트를 듣고 마음에 들지 않는 선물에 대한 이야기를 들어보세요.</p>
                                <p className="mt-[0.25em] text-slate-400 text-[0.75em]">Listen to the podcast about unwanted gifts.</p>
                            </div>
                            
                            <div className="flex items-center gap-[0.75em]">
                                <button 
                                    onClick={() => setActiveTab('learn')}
                                    className="px-[1.5em] py-[0.75em] bg-[#111827] text-white rounded-xl hover:bg-black transition-colors shadow-md flex flex-col items-center leading-tight"
                                >
                                    <span className="text-[0.875em] font-bold">동영상 보러 가기</span>
                                    <span className="text-[0.625em] opacity-70 font-medium">Watch Video</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-[1.5em]">
                        {/* Card 1: Vocabulary */}
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-[10em] hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex flex-col">
                                        <span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">핵심 어휘</span>
                                        <span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Key Vocabulary</span>
                                    </div>
                                    <p className="text-[2.25em] font-black text-slate-900 mt-[0.25em] font-jua">{VOCAB_DATA.length}개</p>
                                </div>
                                <div className={`w-[2.5em] h-[2.5em] bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}>
                                    <VocabIcon className="w-[1.25em] h-[1.25em]" />
                                </div>
                            </div>
                            <button onClick={() => setActiveTab('vocab')} className="group flex items-center gap-[0.25em] transition-colors">
                                <div className="flex flex-col items-start">
                                    <span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>핵심 어휘 확인</span>
                                    <span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Check Vocabulary</span>
                                </div>
                                <span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-[0.25em]`}>→</span>
                            </button>
                        </div>

                        {/* Card 2: Quiz Progress */}
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-[10em] hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex flex-col">
                                        <span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">내용 확인 퀴즈</span>
                                        <span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Comprehension Quiz</span>
                                    </div>
                                    <p className={`text-[2.25em] font-black mt-[0.25em] transition-all duration-500 font-jua ${quizColorClass}`}>
                                        {quizScoreDisplay}
                                    </p>
                                </div>
                                <div className={`w-[2.5em] h-[2.5em] rounded-xl flex items-center justify-center transition-colors ${quizIconBg}`}>
                                    <QuizIcon className="w-[1.25em] h-[1.25em]" />
                                </div>
                            </div>
                            <button onClick={() => setActiveTab('quiz')} className="group flex items-center gap-[0.25em] transition-colors">
                                <div className="flex flex-col items-start">
                                    <span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>퀴즈 시작하기</span>
                                    <span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Start Quiz</span>
                                </div>
                                <span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-[0.25em]`}>→</span>
                            </button>
                        </div>

                        {/* Card 3: Food For Thought */}
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between h-[10em] hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex flex-col">
                                        <span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">생각해 보기</span>
                                        <span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Food For Thought</span>
                                    </div>
                                    <div className="flex flex-col mt-[0.75em]">
                                        <a 
                                            href="https://gemini.google.com/share/81271818f3e6" 
                                            target="_blank" 
                                            rel="noopener noreferrer" 
                                            className={`text-[1.0625em] font-black text-${themeColor}-600 hover:text-${themeColor}-800 hover:underline transition-colors flex items-center gap-[0.25em] leading-tight`}
                                        >
                                            Gemini AI Feedback
                                            <ExternalLinkIcon className="w-[1em] h-[1em]" />
                                        </a>
                                    </div>
                                </div>
                                <div className={`w-[2.5em] h-[2.5em] bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}>
                                    <DiscussIcon className="w-[1.25em] h-[1.25em]" />
                                </div>
                            </div>
                            
                            <button onClick={() => setActiveTab('discuss')} className="group flex items-center gap-[0.25em] transition-colors">
                                <div className="flex flex-col items-start">
                                    <span className="text-[0.75em] font-bold text-slate-400 group-hover:text-blue-600">다음 질문들을 생각해 보세요.</span>
                                    <span className="text-[0.625em] text-slate-300 group-hover:text-blue-400 font-medium">Have a think about the following questions.</span>
                                </div>
                                <span className="text-[1.125em] leading-none text-slate-400 group-hover:text-blue-600 ml-[0.25em]">→</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const LearnView = ({ updateProgress, themeColor, autoScroll, showVocab, playbackRate }) => {
            const [player, setPlayer] = useState(null);
            const playerRef = useRef(null); 
            const [currentTime, setCurrentTime] = useState(0);
            const [activeLine, setActiveLine] = useState(null);
            const [translations, setTranslations] = useState({});
            const [popup, setPopup] = useState({ show: false, fixed: false, data: null, x: 0, y: 0 });
            
            const [activeVocabTerm, setActiveVocabTerm] = useState(null);
            const sidebarVocabRefs = useRef({});

            const scriptRefs = useRef({});
            const intervalRef = useRef(null);

            // ... (useEffect logic remains same) ...
            useEffect(() => {
                const loadVideo = () => {
                    if (window.YT && window.YT.Player) {
                        new window.YT.Player('youtube-player', {
                            videoId: '6wPteSottlc',
                            width: '100%',
                            height: '100%',
                            playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0 },
                            events: {
                                'onReady': (event) => {
                                    playerRef.current = event.target;
                                    setPlayer(event.target);
                                },
                                'onStateChange': (event) => {
                                    if (event.data === window.YT.PlayerState.PLAYING) {
                                        startInterval();
                                        updateProgress('learn');
                                    } else stopInterval();
                                }
                            }
                        });
                    }
                };
                if (!window.YT) {
                    const tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    const firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                    window.onYouTubeIframeAPIReady = loadVideo;
                } else {
                    loadVideo();
                }
                return () => stopInterval();
            }, []);

            useEffect(() => {
                if (player && player.setPlaybackRate) {
                    player.setPlaybackRate(playbackRate);
                }
            }, [playbackRate, player]);

            useEffect(() => {
                const handleGlobalClick = () => {
                    if (popup.fixed) {
                        setPopup(prev => ({ ...prev, show: false, fixed: false }));
                    }
                };
                if (popup.fixed) {
                    window.addEventListener('click', handleGlobalClick);
                }
                return () => window.removeEventListener('click', handleGlobalClick);
            }, [popup.fixed]);

            const startInterval = () => {
                stopInterval();
                intervalRef.current = setInterval(() => {
                    const p = playerRef.current;
                    if (p && p.getCurrentTime) {
                        const time = p.getCurrentTime();
                        setCurrentTime(time);
                        const currentLine = SCRIPT_DATA.find(line => time >= line.time[0] && time < line.time[1]);
                        if (currentLine) setActiveLine(currentLine.id);
                    }
                }, 200);
            };
            const stopInterval = () => clearInterval(intervalRef.current);

            useEffect(() => {
                if (popup.show) return;
                if (activeLine && autoScroll && scriptRefs.current[activeLine]) {
                    scriptRefs.current[activeLine].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, [activeLine, autoScroll, popup.show]);

            const handleLineClick = (time) => {
                if (player) {
                    player.seekTo(time);
                    player.playVideo();
                }
            };

            const toggleTranslation = (id) => {
                setTranslations(prev => ({...prev, [id]: !prev[id]}));
            };

            const scrollToVocab = (term) => {
                const element = sidebarVocabRefs.current[term];
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            };

            const handleVocabEnter = (e, wordData) => {
                if (popup.fixed) return; 
                const rect = e.target.getBoundingClientRect();
                setPopup({
                    show: true,
                    fixed: false,
                    data: wordData,
                    x: rect.left + rect.width / 2, 
                    y: rect.bottom
                });

                if (showVocab) {
                    setActiveVocabTerm(wordData.term);
                    scrollToVocab(wordData.term);
                }
            };

            const handleVocabLeave = () => {
                if (popup.fixed) return;
                setPopup(prev => ({ ...prev, show: false }));
            };

            const handleVocabClick = (e, wordData) => {
                e.stopPropagation(); 
                if (popup.fixed && popup.data && popup.data.term === wordData.term) {
                    setPopup(prev => ({ ...prev, show: false, fixed: false }));
                    return;
                }
                const rect = e.target.getBoundingClientRect();
                setPopup({
                    show: true,
                    fixed: true,
                    data: wordData,
                    x: rect.left + rect.width / 2,
                    y: rect.bottom
                });

                if (!showVocab) {
                } else {
                    setActiveVocabTerm(wordData.term);
                    scrollToVocab(wordData.term);
                }
            };

            const renderTextWithVocab = (text) => {
                let parts = [text];
                VOCAB_DATA.forEach(vocab => {
                    const nextParts = [];
                    parts.forEach(part => {
                        if (typeof part === 'string') {
                            const split = part.split(vocab.term);
                            split.forEach((s, i) => {
                                if (s) nextParts.push(s);
                                if (i < split.length - 1) {
                                    nextParts.push({ isVocab: true, ...vocab });
                                }
                            });
                        } else {
                            nextParts.push(part);
                        }
                    });
                    parts = nextParts;
                });

                return parts.map((part, index) => {
                    if (typeof part === 'string') return part;
                    const isActive = (popup.show && popup.data && popup.data.term === part.term) || (showVocab && activeVocabTerm === part.term);
                    return (
                        <span 
                            key={index}
                            className={`cursor-pointer border-b-2 transition-all duration-200 font-bold inline-block leading-tight
                                ${isActive 
                                    ? `text-${themeColor}-700 border-${themeColor}-500 bg-${themeColor}-100 rounded-sm px-[0.125em] mx-[0.125em]` 
                                    : `text-slate-900 border-dashed border-gray-400 hover:text-${themeColor}-600 hover:border-${themeColor}-400 hover:bg-${themeColor}-50`
                                }`}
                            onMouseEnter={(e) => handleVocabEnter(e, part)}
                            onMouseLeave={handleVocabLeave}
                            onClick={(e) => handleVocabClick(e, part)}
                        >
                            {part.term}
                        </span>
                    );
                });
            };

            return (
                <div style={{ fontSize: '1.3rem' }} className="flex h-[calc(100vh-4rem)] gap-[1em] animate-fade-in overflow-hidden relative w-full mx-auto">
                    {/* Vocab Popup - Updated Fonts & Sizes */}
                    {popup.show && popup.data && createPortal(
                        <div 
                            className="fixed z-[9999] bg-white rounded-xl shadow-xl border border-gray-200 p-[1em] w-[18em] animate-fade-in pointer-events-none"
                            style={{ 
                                left: popup.x, 
                                top: popup.y + 12,
                                transform: 'translate(-50%, 0)',
                                fontSize: '1.3rem'
                            }}
                        >
                            <div className="flex items-center justify-between mb-[0.5em]">
                                <h3 className="text-[1.25em] font-black text-slate-900 font-ocarina">{popup.data.term}</h3>
                            </div>
                            <p className="text-[1.1875em] text-slate-700 font-medium mb-[0.75em] leading-snug font-diary">{popup.data.mainDef}</p>
                            
                            {popup.fixed && popup.data.subDefs && popup.data.subDefs.length > 0 && (
                                <div className="space-y-[0.25em] mt-[0.5em]">
                                    {popup.data.subDefs.map((sub, idx) => (
                                        <div key={idx} className={`bg-${themeColor}-50 rounded-lg p-[0.5em] border border-${themeColor}-100`}>
                                            <p className={`text-[1.125em] text-${themeColor}-900 font-bold font-school-free`}>{sub.subTerm}</p>
                                            <p className={`text-[1.0625em] text-${themeColor}-700 font-dictation`}>{sub.subDef}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                            
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[0.75em] h-[0.75em] bg-white border-l border-t border-gray-200 rotate-45"></div>
                        </div>,
                        document.body
                    )}

                    <div className={`bg-black rounded-xl overflow-hidden shadow-lg transition-all duration-300 ${showVocab ? 'w-5/12' : 'flex-1'}`}>
                         <div id="youtube-player" className="w-full h-full"></div>
                    </div>

                    <div className={`flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm transition-all duration-300 ${showVocab ? 'w-4/12' : 'w-5/12'}`}>
                        {/* Script Container */}
                        <div className="flex-1 overflow-y-auto p-[1em] space-y-[1em] bg-gray-50 rounded-xl">
                            {SCRIPT_DATA.map(line => {
                                const isActive = activeLine === line.id;
                                return (
                                    <div key={line.id} ref={el => scriptRefs.current[line.id] = el} className="flex flex-col">
                                        <div className="flex items-center gap-[0.5em] mb-[0.25em] ml-[0.25em]">
                                            <span className="text-[0.75em] font-bold text-slate-600">{line.speaker}</span>
                                            <button 
                                                onClick={(e) => { e.stopPropagation(); handleLineClick(line.time[0]); }} 
                                                className={`text-[0.625em] text-${themeColor}-600 hover:underline flex items-center gap-[0.125em]`}
                                            >
                                                <PlayIconLine className="w-[0.75em] h-[0.75em] fill-current" /> 재생 (Play)
                                            </button>
                                        </div>
                                        <div 
                                            onClick={() => handleLineClick(line.time[0])}
                                            className={`p-[1.25em] rounded-2xl border transition-all duration-300 cursor-pointer relative group ${
                                                isActive 
                                                ? 'bg-yellow-100 border-yellow-400 shadow-md ring-1 ring-yellow-200 scale-[1.01]' 
                                                : 'bg-white border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            {/* Korean Script (Main Text) */}
                                            <p className="text-[1.375em] text-slate-800 leading-relaxed font-medium">
                                                {renderTextWithVocab(line.kor)}
                                            </p>
                                            
                                            <div className="my-[0.75em] border-t border-dashed border-gray-200"></div>
                                            {translations[line.id] ? (
                                                /* English Translation (Hidden Text) */
                                                <p className="text-[1.125em] text-slate-500 animate-fade-in">{line.eng}</p>
                                            ) : (
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }}
                                                    className="flex items-center gap-[0.25em] text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"
                                                >
                                                    <TranslateIcon className="w-[0.75em] h-[0.75em]" /> 번역 (Translation)
                                                </button>
                                            )}
                                            {translations[line.id] && (
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }}
                                                    className="absolute bottom-[1em] right-[1em] text-[0.625em] text-slate-300 hover:text-slate-500"
                                                >
                                                    접기
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                            <div className="h-[8em]"></div>
                        </div>
                    </div>

                    {showVocab && (
                        <div className="w-3/12 flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm animate-fade-in">
                            <div className="p-[1em] border-b border-gray-100 flex items-center gap-[0.5em] bg-white rounded-t-xl">
                                <VocabIcon className={`w-[1.25em] h-[1.25em] text-${themeColor}-600`} />
                                <div className="flex flex-col leading-none">
                                    <h2 className="font-bold text-slate-900 text-[0.875em]">핵심 어휘</h2>
                                    <span className="text-[0.625em] text-slate-400 font-medium">Key Vocabulary</span>
                                </div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-[1em] space-y-[1em] bg-gray-50">
                                {/* Sidebar Vocab List */}
                                {VOCAB_DATA.map((word, idx) => (
                                    <div 
                                        key={idx} 
                                        ref={el => sidebarVocabRefs.current[word.term] = el}
                                        className={`p-[1em] rounded-xl border transition-all duration-500 ${
                                            activeVocabTerm === word.term 
                                            ? `border-${themeColor}-500 bg-${themeColor}-50 ring-2 ring-${themeColor}-200 shadow-md scale-105` 
                                            : 'bg-white border-gray-200 shadow-sm'
                                        }`}
                                    >
                                        <div className="flex justify-between items-start mb-[0.5em]">
                                            <h3 className="text-[1.25em] font-extrabold text-slate-900 font-ocarina">{word.term}</h3>
                                        </div>
                                        <p className="text-[1.1875em] text-slate-600 mb-[0.75em] font-medium font-diary">{word.mainDef}</p>
                                        
                                        {word.subDefs && word.subDefs.length > 0 && (
                                            <div className={`space-y-[0.5em] bg-${themeColor}-50 p-[0.625em] rounded-lg border border-${themeColor}-100`}>
                                                {word.subDefs.map((sub, i) => (
                                                    <div key={i}>
                                                        <p className={`text-[1.125em] text-${themeColor}-900 font-bold leading-snug font-school-free`}>{sub.subTerm}</p>
                                                        <p className={`text-[1.0625em] text-${themeColor}-700 font-dictation`}>{sub.subDef}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const VocabCard = ({ word, themeColor }) => {
            const [isOpen, setIsOpen] = useState(false);

            return (
                <div className="bg-white p-[1.5em] rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-all h-full flex flex-col">
                    <div className="flex justify-between mb-[1em]">
                        <h3 className="text-[1.5em] font-extrabold text-slate-900">{word.term}</h3>
                    </div>
                    <div className={`pl-[1em] border-l-4 border-${themeColor}-500 mb-[1.5em]`}>
                        <p className="text-[1.3125em] text-slate-600 font-medium font-diary">{word.mainDef}</p>
                    </div>
                    
                    <div className="flex-1 flex flex-col">
                        <button 
                            onClick={() => setIsOpen(!isOpen)}
                            className="w-full flex items-center justify-between p-[1em] bg-gray-50 hover:bg-gray-100 rounded-xl transition-all group border border-transparent hover:border-gray-200"
                        >
                            <div className="flex items-center gap-[0.5em]">
                                <span className={`w-[0.375em] h-[0.375em] rounded-full transition-colors duration-300 ${isOpen ? `bg-${themeColor}-500` : 'bg-gray-400'}`}></span>
                                <span className={`text-[0.75em] font-bold uppercase tracking-wider transition-colors duration-300 ${isOpen ? `text-${themeColor}-700` : 'text-slate-500'}`}>
                                    Examples (예문)
                                </span>
                            </div>
                            <ChevronRight className={`w-[1em] h-[1em] text-slate-400 transition-transform duration-300 ${isOpen ? 'rotate-90' : ''}`} />
                        </button>

                        <div 
                            className={`overflow-hidden transition-all duration-300 ease-in-out ${isOpen ? 'max-h-[24em] opacity-100 mt-[0.5em]' : 'max-h-0 opacity-0'}`}
                        >
                            <div className="bg-gray-50 rounded-xl p-[1em] space-y-[0.75em] border border-gray-100">
                                {word.examples.map((ex, i) => (
                                    <div key={i}>
                                        <p className="font-bold text-slate-800 text-[1.1875em] leading-relaxed font-marker">{ex.kor}</p>
                                        <p className="text-slate-500 text-[1.0625em] mt-[0.125em] font-gowoonbam">{ex.eng}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {word.subDefs && word.subDefs.length > 0 && (
                            <div className={`bg-${themeColor}-50 rounded-xl p-[1.25em] space-y-[0.5em] border border-${themeColor}-100 mt-[1em]`}>
                                <h4 className={`font-bold text-${themeColor}-800 text-[0.75em] mb-[0.5em] flex items-center gap-[0.5em] uppercase tracking-wider`}>
                                    <span className={`w-[0.375em] h-[0.375em] rounded-full bg-${themeColor}-400`}></span>
                                    Related & Grammar
                                </h4>
                                {word.subDefs.map((sub, i) => (
                                    <div key={i} className="flex flex-col">
                                        <span className={`font-bold text-${themeColor}-900 text-[1.25em] font-school-free`}>{sub.subTerm}</span>
                                        <span className={`text-[1.1875em] text-${themeColor}-600 font-dictation`}>{sub.subDef}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const VocabView = ({ updateProgress, themeColor }) => {
            useEffect(() => {
                updateProgress('vocab');
            }, []);

            return (
            <div style={{ fontSize: '1.4rem' }} className="max-w-fit animate-fade-in mx-auto">
                <div className="flex items-center gap-[1em] mb-[2em]">
                    <div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}>
                        <VocabHeaderIcon className={`w-[2.5em] h-[2.5em] text-${themeColor}-600`} />
                    </div>
                    <div className="flex flex-col">
                        <h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">핵심 어휘</h2>
                        <span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Key Vocabulary</span>
                    </div>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-[1.5em]">
                    {VOCAB_DATA.map((word, idx) => (
                        <VocabCard key={idx} word={word} themeColor={themeColor} />
                    ))}
                </div>
            </div>
            );
        };

        const QuizView = ({ updateProgress, themeColor }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [firstAttempts, setFirstAttempts] = useState({}); 
            const [showHint, setShowHint] = useState(false);
            const [showTranslation, setShowTranslation] = useState(false);
            const [isFinished, setIsFinished] = useState(false);

            const currentQuestion = QUIZ_LIST[currentQuestionIndex];

            const shuffledOptions = useMemo(() => {
                return [...currentQuestion.options].sort(() => Math.random() - 0.5);
            }, [currentQuestion]);

            const selectedOption = answers[currentQuestionIndex] || null;
            const isCorrect = selectedOption?.isCorrect;

            const handleOptionClick = (option) => {
                if (selectedOption?.isCorrect) return; 

                if (firstAttempts[currentQuestionIndex] === undefined) {
                    setFirstAttempts(prev => ({
                        ...prev,
                        [currentQuestionIndex]: option.isCorrect
                    }));
                }

                setAnswers(prev => ({
                    ...prev,
                    [currentQuestionIndex]: option
                }));
                
                setShowHint(false); 
            };

            const handlePrev = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(prev => prev - 1);
                    setShowHint(false);
                    setShowTranslation(false);
                }
            };

            const handleNext = () => {
                if (currentQuestionIndex < QUIZ_LIST.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                    setShowHint(false);
                    setShowTranslation(false);
                } else {
                    finishQuiz();
                }
            };

            const finishQuiz = () => {
                setIsFinished(true);
                const totalQuestions = QUIZ_LIST.length;
                const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length;
                const finalScore = Math.round((correctCount / totalQuestions) * 100);
                updateProgress('quiz', finalScore);
            };

            const handleRetry = () => {
                setCurrentQuestionIndex(0);
                setAnswers({});
                setFirstAttempts({});
                setIsFinished(false);
                updateProgress('quiz', 0); 
            };

            if (isFinished) {
                const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length;
                return (
                    <div style={{ fontSize: '1.55rem' }} className="max-w-fit animate-fade-in mx-auto text-center py-[2.5em]">
                        <div className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[2.5em]">
                            <div className={`w-[5em] h-[5em] bg-${themeColor}-100 text-${themeColor}-600 rounded-full flex items-center justify-center mx-auto mb-[1.5em]`}>
                                <QuizIcon className="w-[2.5em] h-[2.5em]" />
                            </div>
                            <h2 className="text-[1.875em] font-black text-slate-900 mb-[0.5em] font-cafe24-surround">퀴즈 완료!</h2>
                            <p className="text-slate-500 mb-[2em]">
                                총 {QUIZ_LIST.length}문제 중 {correctCount}문제를 한 번에 맞혔습니다.
                            </p>
                            <div className={`text-[3em] font-black text-${themeColor}-600 mb-[2.5em] font-school-smile`}>
                                {Math.round((correctCount / QUIZ_LIST.length) * 100)}%
                            </div>
                            <button 
                                onClick={handleRetry}
                                className={`px-[2em] py-[0.75em] rounded-xl bg-${themeColor}-600 text-white font-bold hover:bg-${themeColor}-700 transition-colors`}
                            >
                                다시 풀기 (Try Again)
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div style={{ fontSize: '1.55rem' }} className="max-w-fit animate-fade-in mx-auto">
                    <div className="flex items-center gap-[1em] mb-[1.5em]">
                        <div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}>
                            <QuizHeaderIcon className="w-[2.5em] h-[2.5em] text-current" />
                        </div>
                        <div className="flex flex-col">
                            <h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">내용 확인 퀴즈</h2>
                            <span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Comprehension Quiz ({currentQuestionIndex + 1}/{QUIZ_LIST.length})</span>
                        </div>
                    </div>

                    <div className="mb-[1.5em] p-[1em] bg-gray-50 rounded-xl border border-gray-200">
                        <p className="font-bold text-slate-800">다음 빈칸에 알맞은 말을 고르세요.</p>
                        <p className="text-slate-500 text-[0.875em]">Choose the correct word for the blank.</p>
                    </div>

                    <div className="bg-white rounded-2xl border border-gray-200 shadow-sm p-[0.5em]">
                        <div className="flex items-start gap-[0.75em] p-[1em]">
                            <span className={`bg-${themeColor}-100 text-${themeColor}-700 font-black rounded-lg px-[0.5em] py-[0.25em] text-[0.875em] shrink-0`}>Q{currentQuestion.id}</span>
                            <div className="flex flex-col">
                                <h3 className="font-bold text-slate-900 text-[1.125em] leading-snug">{currentQuestion.questionKor}</h3>
                                <p className="text-slate-500 font-medium text-[0.875em] mt-[0.25em]">{currentQuestion.questionEng}</p>
                            </div>
                        </div>

                        <div className="bg-gray-50 rounded-xl p-[1em] mb-[1em] mx-[0.25em]">
                            <div>
                                <div className="flex items-center flex-wrap gap-[0.5em] leading-relaxed">
                                    <span className="text-[1.25em] font-bold text-slate-900">{currentQuestion.sentence_pre}</span>
                                    
                                    <div className={`px-[1em] py-[0.25em] rounded-md font-bold text-[1.25em] transition-all duration-300 min-w-[5em] text-center border-b-2 
                                        ${isCorrect 
                                            ? `bg-${themeColor}-50 text-${themeColor}-700 border-${themeColor}-500` 
                                            : (showHint 
                                                ? 'bg-yellow-100 text-yellow-800 border-yellow-400' 
                                                : (selectedOption 
                                                    ? 'bg-red-50 text-red-700 border-red-500' 
                                                    : 'bg-yellow-100 text-transparent border-yellow-400 select-none')
                                            )
                                        }`}
                                    >
                                        {isCorrect 
                                            ? selectedOption.text 
                                            : (showHint 
                                                ? `[ ${currentQuestion.hint} ]` 
                                                : (selectedOption ? selectedOption.text : "___")
                                            )
                                        }
                                    </div>
                                    
                                    <span className="text-[1.25em] font-bold text-slate-900">
                                        {currentQuestion.sentence_post}
                                        {selectedOption && (
                                            <span className={`ml-[0.5em] text-[1.125em] ${isCorrect ? `text-${themeColor}-600` : 'text-red-600'}`}>
                                                {isCorrect ? '✓' : '✗'}
                                            </span>
                                        )}
                                    </span>
                                </div>

                                {showTranslation && (
                                    <div className="mt-[1em] pt-[1em] border-t border-gray-200 text-slate-500 italic text-[0.875em] animate-fade-in font-medium">
                                        {currentQuestion.translation}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="flex gap-[0.5em] mb-[1em] px-[0.5em]">
                            <button 
                                onClick={() => { setShowHint(!showHint); }}
                                disabled={selectedOption?.isCorrect}
                                className={`px-[0.75em] py-[0.375em] rounded-lg text-[0.75em] font-bold transition-colors ${selectedOption?.isCorrect ? 'opacity-50 cursor-not-allowed bg-gray-100 text-slate-400' : (showHint ? 'bg-yellow-200 text-yellow-800 ring-2 ring-yellow-400' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200')}`}
                            >
                                힌트 (Hint)
                            </button>
                            <button 
                                onClick={() => setShowTranslation(!showTranslation)}
                                className="inline-flex items-center gap-[0.25em] text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"
                            >
                                <TranslateIcon className="w-[0.75em] h-[0.75em]" />
                                <span>{showTranslation ? '번역 숨기기 (Hide)' : '번역 (Translation)'}</span>
                            </button>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-[0.75em] mb-[1em] px-[0.5em]">
                            {shuffledOptions.map((option, idx) => {
                                const isSelected = selectedOption === option;
                                let btnClass = "bg-white border-gray-200 text-slate-700 hover:bg-gray-50 hover:border-gray-300";
                                
                                if (isSelected) {
                                    if (option.isCorrect) {
                                        btnClass = `bg-${themeColor}-500 border-${themeColor}-600 text-white shadow-md ring-2 ring-${themeColor}-200`;
                                    } else {
                                        btnClass = "bg-red-500 border-red-600 text-white shadow-md ring-2 ring-red-200";
                                    }
                                } else if (selectedOption?.isCorrect) {
                                    // 정답을 맞췄을 때만 나머지 버튼 비활성화 스타일 적용
                                    btnClass = "bg-gray-50 border-gray-200 text-slate-400 cursor-not-allowed";
                                }

                                return (
                                    <button
                                        key={idx}
                                        onClick={() => handleOptionClick(option)}
                                        disabled={selectedOption?.isCorrect}
                                        className={`py-[0.75em] px-[1em] rounded-xl border font-bold text-[1em] transition-all duration-200 ${btnClass}`}
                                    >
                                        {option.text}
                                    </button>
                                );
                            })}
                        </div>

                        {selectedOption && (
                            <div className="p-[1em] rounded-xl border-l-4 mb-[1em] mx-[0.5em] animate-fade-in transition-all bg-[#f8fafc] border-gray-300">
                                <div className={`${isCorrect ? `bg-${themeColor}-50 border-${themeColor}-500` : 'bg-red-50 border-red-500'} p-[1em] rounded-lg border-l-4`}>
                                    <h4 className={`font-bold text-[0.875em] mb-[0.25em] ${isCorrect ? `text-${themeColor}-800` : 'text-red-800'}`}>
                                        {isCorrect ? 'Correct!' : 'Try again.'}
                                    </h4>
                                    <p className={`text-[0.875em] italic ${isCorrect ? `text-${themeColor}-700` : 'text-red-700'}`}>
                                        {selectedOption.feedback}
                                    </p>
                                </div>
                            </div>
                        )}

                        <div className="flex justify-between items-center mt-[1em] border-t border-gray-100 pt-[1em] px-[0.5em] pb-[0.5em]">
                            <button
                                onClick={handlePrev}
                                disabled={currentQuestionIndex === 0}
                                className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] transition-colors ${
                                    currentQuestionIndex === 0 
                                    ? 'text-slate-300 cursor-not-allowed' 
                                    : 'text-slate-600 hover:bg-gray-100'
                                }`}
                            >
                                <span className="text-[1.125em]">←</span>
                                <span className="text-[0.75em]">이전 문제 (Prev)</span>
                            </button>

                            {/* New Page Indicator */}
                            <span className="text-[0.75em] font-bold text-slate-600">
                                {currentQuestionIndex + 1} / {QUIZ_LIST.length}
                            </span>

                            <button 
                                onClick={handleNext}
                                disabled={!isCorrect} 
                                className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] shadow-md transition-colors ${
                                    !isCorrect
                                    ? 'bg-gray-300 text-slate-500 cursor-not-allowed'
                                    : 'bg-gray-900 text-white hover:bg-black'
                                }`}
                            >
                                <span className="text-[0.75em]">{currentQuestionIndex < QUIZ_LIST.length - 1 ? '다음 문제 (Next)' : '결과 보기 (Finish)'}</span>
                                <span className="text-[1.125em]">→</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const callGeminiWithBackoff = async (payload) => {
            const apiKey = ""; // Runtime provided
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const delays = [1000, 2000, 4000, 8000, 16000];
            
            for (let i = 0; i <= delays.length; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`Server error: ${response.status}`);
                        }
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    return await response.json();
                } catch (error) {
                    if (i === delays.length) throw error;
                    await new Promise(resolve => setTimeout(resolve, delays[i]));
                }
            }
        };

        const FeedbackSection = ({ value, onChange, placeholder, question, keyPhrases, themeColor }) => {
            const [feedback, setFeedback] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const checkSentence = async () => {
                if (!value || value.trim() === '') {
                    setError("문장을 입력해야 피드백을 받을 수 있어요.");
                    setFeedback(null);
                    return;
                }
                setIsLoading(true);
                setError(null);
                setFeedback(null);

                const systemPrompt = `You are an advanced Korean language tutor AI for A2 level learners. Analyze the user's sentence in response to a specific question.
The user's answer is in Korean.
Your goal is to provide feedback in ENGLISH to help the learner understand.

Instructions:
1. "feedback_message_eng": Write the feedback status or brief comment in English.
2. "explanation_eng": Explain the grammar or vocabulary mistake in English. You can quote Korean words but the explanation must be in English.
3. "corrected_sentence": Provide the natural and correct Korean sentence.
4. "relevance_feedback_eng": If the answer is irrelevant, explain why in English.

Question: "${question}"
User's Answer: "${value}"

Your response MUST be a JSON object with the specified schema.`;
                const payload = {
                    contents: [{ role: "user", parts: [{ text: systemPrompt }, { text: `Please provide feedback on my answer.\n\nQuestion: "${question}"\nUser's Answer: "${value}"` }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: { type: "OBJECT", properties: { "is_relevant": { "type": "BOOLEAN" }, "relevance_feedback_eng": { "type": "STRING", "nullable": true }, "is_correct": { "type": "BOOLEAN", "nullable": true }, "feedback_message_eng": { "type": "STRING", "nullable": true }, "corrected_sentence": { "type": "STRING", "nullable": true }, "explanation_eng": { "type": "STRING", "nullable": true }, "alternative_expressions": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "expression_kor": { "type": "STRING" }, "expression_eng": { "type": "STRING" } }, "required": ["expression_kor", "expression_eng"] } } }, "required": ["is_relevant"] }
                    }
                };

                try {
                    const result = await callGeminiWithBackoff(payload);
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const parsedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                        setFeedback(parsedJson);
                    } else {
                        setError("AI의 응답을 처리하는 데 문제가 발생했어요.");
                    }
                } catch (err) {
                    console.error("Error checking sentence:", err);
                    setError("문장 검사에 실패했어요. 다시 시도해 주세요.");
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div>
                    {keyPhrases}
                    <div>
                        <h4 className="font-bold text-slate-900 mb-[0.75em] text-[1em]">핵심 표현을 사용해서 질문에 대답해 보세요.</h4>
                        <textarea 
                            value={value} 
                            onChange={onChange} 
                            placeholder={placeholder}
                            className={`w-full p-[1em] rounded-xl border border-gray-200 focus:border-${themeColor}-500 focus:ring-1 focus:ring-${themeColor}-500 outline-none min-h-[7.5em] resize-none text-[1em] text-slate-800 placeholder-gray-400 mb-[0.75em]`}
                        ></textarea>
                        
                        <button
                            onClick={checkSentence}
                            disabled={!value.trim() || isLoading}
                            className={`flex items-center gap-[0.5em] px-[1.25em] py-[0.375em] text-[0.75em] leading-[0.75em] rounded-xl font-bold transition-all shadow-sm ${
                                !value.trim() || isLoading
                                ? 'bg-gray-100 text-slate-400 cursor-not-allowed'
                                : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md'
                            }`}
                        >
                            {isLoading ? (
                                <>
                                    <div className="w-[1em] h-[1em] border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                    <span>분석 중... (Analyzing)</span>
                                </>
                            ) : (
                                <>
                                    <SparklesIcon className="w-[1.25em] h-[1.25em]" />
                                    <span>AI Feedback (피드백 받기)</span>
                                </>
                            )}
                        </button>

                        {error && (
                            <div className="mt-[1em] p-[1em] bg-red-50 text-red-600 rounded-xl border border-red-200 text-[0.875em] font-medium animate-fade-in">
                                {error}
                            </div>
                        )}

                        {feedback && (
                            <div className={`mt-[1.5em] rounded-2xl p-[1.5em] border animate-fade-in ${feedback.is_correct ? `bg-${themeColor}-50 border-${themeColor}-200` : 'bg-yellow-50 border-yellow-200'}`}>
                                <div className="flex items-center gap-[0.5em] mb-[1em]">
                                    <span className="text-[1.5em]">🤖</span>
                                    <h4 className="font-extrabold text-slate-900 text-[1.125em]">AI Tutor Feedback</h4>
                                </div>
                                
                                <div className="mb-[1em]">
                                    <span className={`font-black text-[0.875em] px-[0.75em] py-[0.25em] rounded-full bg-white border shadow-sm ${feedback.is_correct ? `text-${themeColor}-600 border-${themeColor}-200` : 'text-yellow-600 border-yellow-200'}`}>
                                        {feedback.is_correct ? '🎉 Great Job!' : '⚠️ Needs Improvement'}
                                    </span>
                                </div>

                                <div className="space-y-[1em]">
                                    {feedback.feedback_message_eng && (
                                        <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]">
                                            <span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Feedback</span>
                                            <p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.feedback_message_eng}</p>
                                        </div>
                                    )}
                                    {feedback.explanation_eng && (
                                        <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]">
                                            <span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Explanation</span>
                                            <p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.explanation_eng}</p>
                                        </div>
                                    )}
                                    {feedback.corrected_sentence && (
                                        <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]">
                                            <span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Correction</span>
                                            <p className="text-slate-900 text-[1.125em] font-black leading-relaxed">{feedback.corrected_sentence}</p>
                                        </div>
                                    )}
                                    {!feedback.is_relevant && (
                                        <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]">
                                            <span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Relevance</span>
                                            <p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.relevance_feedback_eng || "This answer doesn't seem relevant to the question."}</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const DiscussView = ({ updateProgress, themeColor }) => {
            const [answers, setAnswers] = useState({});
            
            const handleTextChange = (id, val) => {
                setAnswers(prev => ({...prev, [id]: val}));
            };

            return (
                <div style={{ fontSize: '1.35rem' }} className="max-w-fit mx-auto animate-fade-in">
                    <div className="flex items-center gap-[1em] mb-[2em]">
                        <div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}>
                            <DiscussHeaderIcon className="w-[2.5em] h-[2.5em] text-current" />
                        </div>
                        <div className="flex flex-col">
                            <h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">생각해 보기</h2>
                            <span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Food For Thought</span>
                        </div>
                    </div>

                    {/* New Notice Section */}
                    <div className={`mb-[2em] p-[1em] rounded-2xl bg-${themeColor}-50 border border-${themeColor}-100`}>
                        <div className="text-slate-800 text-[0.875em] font-medium leading-relaxed">
                            <p>AI Feedback은 Gemini 웹페이지에서만 작용하기 때문에 Github 웹페이지에서 사용할 수 없어요.</p>
                            <p className="text-slate-500 text-[0.75em] mt-[0.25em] mb-[1em]">
                                AI Feedback only works on the Gemini webpage, so it cannot be used on the GitHub webpage.
                            </p>
                            
                            <p className="flex flex-wrap items-center gap-[0.25em]">
                                AI Feedback 기능을 사용하기 원할 경우, 다음 링크를 클릭하세요: 
                                <a 
                                    href="https://gemini.google.com/share/81271818f3e6" 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-[0.125em]`}
                                >
                                    Gemini AI Feedback
                                    <ExternalLinkIcon className="w-[0.75em] h-[0.75em]" />
                                </a>
                            </p>
                            <p className="text-slate-500 text-[0.75em] mt-[0.25em] flex flex-wrap items-center gap-[0.25em]">
                                To use the AI feedback feature, please click the following link: 
                                <a 
                                    href="https://gemini.google.com/share/81271818f3e6" 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-[0.125em]`}
                                >
                                    Gemini AI Feedback
                                    <ExternalLinkIcon className="w-[0.75em] h-[0.75em]" />
                                </a>
                            </p>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[2em] md:p-[2.5em]">
                        {DISCUSS_QUESTIONS.map((q, index) => (
                            <div key={q.id} className="mb-[3em] border-b border-gray-100 pb-[3em] last:border-0 last:pb-0 last:mb-0">
                                <div className="mb-[2em]">
                                    <h3 className="text-[1.25em] font-bold text-slate-900 mb-[0.5em]">
                                        <span className="mr-2">{q.id}.</span> 
                                        {q.question.split(/(\*\*.*?\*\*|<br>)/g).map((part, i) => {
                                            if (part === '<br>') return <br key={i} />;
                                            if (part.startsWith('**') && part.endsWith('**')) {
                                                return <span key={i} className={`text-${themeColor}-600`}>{part.slice(2, -2)}</span>;
                                            }
                                            return part;
                                        })}
                                    </h3>
                                </div>

                                <FeedbackSection 
                                    themeColor={themeColor}
                                    question={q.question.replace(/\*\*/g, '').replace(/<br>/g, ' ')}
                                    value={answers[q.id] || ''}
                                    onChange={(e) => handleTextChange(q.id, e.target.value)}
                                    placeholder="여기에 답변을 입력하세요 (Type your response here)"
                                    keyPhrases={
                                        <div className="mb-[2.5em] space-y-[1em]">
                                            <div className="flex items-center gap-[0.5em]">
                                                <span className="text-red-500 text-[1.125em]">📍</span>
                                                <h4 className="font-bold text-slate-900 text-[1.125em]">핵심 표현 (Essential phrases)</h4>
                                            </div>

                                            <div className="space-y-[1em] pl-[0.25em]">
                                                {q.keyVocab.map((vocab, vIdx) => (
                                                    <div key={vIdx} className={`pl-[1em] border-l-4 border-${themeColor}-500`}>
                                                        <p className="text-slate-700">
                                                            <span className={`text-${themeColor}-600 font-bold text-[1.125em] mr-[0.5em]`}>{vocab.term}:</span>
                                                            <span>{vocab.meaning_eng}</span>
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    }
                                />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);
            const [userLevel, setUserLevel] = useState("A2+"); 
            
            // --- State Lifted from LearnView ---
            const [autoScroll, setAutoScroll] = useState(true);
            const [showVocab, setShowVocab] = useState(false);
            const [playbackRate, setPlaybackRate] = useState(1.0);

            const [progress, setProgress] = useState({
                learn: false,
                vocab: false,
                quiz: 0,
                discuss: false
            });

            // Derive theme color from user level
            const themeColor = useMemo(() => getLevelTheme(userLevel), [userLevel]);

            // 테마 색상 이름(Tailwind class)을 HEX 코드로 매핑
            const themeHexColors = {
                'lime': '#84cc16',    // lime-500
                'green': '#22c55e',   // green-500
                'sky': '#0ea5e9',     // sky-500
                'blue': '#3b82f6',    // blue-500
                'fuchsia': '#d946ef', // fuchsia-500
                'purple': '#a855f7'   // purple-500
            };
            const currentThemeHex = themeHexColors[themeColor] || '#22c55e';

            const updateProgress = (key, value = true) => {
                setProgress(prev => {
                    if (prev[key] === value) return prev;
                    return { ...prev, [key]: value };
                });
            };

            const handleSpeedChange = (e) => {
                const rate = parseFloat(e.target.value);
                setPlaybackRate(rate);
            };

            // 탭별 패딩 설정 (Tab-specific padding settings)
            const mainPaddingClass = useMemo(() => {
                switch(activeTab) {
                    case 'home': return 'p-[1.25em]';    // 홈
                    case 'learn': return 'p-[0.125em]';    // 동영상 자료
                    case 'vocab': return 'p-[1em]';   // 핵심 어휘
                    case 'quiz': return 'p-[0.25em]';     // 내용 확인 퀴즈
                    case 'discuss': return 'p-[0.125em]';  // 생각해 보기
                    default: return 'p-[1.25em]';
                }
            }, [activeTab]);

            useEffect(() => {
                const handleResize = () => {
                    if (window.innerWidth < 1024) {
                        setIsSidebarCollapsed(true);
                    } else {
                        setIsSidebarCollapsed(false);
                    }
                };
                window.addEventListener('resize', handleResize);
                handleResize(); 
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const toggleSidebar = () => {
                setIsSidebarCollapsed(!isSidebarCollapsed);
            };

            const renderContent = () => {
                switch(activeTab) {
                    case 'home': return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                    case 'learn': return <LearnView 
                                            updateProgress={updateProgress} 
                                            themeColor={themeColor}
                                            autoScroll={autoScroll}
                                            showVocab={showVocab}
                                            playbackRate={playbackRate}
                                            />;
                    case 'vocab': return <VocabView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'quiz': return <QuizView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'discuss': return <DiscussView updateProgress={updateProgress} themeColor={themeColor} />;
                    default: return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                }
            };

            // 앱 바(Header) 렌더링 함수
            const renderHeader = () => {
                if (activeTab === 'learn') {
                    // 동영상 자료 앱 바: 1.0x Base scale
                    return (
                        <div style={{ fontSize: '1.0rem' }} className="flex items-center justify-between h-full px-[1.5em] border-b border-gray-100 bg-white/90 backdrop-blur">
                            {/* Left: Title */}
                            <div className="flex items-center gap-[0.75em]">
                                <div className={`p-[0.5em] rounded-lg bg-${themeColor}-50`}>
                                    <LearnIcon className={`w-[1.25em] h-[1.25em] text-${themeColor}-600`} />
                                </div>
                                <div className="flex flex-col">
                                    <h1 className="text-[1.125em] font-bold text-slate-900 font-cafe24-surround leading-none">동영상 & 스크립트</h1>
                                    <span className="text-[0.6875em] font-bold text-slate-400 leading-none mt-[0.25em] font-cafe24-surround">Video & Transcript</span>
                                </div>
                            </div>

                            {/* Right: Controls (Auto Scroll -> Speed -> Vocab) */}
                            <div className="flex items-center gap-[1em]">
                                {/* 1. Auto Scroll */}
                                <div className="flex items-center gap-[0.5em] cursor-pointer group" onClick={() => setAutoScroll(!autoScroll)}>
                                    <div className={`w-[2.25em] h-[1.25em] rounded-full relative transition-colors duration-200 ease-in-out ${autoScroll ? `bg-${themeColor}-500` : 'bg-gray-300'}`}>
                                        <div className={`absolute top-[0.25em] w-[0.75em] h-[0.75em] bg-white rounded-full shadow-sm transition-transform duration-200 ${autoScroll ? 'left-[1.25em]' : 'left-[0.25em]'}`}></div>
                                    </div>
                                    <span className="text-[0.875em] font-bold text-slate-600 group-hover:text-slate-800 transition-colors whitespace-nowrap hidden sm:inline">Auto Scroll</span>
                                </div>

                                {/* 2. Speed Control */}
                                <div className="flex items-center gap-[0.5em] bg-gray-50 px-[0.75em] py-[0.375em] rounded-lg border border-gray-200">
                                    <SpeedSolidIcon className="w-[1em] h-[1em] text-slate-500" />
                                    <div className="flex items-center gap-[0.5em]">
                                        <span className="text-[0.625em] font-medium text-slate-400">0.5x</span>
                                        <input 
                                            type="range" min="0.5" max="1.0" step="0.01" 
                                            value={playbackRate} onChange={handleSpeedChange}
                                            className="w-[5em] h-[0.375em] bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                            style={{ '--thumb-color': currentThemeHex }}
                                        />
                                        <span className="text-[0.625em] font-medium text-slate-400">1.0x</span>
                                    </div>
                                    <span className={`text-[0.75em] font-bold text-${themeColor}-700 min-w-[2.5em] text-center`}>{playbackRate.toFixed(2)}x</span>
                                </div>

                                {/* 3. Vocabulary Toggle */}
                                <button 
                                    onClick={() => setShowVocab(!showVocab)}
                                    className={`flex items-center gap-[0.5em] px-[0.75em] py-[0.375em] rounded-lg border transition-all shadow-sm ${showVocab ? 'bg-gray-100 border-gray-300' : 'bg-white border-gray-200 hover:bg-gray-50'}`}
                                >
                                    <OpenBookSolidIcon className="w-[1em] h-[1em] text-slate-600" />
                                    <span className="text-[0.875em] font-bold text-slate-700 whitespace-nowrap hidden sm:inline">Vocabulary</span>
                                </button>
                            </div>
                        </div>
                    );
                }
                // Placeholder for other tabs if they needed a header, applied with 1.3x scale
                return (
                    <div style={{ fontSize: '1.3rem' }} className="h-full"></div>
                );
            };

            return (
                <div className="flex min-h-screen bg-[#f9fafb]">
                    <Sidebar 
                        activeTab={activeTab} 
                        setActiveTab={setActiveTab} 
                        isCollapsed={isSidebarCollapsed} 
                        toggleSidebar={toggleSidebar}
                        userLevel={userLevel}
                        themeColor={themeColor}
                        // setUserLevel removed as level is fixed for this content
                    />
                    <div className={`flex-1 flex flex-col transition-all duration-300 ease-in-out ${isSidebarCollapsed ? 'md:ml-[5.5rem]' : 'md:ml-[16rem]'}`}>
                        <header className={`h-[4rem] bg-white sticky top-0 z-40 transition-all duration-300 ${isSidebarCollapsed ? 'md:left-[5.5rem]' : 'md:left-[16rem]'}`}>
                            {renderHeader()}
                        </header>
                        <main className={`flex-1 ${mainPaddingClass} overflow-hidden flex flex-col`}>{renderContent()}</main>
                    </div>
                    <nav className="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-[0.75em] z-50">
                        {['home','learn','vocab','quiz','discuss'].map(t=><button key={t} onClick={()=>setActiveTab(t)} className={`p-[0.5em] rounded-lg ${activeTab===t ? `text-${themeColor}-600 bg-${themeColor}-50` : 'text-slate-400'}`}>{t==='home'?<HomeIcon className="w-[1.5em] h-[1.5em]"/>:t==='learn'?<LearnIcon className="w-[1.5em] h-[1.5em]"/>:t==='vocab'?<VocabIcon className="w-[1.5em] h-[1.5em]"/>:t==='quiz'?<QuizIcon className="w-[1.5em] h-[1.5em]"/>:<DiscussIcon className="w-[1.5em] h-[1.5em]"/>}</button>)}
                    </nav>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
