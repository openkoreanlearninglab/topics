<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKoreanLearningLab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&family=Jua&family=Noto+Sans+KR:wght@400;500;700;900&family=Sunflower:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        /* 루트 폰트 사이즈를 clamp와 vw를 사용하여 유동적으로 설정 */
        html { font-size: clamp(12px, 1vw, 16px); }
        
        @font-face {
            font-family: 'NanumSquareRound';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/NanumSquareRound.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        
        body { font-family:'NanumSquareRound',sans-serif; background-color:#f9fafb; color:#334155; }
        .font-basic { font-family:'NanumSquareRound',sans-serif; }
        .font-jua { font-family:'Jua',sans-serif; }
        .font-noto { font-family:'Noto Sans KR',sans-serif; }
        .font-sunflower { font-family:'Sunflower',sans-serif; }
        .font-nanum-round { font-family:'NanumSquareRound',sans-serif; }

        @font-face{font-family:'Cafe24SurroundAir';src:url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24SsurroundAir.woff') format('woff');font-weight:normal;font-display:swap}
        .font-cafe24{font-family:'Cafe24SurroundAir',sans-serif}
        @font-face{font-family:'Cafe24Surround';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/Cafe24Ssurround.woff') format('woff');font-weight:normal;font-display:swap}
        .font-cafe24-surround{font-family:'Cafe24Surround',sans-serif}
        @font-face{font-family:'Cafe24Decoshadow';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoshadow.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-cafe24-deco{font-family:'Cafe24Decoshadow',sans-serif}
        @font-face{font-family:'Cafe24Decoschool';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/Cafe24Decoschool.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-cafe24-school{font-family:'Cafe24Decoschool',sans-serif}
        @font-face{font-family:'Cafe24Anemone';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/Cafe24Ohsquare.woff') format('woff');font-weight:normal;font-display:swap}
        .font-cafe24-anemone{font-family:'Cafe24Anemone',sans-serif}
        @font-face{font-family:'SchoolSafetyRoundedSmile';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-R.woff2') format('woff2');font-weight:normal;font-display:swap}
        @font-face{font-family:'SchoolSafetyRoundedSmile';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimDunggeunmisoTTF-B.woff2') format('woff2');font-weight:700;font-display:swap}
        .font-school-smile{font-family:'SchoolSafetyRoundedSmile',sans-serif}
        @font-face{font-family:'SchoolSafetyFreeTime';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2508-2@1.0/HakgyoansimJayusiganR.woff2') format('woff2');font-weight:normal;font-style:normal}
        .font-school-free{font-family:'SchoolSafetyFreeTime',sans-serif}
        @font-face{font-family:'Juache';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');font-weight:normal;font-display:swap}
        .font-juache{font-family:'Juache',sans-serif}
        @font-face{font-family:'SchoolSafetyOcarina';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/HakgyoansimOcarinaR.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-ocarina{font-family:'SchoolSafetyOcarina',sans-serif}
        @font-face{font-family:'SchoolSafetyPictureDiary';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimGeurimilgiTTF-R.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-diary{font-family:'SchoolSafetyPictureDiary',sans-serif}
        @font-face{font-family:'SchoolSafeBoardMarker';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/HakgyoansimBoadmarkerR.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-marker{font-family:'SchoolSafeBoardMarker',sans-serif}
        @font-face{font-family:'SchoolSafeDictation';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408-5@1.0/HakgyoansimBadasseugiTTF-L.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-dictation{font-family:'SchoolSafeDictation',sans-serif}
        @font-face{font-family:'Cafe24Gowoonbam';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_twelve@1.1/Cafe24Oneprettynight.woff') format('woff');font-weight:normal;font-display:swap}
        .font-gowoonbam{font-family:'Cafe24Gowoonbam',sans-serif}
        @font-face{font-family:'SchoolSafetyMustache';src:url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2402_keris@1.0/TTHakgyoansimKossuyeomR.woff2') format('woff2');font-weight:normal;font-display:swap}
        .font-mustache{font-family:'SchoolSafetyMustache',sans-serif}

        ::-webkit-scrollbar{width:0.375rem;height:0.375rem}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:0.1875rem}
        ::-webkit-scrollbar-thumb:hover{background:#94a3b8}
        @keyframes fadeIn{from{opacity:0;transform:translateY(0.625rem)}to{opacity:1;transform:translateY(0)}}
        .animate-fade-in{animation:fadeIn 0.3s ease-out forwards}
        input[type=range]{-webkit-appearance:none;background:transparent}
        input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:0.75rem;width:0.75rem;border-radius:50%;background:var(--thumb-color,#22c55e);cursor:pointer;margin-top:-0.25rem;border:1px solid white;box-shadow:0 1px 2px rgba(0,0,0,0.15)}
        input[type=range]::-webkit-slider-runnable-track{width:100%;height:0.25rem;cursor:pointer;background:#e2e8f0;border-radius:0.125rem}
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        const { createPortal } = ReactDOM;

        // --- Data Definitions ---
        const LEVEL_DEFINITIONS = {
            "A1": { title: "Novice", desc: "Can use and understand very simple everyday expressions. Can introduce themselves, ask and answer basic questions." },
            "A1+": { title: "Pre-Beginner", desc: "Still beginner, but can handle slightly more than A1." },
            "A2": { title: "Beginner", desc: "Can understand frequently used sentences (family, shopping, work, hobbies)." },
            "A2+": { title: "Upper Beginner", desc: "Between A2 and B1. Can speak a bit more smoothly about daily life." },
            "B1": { title: "Pre-Intermediate", desc: "Can understand the main points of clear standard speech or texts on familiar topics." },
            "B1+": { title: "Lower Intermediate", desc: "Stronger B1. More comfortable carrying conversations." },
            "B2": { title: "Intermediate", desc: "Can understand the main ideas of complex texts." },
            "B2+": { title: "Upper Intermediate", desc: "Near C1. Can argue a point logically." },
            "C1": { title: "Advanced", desc: "Can understand long, demanding texts and implied meanings." },
            "C1+": { title: "Upper Advanced", desc: "Very strong C1, approaching native-like flexibility." },
            "C2": { title: "Proficient", desc: "Can understand virtually everything heard or read." }
        };

        const VOCAB_DATA = [
          {
            term: '체크리스트',
            mainDef: 'checklist',
            variants: [
              '체크리스트',
              '체크리스트가',
              '체크리스트를',
              '체크리스트는',
              '체크리스트에는',
              '체크리스트랑은'
            ],
            examples: [
              { kor: '수술할 때 체크리스트를 사용해요.', eng: 'They use a checklist during surgery.' },
              { kor: '여행 준비할 때 체크리스트가 도움이 돼요.', eng: 'A checklist helps when preparing for a trip.' }
            ],
            subDefs: [{ subTerm: '체크(하다)', subDef: 'to check (items) off a list' }]
          },
          {
            term: '-에 대해',
            mainDef: 'about; regarding',
            variants: ['체크리스트에 대해'],
            examples: [
              { kor: '오늘은 체크리스트에 대해 이야기 해볼게요.', eng: 'Today, I’ll try talking about checklists.' },
              { kor: '그 주제에 대해 어떻게 생각해요?', eng: 'What do you think about that topic?' }
            ],
            subDefs: [{ subTerm: '-에 관해서', subDef: 'similar: “about/regarding” (slightly more formal)' }]
          },
          {
            term: '이야기해 볼게요',
            mainDef: "I’ll try talking about it",
            variants: ['이야기 해볼게요', '이야기해 볼게요'],
            examples: [
              { kor: '지금부터 장점부터 이야기해 볼게요.', eng: 'From now on, I’ll try talking about the advantages first.' },
              { kor: '오늘은 제 경험을 이야기해 볼게요.', eng: 'Today, I’ll try talking about my experience.' }
            ],
            subDefs: [{ subTerm: '-아/어 볼게요', subDef: 'expresses intention to try something' }]
          },
          {
            term: '멍청하다',
            mainDef: 'to be stupid; foolish',
            variants: ['멍청하게', '멍청한'],
            examples: [
              { kor: '그렇게 하면 멍청해 보일 수 있어요.', eng: 'If you do that, you might look foolish.' },
              { kor: '그 질문이 멍청한 건 아니에요.', eng: 'That question is not stupid.' }
            ],
            subDefs: [{ subTerm: '바보같다', subDef: 'similar: “to seem foolish” (colloquial)' }]
          },
          {
            term: '멍청하게 만들다',
            mainDef: 'to make someone/something stupid',
            variants: ['멍청하게 만들까요', '멍청하게 만드는', '멍청하게 만드는 건'],
            examples: [
              { kor: '체크리스트가 사람들을 멍청하게 만들까요?', eng: 'Do checklists make people stupid?' },
              { kor: '습관이 우리를 더 게으르게 만들 수 있어요.', eng: 'A habit can make us lazier.' }
            ],
            subDefs: [{ subTerm: '-게 만들다', subDef: 'grammar: “to make someone/something …”' }]
          },
          {
            term: '흥미로운',
            mainDef: 'interesting (adj.)',
            variants: ['흥미로운', '흥미로운 질문이네요'],
            examples: [
              { kor: '아주 흥미로운 질문이네요.', eng: 'That’s a very interesting question.' },
              { kor: '흥미로운 이야기를 들었어요.', eng: 'I heard an interesting story.' }
            ],
            subDefs: [{ subTerm: '흥미롭다', subDef: 'dictionary form: “to be interesting”' }]
          },
          {
            term: '사용하다',
            mainDef: 'to use',
            variants: [
              '사용해요',
              '사용한다고',
              '사용한다고 들었어요',
              '사용하는',
              '사용하는 거예요',
              '사용하는 게',
              '사용하는 거'
            ],
            examples: [
              { kor: '저는 체크리스트를 자주 사용해요.', eng: 'I use checklists often.' },
              { kor: '이 앱을 사용해 보세요.', eng: 'Try using this app.' }
            ],
            subDefs: [{ subTerm: '쓰다', subDef: 'more casual: “to use”' }]
          },
          {
            term: '특히',
            mainDef: 'especially',
            variants: ['특히'],
            examples: [
              { kor: '특히 장보기 할 때 자주 써요.', eng: 'Especially when grocery shopping, I use it often.' },
              { kor: '특히 오늘은 바빠요.', eng: 'Especially today, I’m busy.' }
            ]
          },
          {
            term: '장보기 하다',
            mainDef: 'to do grocery shopping',
            variants: ['장보기 할 때', '장보기 할 때나'],
            examples: [
              { kor: '저는 주말에 장보기 해요.', eng: 'I go grocery shopping on the weekend.' },
              { kor: '장보기 할 때 체크리스트를 써요.', eng: 'I use a checklist when grocery shopping.' }
            ],
            subDefs: [{ subTerm: '장보다', subDef: 'shorter verb form of “to do grocery shopping”' }]
          },
          {
            term: '장점',
            mainDef: 'advantage; pro',
            variants: ['장점', '장점부터'],
            examples: [
              { kor: '체크리스트의 장점은 실수를 줄이는 거예요.', eng: 'The advantage of a checklist is reducing mistakes.' },
              { kor: '장점부터 이야기해 볼까요?', eng: 'Shall we talk about the advantages first?' }
            ],
            subDefs: [{ subTerm: '단점', subDef: 'opposite: disadvantage; con' }]
          },
          {
            term: '단점',
            mainDef: 'disadvantage; con',
            variants: ['단점', '단점이', '단점이에요'],
            examples: [
              { kor: '단점도 분명히 있어요.', eng: 'There are definitely disadvantages, too.' },
              { kor: '그게 체크리스트의 단점이에요.', eng: 'That’s the drawback of checklists.' }
            ]
          },
          {
            term: '있는 것 같아요',
            mainDef: 'it seems like there is/are…',
            variants: ['있는 것 같아요'],
            examples: [
              { kor: '장점과 단점이 있는 것 같아요.', eng: 'It seems like there are pros and cons.' },
              { kor: '뭔가 문제가 있는 것 같아요.', eng: 'It seems like there is some problem.' }
            ],
            subDefs: [{ subTerm: '-는 것 같다', subDef: 'grammar: soft opinion/guess (“it seems…”)' }]
          },
          {
            term: '-아/어 볼까요?',
            mainDef: 'shall we (try)…?',
            variants: ['이야기해 볼까요', '이야기해 볼까요?'],
            examples: [
              { kor: '먼저 장점부터 이야기해 볼까요?', eng: 'Shall we talk about the advantages first?' },
              { kor: '커피 한 잔 마셔 볼까요?', eng: 'Shall we try having a cup of coffee?' }
            ],
            subDefs: [{ subTerm: '-아/어 보다', subDef: '“to try doing …”' }]
          },
          {
            term: '수술하다',
            mainDef: 'to perform surgery',
            variants: ['수술할 때', '수술할 때는', '수술이나'],
            examples: [
              { kor: '의사들이 수술할 때 체크리스트를 사용해요.', eng: 'Doctors use checklists when they perform surgery.' },
              { kor: '오늘은 수술하는 날이에요.', eng: 'Today is the day of the surgery.' }
            ],
            subDefs: [{ subTerm: '수술', subDef: 'noun: surgery' }]
          },
          {
            term: '사용한다고 들었어요',
            mainDef: 'I heard that they use…',
            variants: ['사용한다고 들었어요'],
            examples: [
              { kor: '의사들이 체크리스트를 사용한다고 들었어요.', eng: 'I heard that doctors use checklists.' },
              { kor: '그 회사는 재택근무를 한다고 들었어요.', eng: 'I heard that company does remote work.' }
            ],
            subDefs: [{ subTerm: '-(이)라고/-(으)라고 듣다', subDef: 'reported information: “to hear that …”' }]
          },
          {
            term: '그렇지 않으면',
            mainDef: 'otherwise; if not',
            variants: ['그렇지 않으면'],
            examples: [
              { kor: '그렇지 않으면 실수를 할 수 있어요.', eng: 'Otherwise, you might make a mistake.' },
              { kor: '서둘러요. 그렇지 않으면 늦어요.', eng: 'Hurry. Otherwise, you’ll be late.' }
            ]
          },
          {
            term: '실수를 하다',
            mainDef: 'to make a mistake',
            variants: ['실수를', '실수를 자주', '실수를 줄여줄', '실수를 줄여줄 수 있어요'],
            examples: [
              { kor: '사람은 누구나 실수를 해요.', eng: 'Everyone makes mistakes.' },
              { kor: '체크리스트가 실수를 줄여줘요.', eng: 'A checklist reduces mistakes.' }
            ],
            subDefs: [{ subTerm: '실수', subDef: 'noun: mistake' }]
          },
          {
            term: '한다고 해요',
            mainDef: 'they say that…',
            variants: ['한다고 해요'],
            examples: [
              { kor: '의사들이 실수를 자주 한다고 해요.', eng: 'They say doctors make mistakes often.' },
              { kor: '내일 비가 온다고 해요.', eng: 'They say it will rain tomorrow.' }
            ],
            subDefs: [{ subTerm: '-다고 하다', subDef: 'reported speech: “to say that …”' }]
          },
          {
            term: '끔찍하다',
            mainDef: 'to be horrible; terrible',
            variants: ['끔찍하네요'],
            examples: [
              { kor: '생각만 해도 끔찍하네요.', eng: 'Just thinking about it is terrifying.' },
              { kor: '끔찍한 실수였어요.', eng: 'It was a terrible mistake.' }
            ]
          },
          {
            term: '비행기 조종사',
            mainDef: 'airplane pilot',
            variants: ['비행기 조종사들도', '비행기 조종사들'],
            examples: [
              { kor: '비행기 조종사도 체크리스트를 사용해요.', eng: 'Pilots also use checklists.' },
              { kor: '조종사는 출발 전에 점검해요.', eng: 'A pilot checks things before departure.' }
            ],
            subDefs: [{ subTerm: '조종하다', subDef: 'to operate/control (a plane, vehicle, etc.)' }]
          },
          {
            term: '복잡한',
            mainDef: 'complicated; complex',
            variants: ['복잡한', '복잡한 상황'],
            examples: [
              { kor: '복잡한 상황에서는 실수가 나기 쉬워요.', eng: 'In complex situations, mistakes happen easily.' },
              { kor: '이 문제는 너무 복잡해요.', eng: 'This problem is too complicated.' }
            ],
            subDefs: [{ subTerm: '복잡하다', subDef: 'dictionary form: to be complicated' }]
          },
          {
            term: '상황',
            mainDef: 'situation',
            variants: ['상황', '이런 상황', '상황에 따라'],
            examples: [
              { kor: '상황에 따라 다를 수 있어요.', eng: 'It can differ depending on the situation.' },
              { kor: '이런 상황에서는 판단이 필요해요.', eng: 'In this situation, judgment is needed.' }
            ]
          },
          {
            term: '줄여주다',
            mainDef: 'to reduce (for someone’s benefit)',
            variants: ['줄여줄 수 있어요', '줄여줄 수'],
            examples: [
              { kor: '체크리스트가 실수를 줄여줘요.', eng: 'A checklist reduces mistakes (for you).' },
              { kor: '시간을 좀 줄여줄 수 있어요?', eng: 'Can you reduce the time a bit for me?' }
            ],
            subDefs: [{ subTerm: '-아/어 주다', subDef: 'adds “for someone” nuance (a favor/benefit)' }]
          },
          {
            term: '이해가 되다',
            mainDef: 'to understand; to make sense',
            variants: ['이해가 돼요', '이해가 돼요.'],
            examples: [
              { kor: '이해가 돼요.', eng: 'I understand.' },
              { kor: '왜 그런지 이제 이해가 돼요.', eng: 'Now I understand why.' }
            ],
            subDefs: [{ subTerm: '이해하다', subDef: 'active verb: to understand' }]
          },
          {
            term: '-처럼',
            mainDef: 'like; as',
            variants: ['조종처럼', '기계처럼'],
            examples: [
              { kor: '수술이나 비행기 조종처럼 절차를 따라야 하는 일에는 체크리스트가 중요해요.', eng: 'For tasks like surgery or flying a plane, checklists are important.' },
              { kor: '우리는 그냥 기계처럼 절차를 따르면 돼요.', eng: 'We can just follow the procedure like a machine.' }
            ],
            subDefs: [
              { subTerm: '조종처럼', subDef: 'as/like flying (a plane)' },
              { subTerm: '기계처럼', subDef: 'like a machine (mechanically)' }
            ]
          },
          {
            term: '절차를 따르다',
            mainDef: 'to follow a procedure',
            variants: ['절차를 따라야', '절차를 따르면', '절차를 따라야 하는'],
            examples: [
              { kor: '수술이나 비행기 조종은 절차를 따라야 해요.', eng: 'Surgery or flying a plane requires following procedures.' },
              { kor: '안전 절차를 잘 따라야 해요.', eng: 'You must follow safety procedures well.' }
            ],
            subDefs: [
              { subTerm: '절차', subDef: 'procedure' },
              { subTerm: '따르다', subDef: 'to follow' }
            ]
          },
          {
            term: '따라야 하는 일',
            mainDef: 'a task that must be followed',
            variants: ['따라야 하는 일'],
            examples: [
              { kor: '절차를 따라야 하는 일에는 체크리스트가 중요해요.', eng: 'For tasks that require following procedures, checklists are important.' },
              { kor: '따라야 하는 일이 많을수록 실수가 늘어요.', eng: 'The more things you must follow, the more mistakes can happen.' }
            ],
            subDefs: [
              { subTerm: '따르다', subDef: 'to follow (a rule/procedure/order)' },
              { subTerm: '-아/어야 하다', subDef: 'must; have to' },
              { subTerm: '-는', subDef: 'modifier ending (present tense) for nouns' }
            ]
          },
          {
            term: '창의적인',
            mainDef: 'creative',
            variants: ['창의적인 일을', '창의적인 일'],
            examples: [
              { kor: '창의적인 일을 할 때도 체크리스트가 필요할까요?', eng: 'Do you need a checklist for creative work?' },
              { kor: '창의적인 아이디어가 필요해요.', eng: 'We need a creative idea.' }
            ],
            subDefs: [{ subTerm: '창의성', subDef: 'noun: creativity' }]
          },
          {
            term: '필요하다',
            mainDef: 'to be necessary',
            variants: ['필요할까요', '필요해요', '필요할 것 같아요'],
            examples: [
              { kor: '창의적인 일을 할 때도 체크리스트가 필요할까요?', eng: 'Is a checklist necessary even for creative work?' },
              { kor: '이럴 때는 생각하는 능력이 필요해요.', eng: 'In this case, thinking ability is necessary.' }
            ]
          },
          {
            term: '생각을 하다',
            mainDef: 'to think',
            variants: ['생각을 해야 해요', '생각만 해도', '생각을 해요'],
            examples: [
              { kor: '우리는 어떤 상황에서 생각을 해야 해요.', eng: 'In some situations, we have to think.' },
              { kor: '하지만 체크리스트는 생각을 필요로 하지 않아요.', eng: 'But a checklist doesn’t require thinking.' }
            ],
            subDefs: [{ subTerm: '생각', subDef: 'noun: thought; idea' }]
          },
          {
            term: '필요로 하다',
            mainDef: 'to require; to need',
            variants: ['필요로 하지 않아요', '필요로 하지 않아요.'],
            examples: [
              { kor: '체크리스트는 생각을 필요로 하지 않아요.', eng: 'A checklist does not require thinking.' },
              { kor: '이 일은 경험을 필요로 해요.', eng: 'This task requires experience.' }
            ],
            subDefs: [{ subTerm: '필요하다', subDef: 'more common: “to be necessary”' }]
          },
          {
            term: '기계',
            mainDef: 'machine',
            variants: ['기계', '기계처럼'],
            examples: [
              { kor: '우리는 그냥 기계처럼 절차를 따르면 돼요.', eng: 'We can just follow the procedure like a machine.' },
              { kor: '기계처럼 반복하면 창의성이 줄 수 있어요.', eng: 'If you repeat mechanically, creativity can decrease.' }
            ]
          },
          {
            term: '따르면 돼요',
            mainDef: 'you just have to follow…',
            variants: ['따르면 돼요', '절차를 따르면 돼요'],
            examples: [
              { kor: '우리는 그냥 절차를 따르면 돼요.', eng: 'We just have to follow the procedure.' },
              { kor: '설명대로 따르면 돼요.', eng: 'You just have to follow the instructions.' }
            ],
            subDefs: [{ subTerm: '-(으)면 되다', subDef: 'grammar: “it’s enough if…” / “you just need to…”' }]
          },
          {
            term: '직원',
            mainDef: 'employee; staff',
            variants: ['직원', '직원들에게', '직원이', '직원이 어떻게 해야'],
            examples: [
              { kor: '노드스트롬에서는 직원들에게 규칙 하나만 알려준다고 해요.', eng: 'At Nordstrom, they tell employees only one rule.' },
              { kor: '직원이 상황에 맞춰 스스로 판단해야 하죠.', eng: 'An employee should judge on their own to fit the situation.' }
            ]
          },
          {
            term: '규칙',
            mainDef: 'rule',
            variants: ['규칙', '규칙만', '규칙이에요', '하나의 규칙만'],
            examples: [
              { kor: '하나의 규칙만 알려준다고 해요.', eng: 'They say they tell only one rule.' },
              { kor: '"스스로 판단해서 행동하세요"라는 규칙이에요.', eng: 'It’s the rule: “Use your judgment and act.”' }
            ]
          },
          {
            term: '알려주다',
            mainDef: 'to let someone know; to inform',
            variants: ['알려준다고 해요', '알려준다고'],
            examples: [
              { kor: '직원들에게 하나의 규칙만 알려준다고 해요.', eng: 'They say they inform employees of only one rule.' },
              { kor: '방법을 알려줘서 고마워요.', eng: 'Thanks for telling me the method.' }
            ],
            subDefs: [{ subTerm: '알리다', subDef: 'more formal: to inform/announce' }]
          },
          {
            term: '스스로',
            mainDef: 'by oneself; on one’s own',
            variants: ['스스로', '스스로 판단해서', '스스로 가장 좋은'],
            examples: [
              { kor: '스스로 판단해서 행동하세요.', eng: 'Use your judgment and act on your own.' },
              { kor: '직원이 스스로 가장 좋은 방법을 생각해야 하죠.', eng: 'The employee should think of the best way on their own.' }
            ]
          },
          {
            term: '판단하다',
            mainDef: 'to judge; to decide',
            variants: ['판단해서', '판단해야', '판단해야 하죠'],
            examples: [
              { kor: '직원이 상황에 맞춰 스스로 판단해야 하죠.', eng: 'The employee should judge on their own to fit the situation.' },
              { kor: '결국 상황에 따라 판단이 달라요.', eng: 'In the end, judgment differs depending on the situation.' }
            ],
            subDefs: [{ subTerm: '판단', subDef: 'noun: judgment' }]
          },
          {
            term: '행동하다',
            mainDef: 'to act',
            variants: ['행동하세요', '행동해야'],
            examples: [
              { kor: '스스로 판단해서 행동하세요.', eng: 'Use your judgment and act.' },
              { kor: '상황에 맞게 행동해야 해요.', eng: 'You should act appropriately for the situation.' }
            ]
          },
          {
            term: '판단해서 행동하세요',
            mainDef: 'use your judgment and act',
            variants: ['판단해서 행동하세요'],
            examples: [
              { kor: '바로 스스로 판단해서 행동하세요.', eng: 'Use your judgment and act right away.' },
              { kor: '상황에 맞춰 판단해서 행동해야 해요.', eng: 'You should judge and act according to the situation.' }
            ],
            subDefs: [{ subTerm: '-아서/어서', subDef: 'connects actions: “and then / so” (sequence or reason)' }]
          },
          {
            term: '-(이)라는 규칙',
            mainDef: 'the rule that says…',
            variants: ['라는 규칙이에요', '라는 규칙만'],
            examples: [
              { kor: '"바로 스스로 판단해서 행동하세요"라는 규칙이에요.', eng: 'It’s the rule: “Use your judgment and act.”' },
              { kor: '그건 하나의 규칙이라는 뜻이에요.', eng: 'It means it’s one rule.' }
            ],
            subDefs: [{ subTerm: '-(이)라고 하다', subDef: 'quoting/reporting: “to say (that) …”' }]
          },
          {
            term: '정반대',
            mainDef: 'the complete opposite',
            variants: ['정반대네요', '정반대'],
            examples: [
              { kor: '아, 체크리스트랑은 정반대네요.', eng: 'Ah, that’s the complete opposite of a checklist.' },
              { kor: '제 생각은 정반대예요.', eng: 'My opinion is the exact opposite.' }
            ]
          },
          {
            term: '손님',
            mainDef: 'customer; guest',
            variants: ['손님이', '손님이 그 신발을', 'VIP 손님이', 'VIP 손님'],
            examples: [
              { kor: 'VIP 손님이 신발을 가져와서 환불해 달라고 해요.', eng: 'A VIP customer brings shoes and asks for a refund.' },
              { kor: '손님이 많아서 바빠요.', eng: 'We’re busy because there are many customers.' }
            ]
          },
          {
            term: '환불해 달라고 해요',
            mainDef: 'to ask for a refund',
            variants: ['환불해 달라고 해요', '환불해 달라고'],
            examples: [
              { kor: '손님이 환불해 달라고 해요.', eng: 'The customer asks for a refund.' },
              { kor: 'VIP 손님이 환불해 달라고 해요.', eng: 'A VIP customer asks for a refund.' }
            ],
            subDefs: [
              { subTerm: '환불하다', subDef: 'to refund; to give a refund' },
              { subTerm: '-아/어 달라고 하다', subDef: 'reporting a request: “to ask (someone) to …”' }
            ]
          },
          {
            term: '-을/를 위한',
            mainDef: 'for; for the sake of',
            variants: ['이런 상황을 위한', '상황을 위한'],
            examples: [
              { kor: '이런 상황을 위한 체크리스트는 없어요.', eng: 'There is no checklist for this kind of situation.' },
              { kor: '초보자를 위한 설명이에요.', eng: 'It’s an explanation for beginners.' }
            ]
          },
          {
            term: '-에 맞추다',
            mainDef: 'to fit; to suit',
            variants: ['상황에 맞춰', '상황에 맞춰 스스로'],
            examples: [
              { kor: '직원이 상황에 맞춰 스스로 판단해야 하죠.', eng: 'The employee should judge on their own to fit the situation.' },
              { kor: '시간에 맞춰 출발해요.', eng: 'We leave according to the time.' }
            ],
            subDefs: [{ subTerm: '맞추다 vs 맞다', subDef: '맞추다: to adjust/match; 맞다: to be correct/fit' }]
          },
          {
            term: '생각하는 능력',
            mainDef: 'the ability to think',
            variants: ['생각하는 능력', '생각하는 능력이'],
            examples: [
              { kor: '이럴 때는 생각하는 능력이 필요해요.', eng: 'In such cases, you need the ability to think.' },
              { kor: '스스로 생각하는 능력이 필요해요.', eng: 'You need the ability to think for yourself.' }
            ]
          },
          {
            term: '그렇군요',
            mainDef: 'I see; is that so?',
            variants: ['그렇군요'],
            examples: [
              { kor: '그렇군요. 그럼 결국 상황에 따라 다른 거네요.', eng: 'I see. So in the end, it depends on the situation.' },
              { kor: '아, 그렇군요.', eng: 'Oh, I see.' }
            ]
          },
          {
            term: '결국',
            mainDef: 'in the end; eventually',
            variants: ['결국'],
            examples: [
              { kor: '결국 상황에 따라 다른 거네요.', eng: 'So in the end, it depends on the situation.' },
              { kor: '결국 중요한 건 실행이에요.', eng: 'In the end, what matters is execution.' }
            ]
          },
          {
            term: '상황에 따라 다르다',
            mainDef: 'it depends on the situation',
            variants: ['상황에 따라 다른 거네요', '상황에 따라 다른', '상황에 따라 달라요'],
            examples: [
              { kor: '그건 상황에 따라 달라요.', eng: 'That depends on the situation.' },
              { kor: '언제 어떻게 사용하는지는 상황에 따라 달라요.', eng: 'When and how you use it depends on the situation.' }
            ]
          },
          {
            term: '도구',
            mainDef: 'tool',
            variants: ['도구예요', '도구를', '도구'],
            examples: [
              { kor: '체크리스트는 그냥 도구예요.', eng: 'A checklist is just a tool.' },
              { kor: '상황에 맞게 도구를 잘 사용해야 해요.', eng: 'You should use tools appropriately for the situation.' }
            ]
          },
          {
            term: '순서가 정해진 일',
            mainDef: 'a task with a fixed order',
            variants: ['순서가 정해진 일', '순서가 정해진 일에는', '순서가 정해진'],
            examples: [
              { kor: '복잡하지만 순서가 정해진 일에는 체크리스트가 좋아요.', eng: 'For complex tasks with a fixed order, checklists are good.' },
              { kor: '이 일은 순서가 정해져 있어요.', eng: 'This task has a set order.' }
            ],
            subDefs: [
              { subTerm: '순서', subDef: 'order; sequence' },
              { subTerm: '정해지다', subDef: 'to be decided; to be set' },
              { subTerm: '-(으)ㄴ/은', subDef: 'modifier ending (past/complete) for nouns' },
              { subTerm: '일', subDef: 'task; work' }
            ]
          },
          {
            term: '창의성',
            mainDef: 'creativity',
            variants: ['창의성이나', '창의성'],
            examples: [
              { kor: '하지만 창의성이나 판단이 필요한 일에는 생각하는 능력이 더 좋아요.', eng: 'But for work requiring creativity or judgment, thinking ability is better.' },
              { kor: '창의성은 연습으로 늘 수 있어요.', eng: 'Creativity can grow with practice.' }
            ]
          },
          {
            term: '판단',
            mainDef: 'judgment',
            variants: ['판단이', '판단이 필요한', '판단'],
            examples: [
              { kor: '판단이 필요한 일에는 체크리스트가 답이 아닐 수 있어요.', eng: 'For work requiring judgment, a checklist may not be the answer.' },
              { kor: '상황에 맞게 판단해야 해요.', eng: 'You should judge according to the situation.' }
            ]
          },
          {
            term: '머릿속',
            mainDef: 'in one’s head; mind',
            variants: ['머릿속', '머릿속 체크리스트', '머릿속 체크리스트가'],
            examples: [
              { kor: '저도 골프 칠 때 저만의 머릿속 체크리스트가 있어요.', eng: 'When I play golf, I also have my own checklist in my head.' },
              { kor: '머릿속으로 순서를 정리해요.', eng: 'I organize the order in my head.' }
            ]
          },
          {
            term: '어깨에 힘 빼기',
            mainDef: 'relax your shoulders; take the tension out',
            variants: ['어깨에 힘 빼기', '어깨에 힘 빼기,'],
            examples: [
              { kor: '어깨에 힘 빼기, 공 끝까지 보기 같은 거요.', eng: 'Things like relaxing my shoulders and watching the ball till the end.' },
              { kor: '먼저 어깨에 힘을 빼 보세요.', eng: 'First, try relaxing your shoulders.' }
            ],
            subDefs: [
              { subTerm: '어깨', subDef: 'shoulder' },
              { subTerm: '힘을 빼다', subDef: 'to relax; to loosen up (stop tensing)' }
            ]
          },
          {
            term: '공 끝까지 보기',
            mainDef: 'keep your eyes on the ball until the end',
            variants: ['공 끝까지 보기', '공 끝까지 보기 같은 거요'],
            examples: [
              { kor: '공 끝까지 보기 같은 걸 자주 잊어버려요.', eng: 'I often forget things like watching the ball until the end.' },
              { kor: '스윙할 때 공을 끝까지 보세요.', eng: 'When you swing, watch the ball all the way through.' }
            ],
            subDefs: [{ subTerm: '끝까지', subDef: 'until the end; all the way' }]
          },
          {
            term: '잊어버리다',
            mainDef: 'to forget',
            variants: ['잊어버릴 때가 있어요', '잊어버릴 때가', '잊어버릴'],
            examples: [
              { kor: '그런데 가끔 잊어버릴 때가 있어요.', eng: 'But sometimes I forget.' },
              { kor: '약속을 잊어버렸어요.', eng: 'I forgot the appointment.' }
            ]
          },
          {
            term: '확인할 뿐만 아니라',
            mainDef: 'not only check/confirm, but also…',
            variants: ['확인할 뿐만 아니라'],
            examples: [
              { kor: '체크리스트를 확인할 뿐만 아니라 진짜로 실행하는 게 중요해요.', eng: 'It’s important not only to check the checklist, but to actually carry it out.' },
              { kor: '듣기만 할 뿐만 아니라 연습도 해야 해요.', eng: 'You should not only listen, but also practice.' }
            ],
            subDefs: [
              { subTerm: '확인하다', subDef: 'to check; to confirm' },
              { subTerm: '-ㄹ 뿐만 아니라', subDef: 'grammar: “not only … but also …”' }
            ]
          },
          {
            term: '실행하다',
            mainDef: 'to execute; to carry out',
            variants: ['실행하는 게 중요해요', '실행하는 게', '실행하는'],
            examples: [
              { kor: '진짜로 실행하는 게 중요해요.', eng: 'Actually carrying it out is important.' },
              { kor: '계획을 실행했어요.', eng: 'I carried out the plan.' }
            ],
            subDefs: [{ subTerm: '실행', subDef: 'noun: execution; implementation' }]
          },
          {
            term: '요약하다',
            mainDef: 'to summarize',
            variants: ['요약해 볼게요', '요약해 볼게요.'],
            examples: [
              { kor: '오늘의 대화를 요약해 볼게요.', eng: 'Let me summarize today’s conversation.' },
              { kor: '한 문장으로 요약해 주세요.', eng: 'Please summarize it in one sentence.' }
            ],
            subDefs: [{ subTerm: '요약', subDef: 'noun: summary' }]
          },
          {
            term: '사용하는지',
            mainDef: 'whether/how (someone) uses…',
            variants: ['사용하는지가', '언제 어떻게 사용하는지가', '언제 어떻게 사용하는지'],
            examples: [
              { kor: '하지만 언제 어떻게 사용하는지가 중요해요.', eng: 'But when and how you use it is important.' },
              { kor: '이걸 왜 사용하는지 설명해 주세요.', eng: 'Please explain why you use this.' }
            ],
            subDefs: [{ subTerm: '-는지', subDef: 'embeds a question into a clause (“whether/what/how…”)' }]
          },
          {
            term: '상황에 맞게',
            mainDef: 'appropriately for the situation',
            variants: ['상황에 맞게', '상황에 맞게 도구를'],
            examples: [
              { kor: '상황에 맞게 도구를 잘 사용해야 해요.', eng: 'You should use tools appropriately for the situation.' },
              { kor: '상황에 맞게 행동하면 돼요.', eng: 'You can act appropriately for the situation.' }
            ],
            subDefs: [
              { subTerm: '상황에 맞추다', subDef: 'to adjust to the situation; to tailor to the situation' },
              { subTerm: '-에 맞게', subDef: 'grammar: “appropriately for …” / “according to …”' }
            ]
          },
          {
            term: '지혜로운',
            mainDef: 'wise',
            variants: ['지혜로운', '지혜로운 거죠'],
            examples: [
              { kor: '그게 지혜로운 거죠.', eng: 'That’s the wise thing to do.' },
              { kor: '지혜롭게 판단해야 해요.', eng: 'You should judge wisely.' }
            ],
            subDefs: [{ subTerm: '지혜', subDef: 'noun: wisdom' }]
          }
        ];

        const QUIZ_LIST = [
            {
                id: 1,
                questionKor: "체크리스트의 좋은 점은 뭐예요?",
                sentence_pre: "체크리스트의 가장 큰 장점은 ",
                sentence_post: "를 줄여준다는 거예요.",
                correct_word: "실수",
                translation: "The biggest advantage of a checklist is that it reduces mistakes.",
                hint: "Making errors.",
                options: [
                    { text: "실수", isCorrect: true, feedback: "복잡한 상황에서 실수를 줄여줘요." },
                    { text: "창의성", isCorrect: false, feedback: "창의성은 체크리스트의 목적이 아니에요." },
                    { text: "자유", isCorrect: false, feedback: "자유로운 선택과는 거리가 있어요." },
                    { text: "속도", isCorrect: false, feedback: "속도보다 정확성이 중요해요." }
                ]
            },
            {
                id: 2,
                questionKor: "체크리스트는 언제 특히 도움이 돼요?",
                sentence_pre: "체크리스트는 일이 ",
                sentence_post: " 때 더 필요해요.",
                correct_word: "복잡할",
                translation: "Checklists are especially needed when tasks are complex.",
                hint: "Not simple.",
                options: [
                    { text: "복잡할", isCorrect: true, feedback: "해야 할 일이 많을수록 도움이 돼요." },
                    { text: "간단할", isCorrect: false, feedback: "간단한 일에는 꼭 필요하지 않아요." },
                    { text: "창의적일", isCorrect: false, feedback: "창의적인 일에는 한계가 있어요." },
                    { text: "즉흥적일", isCorrect: false, feedback: "즉흥적인 판단과는 맞지 않아요." }
                ]
            },
            {
                id: 3,
                questionKor: "체크리스트가 있으면 우리는 보통 어떻게 해요?",
                sentence_pre: "체크리스트가 있으면 우리는 절차를 그냥 ",
                sentence_post: " 돼요.",
                correct_word: "따르면",
                translation: "With a checklist, we just follow the procedure.",
                hint: "Follow the steps.",
                options: [
                    { text: "따르면", isCorrect: true, feedback: "스스로 생각하지 않아도 되는 경우가 있어요." },
                    { text: "만들면", isCorrect: false, feedback: "사용 방법에 대한 설명이에요." },
                    { text: "의심하면", isCorrect: false, feedback: "체크리스트의 목적과 달라요." },
                    { text: "바꾸면", isCorrect: false, feedback: "절차는 보통 정해져 있어요." }
                ]
            },
            {
                id: 4,
                questionKor: "민지가 말한 체크리스트의 나쁜 점은 뭐예요?",
                sentence_pre: "체크리스트의 단점은 생각을 ",
                sentence_post: " 않는다는 거예요.",
                correct_word: "필요로 하지",
                translation: "A downside of checklists is that they don’t require thinking.",
                hint: "You don’t need to think.",
                options: [
                    { text: "필요로 하지", isCorrect: true, feedback: "민지가 직접 말한 단점이에요." },
                    { text: "강요하지", isCorrect: false, feedback: "의미가 달라요." },
                    { text: "도와주지", isCorrect: false, feedback: "생각을 도와주는 건 아니에요." },
                    { text: "훈련하지", isCorrect: false, feedback: "훈련 이야기는 아니에요." }
                ]
            },
            {
                id: 5,
                questionKor: "창의적인 일에 체크리스트가 잘 안 맞는 이유는 뭐예요?",
                sentence_pre: "창의적인 일에는 정해진 ",
                sentence_post: "가 없기 때문이에요.",
                correct_word: "순서",
                translation: "Creative work doesn’t have a fixed order.",
                hint: "Fixed steps.",
                options: [
                    { text: "순서", isCorrect: true, feedback: "그래서 체크리스트가 어렵게 느껴질 수 있어요." },
                    { text: "도구", isCorrect: false, feedback: "도구의 문제가 아니에요." },
                    { text: "규칙", isCorrect: false, feedback: "규칙보다 사고가 중요해요." },
                    { text: "사람", isCorrect: false, feedback: "사람의 문제가 아니에요." }
                ]
            },
            {
                id: 6,
                questionKor: "노드스트롬 사례에서 가장 중요한 건 뭐예요?",
                sentence_pre: "직원은 스스로 ",
                sentence_post: "해서 결정해야 해요.",
                correct_word: "판단",
                translation: "Employees must judge for themselves.",
                hint: "Decide by yourself.",
                options: [
                    { text: "판단", isCorrect: true, feedback: "체크리스트와 반대되는 사고 방식이에요." },
                    { text: "보고", isCorrect: false, feedback: "보고서 이야기는 아니에요." },
                    { text: "기억", isCorrect: false, feedback: "외우는 것이 핵심은 아니에요." },
                    { text: "확인", isCorrect: false, feedback: "확인할 리스트가 없어요." }
                ]
            },
            {
                id: 7,
                questionKor: "판단한 다음에는 무엇이 필요해요?",
                sentence_pre: "스스로 판단하고 바로 ",
                sentence_post: "해야 해요.",
                correct_word: "행동",
                translation: "After judging, you need to act.",
                hint: "Do something.",
                options: [
                    { text: "행동", isCorrect: true, feedback: "생각만 하면 상황이 바뀌지 않아요." },
                    { text: "대기", isCorrect: false, feedback: "기다리는 상황이 아니에요." },
                    { text: "보고", isCorrect: false, feedback: "보고보다 대응이 중요해요." },
                    { text: "체크", isCorrect: false, feedback: "체크리스트가 없는 상황이에요." }
                ]
            },
            {
                id: 8,
                questionKor: "민지는 체크리스트를 뭐라고 설명했어요?",
                sentence_pre: "체크리스트는 마법이 아니라 ",
                sentence_post: "예요.",
                correct_word: "도구",
                translation: "A checklist is a tool, not magic.",
                hint: "Something you use.",
                options: [
                    { text: "도구", isCorrect: true, feedback: "상황에 맞게 써야 해요." },
                    { text: "정답", isCorrect: false, feedback: "모든 문제를 해결하지는 못해요." },
                    { text: "규칙", isCorrect: false, feedback: "항상 따라야 하는 건 아니에요." },
                    { text: "목표", isCorrect: false, feedback: "목표가 아니라 수단이에요." }
                ]
            },
            {
                id: 9,
                questionKor: "체크리스트가 잘 맞는 일의 특징은 뭐예요?",
                sentence_pre: "체크리스트는 순서가 정해진 ",
                sentence_post: "에 잘 맞아요.",
                correct_word: "일",
                translation: "Checklists work well for tasks with a fixed order.",
                hint: "Tasks.",
                options: [
                    { text: "일", isCorrect: true, feedback: "수술이나 비행기 조종 같은 일이에요." },
                    { text: "생각", isCorrect: false, feedback: "사고 과정 자체는 아니에요." },
                    { text: "문제", isCorrect: false, feedback: "모든 문제에 맞지는 않아요." },
                    { text: "창의", isCorrect: false, feedback: "창의적인 일은 예외예요." }
                ]
            },
            {
                id: 10,
                questionKor: "결론적으로 체크리스트에 대해 뭐라고 했어요?",
                sentence_pre: "체크리스트에는 ",
                sentence_post: "과 단점이 있어요.",
                correct_word: "장점",
                translation: "In conclusion, checklists have both advantages and disadvantages.",
                hint: "Good points.",
                options: [
                    { text: "장점", isCorrect: true, feedback: "그래서 상황에 맞게 써야 해요." },
                    { text: "규칙", isCorrect: false, feedback: "규칙 이야기만 한 건 아니에요." },
                    { text: "문제", isCorrect: false, feedback: "문제만 있는 건 아니에요." },
                    { text: "한계", isCorrect: false, feedback: "한계만 강조하지는 않았어요." }
                ]
            }
        ];

        const SCRIPT_DATA = [
            { id: 's1', speaker: '민지', kor: '안녕하세요. 여러분 저는 민지예요.', time: [1.500, 4.300], eng: "Hello everyone, I'm Minji." },
            { id: 's2', speaker: '민호', kor: '저는 민호예요.', time: [4.369, 5.542], eng: "I'm Minho." },
            { id: 's3', speaker: '민호', kor: '오늘은 체크리스트에 대해 이야기 해볼게요.', time: [5.738, 8.800], eng: "Today let's talk about checklists." },
            { id: 's4', speaker: '민지', kor: '네 맞아요. 오늘 저희의 질문은 바로 이거예요.', time: [8.881, 12.773], eng: "Yes, that's right. Our question today is this." },
            { id: 's5', speaker: '민지', kor: '체크리스트가 사람들을 멍청하게 만들까요?', time: [12.980, 17.334], eng: "Do checklists make people stupid?" },
            { id: 's6', speaker: '민호', kor: '아주 흥미로운 질문이네요.', time: [17.426, 19.752], eng: "That's a very interesting question." },
            { id: 's7', speaker: '민호', kor: '민지 씨는 체크리스트를 자주 사용해요?', time: [20.224, 23.208], eng: "Do you use checklists often, Minji?" },
            { id: 's8', speaker: '민지', kor: '네, 저는 자주 사용해요.', time: [23.346, 25.364], eng: "Yes, I use them often." },
            { id: 's9', speaker: '민지', kor: '특히 장보기 할 때나 여행 준비할 때요.', time: [25.468, 28.624], eng: "Especially when grocery shopping or preparing for a trip." },
            { id: 's10', speaker: '민지', kor: '민호 씨는요?', time: [28.693, 29.777], eng: "How about you, Minho?" },
            { id: 's11', speaker: '민호', kor: '저도 가끔 써요.', time: [30.000, 31.539], eng: "I use them sometimes too." },
            { id: 's12', speaker: '민호', kor: '그런데 체크리스트에는 장점과 단점이 있는 것 같아요.', time: [31.723, 36.690], eng: "But I think checklists have pros and cons." },
            { id: 's13', speaker: '민지', kor: '맞아요. 먼저 장점부터 이야기해 볼까요?', time: [37.000, 40.812], eng: "Right. Shall we talk about the pros first?" },
            { id: 's14', speaker: '민지', kor: '의사들이 수술할 때 체크리스트를 사용한다고 들었어요.', time: [41.031, 45.892], eng: "I heard doctors use checklists during surgery." },
            { id: 's15', speaker: '민지', kor: '그렇지 않으면 의사들이 실수를 자주 한다고 해요.', time: [46.000, 50.285], eng: "Otherwise, they say doctors make mistakes often." },
            { id: 's16', speaker: '민지', kor: '어떤 의사는 수술할 때 환자의 몸 안에 수술 도구를 놓고 나왔다고 해요.', time: [50.366, 57.634], eng: "They say a doctor left a surgical tool inside a patient's body during surgery." },
            { id: 's17', speaker: '민호', kor: '생각만 해도 끔찍하네요.', time: [57.634, 59.722], eng: "That's terrible just thinking about it." },
            { id: 's18', speaker: '민지', kor: '그쵸. 그래서 체크리스트를 사용하는 거예요.', time: [59.900, 63.482], eng: "Right. That's why they use checklists." },
            { id: 's19', speaker: '민지', kor: '비행기 조종사들도 체크리스트를 사용해요.', time: [63.747, 66.868], eng: "Airplane pilots also use checklists." },
            { id: 's20', speaker: '민지', kor: '비행기를 조종할 때 19가지 일을 해야 하는데,', time: [66.972, 70.793], eng: "When flying a plane, they have to do 19 things," },
            { id: 's21', speaker: '민지', kor: '18가지만 하면 큰 문제가 생길 수 있어요.', time: [70.862, 74.600], eng: "but if they only do 18, a big problem can occur." },
            { id: 's22', speaker: '민지', kor: '체크리스트는 이런 복잡한 상황에서 실수를 줄여줄 수 있어요.', time: [74.860, 79.893], eng: "Checklists can reduce mistakes in these complex situations." },
            { id: 's23', speaker: '민호', kor: '이해가 돼요.', time: [80.034, 81.171], eng: "I understand." },
            { id: 's24', speaker: '민호', kor: '수술이나 비행기 조종처럼 절차를 따라야 하는 일에는 체크리스트가 정말 중요할 것 같아요.', time: [81.528, 88.797], eng: "Like surgery or flying a plane, for tasks where you have to follow procedures, checklists seem really important." },
            { id: 's25', speaker: '민호', kor: '그런데 창의적인 일을 할 때도 체크리스트가 필요할까요?', time: [89.268, 94.234], eng: "But are checklists necessary when doing creative work?" },
            { id: 's26', speaker: '민호', kor: '그리고 문제를 해결해야 하는 상황에서도 체크리스트가 필요할까요?', time: [94.452, 99.810], eng: "And are they necessary in situations where we have to solve problems?" },
            { id: 's27', speaker: '민지', kor: '아뇨, 우리는 어떤 상황에서 생각을 해야 해요.', time: [100.616, 105.553], eng: "No, we have to think in some situations." },
            { id: 's28', speaker: '민지', kor: '하지만 체크리스트는 생각을 필요로 하지 않아요.', time: [105.841, 108.796], eng: "But checklists don't require thinking." },
            { id: 's29', speaker: '민지', kor: '우리는 그냥 기계처럼 절차를 따르면 돼요.', time: [108.900, 112.359], eng: "We just follow the procedure like a machine." },
            { id: 's30', speaker: '민지', kor: '그게 체크리스트의 단점이에요.', time: [112.519, 115.067], eng: "That is the disadvantage of checklists." },
            { id: 's31', speaker: '민지', kor: '그래서 노드스트롬(Nordstrom) 백화점에서는 직원들에게 하나의 규칙만 알려준다고 해요.', time: [115.195, 122.157], eng: "So at Nordstrom department store, they tell employees only one rule." },
            { id: 's32', speaker: '민지', kor: '"바로 스스로 판단해서 행동하세요"라는 규칙이에요.', time: [122.238, 127.338], eng: "The rule is 'Use your own judgment immediately and act'." },
            { id: 's33', speaker: '민호', kor: '아, 체크리스트랑은 정반대네요.', time: [127.396, 131.559], eng: "Ah, that's the exact opposite of a checklist." },
            { id: 's34', speaker: '민지', kor: '네, 예를 들어, VIP 손님이 신발을 가져와서 환불해 달라고 해요.', time: [131.881, 138.230], eng: "Yes, for example, a VIP customer brings shoes and asks for a refund." },
            { id: 's35', speaker: '민지', kor: '그런데 그 손님이 그 신발을 2년 동안 신었어요.', time: [138.472, 142.776], eng: "But the customer wore those shoes for 2 years." },
            { id: 's36', speaker: '민지', kor: '이때 직원이 어떻게 해야 할까요?', time: [142.914, 145.642], eng: "What should the employee do in this case?" },
            { id: 's37', speaker: '민지', kor: '이런 상황을 위한 체크리스트는 없어요.', time: [145.700, 149.011], eng: "There is no checklist for this kind of situation." },
            { id: 's38', speaker: '민지', kor: '직원이 상황에 맞춰 스스로 가장 좋은 방법을 생각해야 하죠.', time: [149.103, 154.438], eng: "The employee has to think of the best way themselves according to the situation." },
            { id: 's39', speaker: '민지', kor: '이럴 때는 스스로 생각하는 능력이 필요해요.', time: [154.565, 158.624], eng: "In this case, the ability to think for yourself is needed." },
            { id: 's40', speaker: '민호', kor: '그렇군요. 그럼 결국 상황에 따라 다른 거네요.', time: [158.912, 163.385], eng: "I see. So ultimately it depends on the situation." },
            { id: 's41', speaker: '민지', kor: '맞아요. 체크리스트는 마법이 아니에요.', time: [163.500, 167.176], eng: "Right. Checklists are not magic." },
            { id: 's42', speaker: '민지', kor: '모든 문제를 해결해 줄 수 없어요.', time: [167.372, 169.688], eng: "They can't solve every problem." },
            { id: 's43', speaker: '민지', kor: '체크리스트는 그냥 도구예요.', time: [169.780, 172.204], eng: "Checklists are just tools." },
            { id: 's44', speaker: '민지', kor: '복잡하지만 순서가 정해진 일에는 체크리스트가 좋아요.', time: [172.468, 176.418], eng: "Checklists are good for complex but ordered tasks." },
            { id: 's45', speaker: '민지', kor: '하지만 창의성이나 판단이 필요한 일에는 생각하는 능력이 더 좋아요.', time: [176.522, 182.255], eng: "But for work requiring creativity or judgment, the ability to think is better." },
            { id: 's46', speaker: '민호', kor: '저도 골프 칠 때 저만의 머릿속 체크리스트가 있어요.', time: [182.554, 187.814], eng: "I also have my own mental checklist when playing golf." },
            { id: 's47', speaker: '민호', kor: '어깨에 힘 빼기, 공 끝까지 보기 같은 거요.', time: [188.060, 192.246], eng: "Relax shoulders, keep eye on the ball, things like that." },
            { id: 's48', speaker: '민호', kor: '그런데 가끔 잊어버릴 때가 있어요.', time: [192.511, 195.296], eng: "But sometimes I forget." },
            { id: 's49', speaker: '민지', kor: '체크리스트를 확인할 뿐만 아니라 진짜로 실행하는 게 중요해요.', time: [195.365, 201.204], eng: "It's important not just to check the checklist but to actually execute it." },
            { id: 's50', speaker: '민호', kor: '오늘의 대화를 요약해 볼게요.', time: [201.354, 203.853], eng: "Let me summarize today's conversation." },
            { id: 's51', speaker: '민호', kor: '체크리스트가 우리를 멍청하게 만드는 건 아니에요.', time: [204.233, 207.560], eng: "Checklists don't make us stupid." },
            { id: 's52', speaker: '민호', kor: '하지만 언제 어떻게 사용하는지가 중요해요.', time: [207.617, 211.007], eng: "But when and how we use them is important." },
            { id: 's53', speaker: '민호', kor: '상황에 맞게 도구를 잘 사용해야 하죠.', time: [211.467, 214.000], eng: "We have to use the tool well according to the situation." },
            { id: 's54', speaker: '민호', kor: '그게 지혜로운 거죠.', time: [214.046, 215.346], eng: "That is being wise." },
            { id: 's55', speaker: '민지', kor: '네 맞아요.', time: [215.438, 216.534], eng: "Yes, that's right." },
            { id: 's56', speaker: '민지', kor: '그럼 오늘은 여기까지 할까요?', time: [216.592, 218.845], eng: "Shall we stop here for today?" },
            { id: 's57', speaker: '민호', kor: '안녕히 계세요.', time: [218.925, 220.222], eng: "Goodbye." },
            { id: 's58', speaker: '민호', kor: '안녕히 계세요. 다음에 또 만나요.', time: [220.268, 226.242], eng: "Goodbye. See you next time." }
        ];

        const DISCUSS_DATA = [
            {
                id: 1,
                question: "1. 여러분은 체크리스트를 자주 사용해요? 어떤 상황에서 체크리스트를 사용해요?",
                translation: "Do you use checklists often? In what situations do you use them?",
                keyVocab: [
                    { term: "자주 사용하다", meaning_eng: "to use often" },
                    { term: "상황", meaning_eng: "situation" },
                    { term: "~할 때", meaning_eng: "when (doing something)" }
                ]
            },
            {
                id: 2,
                question: "2. 장보기나 여행 준비를 할 때 체크리스트가 왜 도움이 된다고 생각해요?",
                translation: "Why do you think checklists are helpful when shopping or preparing for a trip?",
                keyVocab: [
                    { term: "장보기", meaning_eng: "grocery shopping" },
                    { term: "여행 준비", meaning_eng: "travel preparation" },
                    { term: "도움이 되다", meaning_eng: "to be helpful" }
                ]
            },
            {
                id: 3,
                question: "3. 체크리스트를 사용하지 않아서 실수를 한 적이 있어요? 어떤 일이 있었어요?",
                translation: "Have you ever made a mistake because you didn’t use a checklist? What happened?",
                keyVocab: [
                    { term: "사용하지 않다", meaning_eng: "to not use" },
                    { term: "실수하다", meaning_eng: "to make a mistake" },
                    { term: "일이 생기다", meaning_eng: "something happens" }
                ]
            },
            {
                id: 4,
                question: "4. 의사나 비행기 조종사처럼 실수가 위험한 직업에는 체크리스트가 꼭 필요할까요? 왜요?",
                translation: "Do jobs where mistakes are dangerous, like doctors or pilots, need checklists? Why?",
                keyVocab: [
                    { term: "위험하다", meaning_eng: "to be dangerous" },
                    { term: "직업", meaning_eng: "job / profession" },
                    { term: "꼭 필요하다", meaning_eng: "to be absolutely necessary" }
                ]
            },
            {
                id: 5,
                question: "5. 체크리스트가 있으면 사람들이 덜 생각하게 된다고 생각해요? 아니면 더 안전해진다고 생각해요?",
                translation: "Do you think checklists make people think less, or make things safer?",
                keyVocab: [
                    { term: "덜", meaning_eng: "less" },
                    { term: "생각하다", meaning_eng: "to think" },
                    { term: "안전하다", meaning_eng: "to be safe" }
                ]
            },
            {
                id: 6,
                question: "6. 창의적인 일을 할 때 체크리스트를 사용하면 어떤 문제가 생길 수 있을까요?",
                translation: "What problems might happen if you use a checklist when doing creative work?",
                keyVocab: [
                    { term: "창의적인 일", meaning_eng: "creative work" },
                    { term: "문제", meaning_eng: "problem" },
                    { term: "생길 수 있다", meaning_eng: "might happen" }
                ]
            },
            {
                id: 7,
                question: "7. ‘절차를 따르는 것’과 ‘스스로 판단하는 것’은 어떻게 다르다고 생각해요?",
                translation: "How do you think following procedures and judging for yourself are different?",
                keyVocab: [
                    { term: "절차", meaning_eng: "procedure" },
                    { term: "따르다", meaning_eng: "to follow" },
                    { term: "스스로 판단하다", meaning_eng: "to judge for oneself" }
                ]
            },
            {
                id: 8,
                question: "8. 노드스트롬 백화점 직원처럼 체크리스트 없이 행동해야 하는 상황은 어떤 상황일까요?",
                translation: "What kind of situations require acting without a checklist, like Nordstrom employees?",
                keyVocab: [
                    { term: "직원", meaning_eng: "employee" },
                    { term: "행동하다", meaning_eng: "to act" },
                    { term: "상황에 맞다", meaning_eng: "to fit the situation" }
                ]
            },
            {
                id: 9,
                question: "9. 여러분의 일상에서 체크리스트보다 ‘생각하는 능력’이 더 중요한 순간은 언제예요?",
                translation: "When in your daily life is thinking ability more important than a checklist?",
                keyVocab: [
                    { term: "일상", meaning_eng: "daily life" },
                    { term: "능력", meaning_eng: "ability" },
                    { term: "더 중요하다", meaning_eng: "to be more important" }
                ]
            },
            {
                id: 10,
                question: "10. 이 대화를 듣고 나서, ‘체크리스트가 사람들을 멍청하게 만든다’는 질문에 어떻게 대답하고 싶어요?",
                translation: "After listening to this dialogue, how would you answer the question: 'Do checklists make people stupid?'",
                keyVocab: [
                    { term: "대화를 듣다", meaning_eng: "to listen to a conversation" },
                    { term: "생각이 바뀌다", meaning_eng: "one’s opinion changes" },
                    { term: "~에 대해 대답하다", meaning_eng: "to answer about" }
                ]
            }
        ];

        const LEVEL_STYLES = { "A1": "bg-lime-50 text-lime-600 border-lime-100", "A1+": "bg-lime-50 text-lime-600 border-lime-100", "A2": "bg-green-50 text-green-600 border-green-100", "A2+": "bg-green-50 text-green-600 border-green-100", "B1": "bg-sky-50 text-sky-600 border-sky-100", "B1+": "bg-sky-50 text-sky-600 border-sky-100", "B2": "bg-blue-50 text-blue-600 border-blue-100", "B2+": "bg-blue-50 text-blue-600 border-blue-100", "C1": "bg-violet-50 text-violet-600 border-violet-100", "C1+": "bg-violet-50 text-violet-600 border-violet-100", "C2": "bg-violet-50 text-violet-600 border-violet-100" };
        const getLevelTheme = (l) => { const c = l.charAt(0); if(c==='A')return l==='A1'||l==='A1+'?'lime':'green'; if(c==='B')return l==='B1'||l==='B1+'?'sky':'blue'; return 'violet'; };

        // --- Icons ---
        const HomeIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="3" width="20" height="14" rx="2" ry="2" /><path d="M8 21h8" /><path d="M12 17v4" /></svg>);
        const LearnIcon = ({ className, filled }) => (<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="4" width="20" height="16" rx="4" fill={filled ? "currentColor" : "none"} /><polygon points="10 8 16 12 10 16 10 8" stroke={filled ? "#fff" : "currentColor"} fill={filled ? "#fff" : "none"} /></svg>);
        const VocabIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3.5 12.5 12.5 3.5h6a2 2 0 0 1 2 2v6l-9 9a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8Z" stroke="currentColor" strokeWidth="1.8"/><path d="M16.5 7.5h.01" stroke="currentColor" strokeWidth="3.2" strokeLinecap="round"/></svg>);
        const QuizIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" className={className}><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" strokeWidth="1.8"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/><path d="M12 17h.01" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>);
        const DiscussIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" className={className}><path d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-2v3l-4.5-3H6a3 3 0 0 1-3-3V6Z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round"/><path d="M7 8h10M7 12h7" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/></svg>);
        const UserIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>);
        const LineIcon = ({ d, className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>);
        const PlayIconLine = (props) => <LineIcon {...props} d="M5 3l14 9-14 9V3z" />;
        const PlayIconSolid = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M8 5v14l11-7z" /></svg>);
        const PauseIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" /></svg>);
        const OpenBookSolidIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 6 C2 3 8 2 12 6 C16 2 22 3 22 6 V20 C22 17 16 16 12 20 C8 16 2 17 2 20 Z" /><path d="M12 6 V20" /><path d="M4.5 15 L7 9 L9.5 15" strokeWidth="1.5" /><path d="M5.5 13 H8.5" strokeWidth="1.5" /><path d="M15 10 H19" strokeWidth="1.5" /><path d="M15 13 H19" strokeWidth="1.5" /><path d="M15 16 H18" strokeWidth="1.5" /></svg>);
        const TranslateIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.09-.02.67-.02zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z" /></svg>);
        const ExternalLinkIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg>);
        const ChevronLeft = ({ className }) => <LineIcon d="m15 18-6-6 6-6" className={className}/>;
        const ChevronRight = ({ className }) => <LineIcon d="m9 18 6-6-6-6" className={className}/>;
        const SpeedSolidIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/></svg>);
        const SparklesIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 00-1.423 1.423z" /></svg>);
        const RewindIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 19 2 12 11 5 11 19" /><polygon points="22 19 13 12 22 5 22 19" /></svg>);
        const ForwardIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 19 22 12 13 5 13 19" /><polygon points="2 19 11 12 2 5 2 19" /></svg>);
        const PlayCircleIcon = ({ className }) => (<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}><circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="1.8" /><path d="M10 8L16 12L10 16V8Z" fill="currentColor" /></svg>);

        // --- Sidebar Component ---
        const Sidebar = ({ activeTab, setActiveTab, isCollapsed, toggleSidebar, userLevel, themeColor }) => {
            const menus = [
                { id: 'home', label: '시작 페이지', subLabel: 'Home Page', icon: HomeIcon },
                { id: 'learn', label: '동영상 자료', subLabel: 'Video Resources', icon: LearnIcon },
                { id: 'vocab', label: '핵심 어휘', subLabel: 'Key Vocabulary', icon: VocabIcon },
                { id: 'quiz', label: '내용 확인 퀴즈', subLabel: 'Comprehension Quiz', icon: QuizIcon },
                { id: 'discuss', label: '생각해 보기', subLabel: 'Food For Thought', icon: DiscussIcon },
            ];
            const getLevelColor = (code) => { if (LEVEL_STYLES[code]) return LEVEL_STYLES[code]; const base = code.substring(0, 2); return LEVEL_STYLES[base] || "bg-gray-50 text-slate-600 border-gray-100"; };
            const currentStyle = getLevelColor(userLevel);
            const bgClass = currentStyle.split(' ')[0];
            const textClass = currentStyle.split(' ')[1];
            const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, info: null });
            const handleLevelTextEnter = (e) => { const rect = e.target.getBoundingClientRect(); setTooltip({ show: true, x: rect.right, y: rect.top, info: LEVEL_DEFINITIONS[userLevel] }); };
            const handleLevelTextLeave = () => { setTooltip(prev => ({ ...prev, show: false })); };

            // Sidebar styles with em units based on parent font size
            const sidebarFontSize = isCollapsed ? '1rem' : '1.15rem';
            const sidebarWidth = isCollapsed ? '5.5rem' : '18.4rem'; // 88px -> 5.5rem, 16rem*1.15 -> 18.4rem

            return (
                <aside 
                    style={{ fontSize: sidebarFontSize, width: sidebarWidth }}
                    className={`bg-white border-r border-gray-200 fixed h-full hidden lg:flex flex-col z-50 transition-all duration-300 ease-in-out font-basic`}
                >
                    <div className={`p-[1.5em] flex items-center gap-[0.75em] relative ${isCollapsed ? 'justify-center px-0' : ''}`}>
                        <img src="https://raw.githubusercontent.com/openkoreanlearninglab/hub/refs/heads/main/OpenKoreanLearningLab_Logo.jpeg" alt="Logo" className={`rounded-2xl shadow-lg shrink-0 transition-all duration-300 object-cover ${isCollapsed ? 'w-[3em] h-[3em]' : 'w-[3.75em] h-[3.75em]'}`}/>
                        {!isCollapsed && (<div className="animate-fade-in overflow-hidden whitespace-nowrap flex flex-col justify-center"><span className="font-extrabold text-[1.25em] text-black leading-tight font-cafe24-deco">Open</span><span className={`font-bold text-[0.68em] leading-tight font-mustache ${textClass}`}>KoreanLearningLab</span></div>)}
                        <button onClick={toggleSidebar} className="absolute -right-[0.75em] top-1/2 -translate-y-1/2 bg-white border border-gray-200 rounded-full p-[0.25em] shadow-sm text-slate-500 hover:text-slate-700 hover:bg-gray-50 transition-colors z-10">{isCollapsed ? <ChevronRight className="w-[0.75em] h-[0.75em]" /> : <ChevronLeft className="w-[0.75em] h-[0.75em]" />}</button>
                    </div>
                    <nav className={`flex-1 space-y-[0.75em] mt-[1em] ${isCollapsed ? 'px-[0.75em]' : 'px-[0.75em]'}`}>
                        {menus.map((menu) => {
                            const IconComp = menu.icon; const isActive = activeTab === menu.id; const activeFontClass = isActive ? "font-cafe24-surround" : "font-cafe24";
                            return (
                                <button key={menu.id} 
                                    onClick={() => { 
                                        setActiveTab(menu.id); 
                                        // Auto-collapse logic when clicking 'learn'
                                        if (menu.id === 'learn' && !isCollapsed) toggleSidebar(); 
                                        else if (menu.id !== 'learn' && isCollapsed) toggleSidebar(); 
                                    }} 
                                    onDoubleClick={toggleSidebar} 
                                    className={`w-full flex items-center transition-all duration-200 group relative ${isCollapsed ? 'justify-center h-[3.5em] rounded-2xl' : 'gap-[0.75em] px-[0.75em] py-[1em] rounded-2xl'} ${isActive ? `bg-${themeColor}-50 text-${themeColor}-600` : 'text-slate-700 hover:bg-gray-50 hover:text-slate-900'}`}
                                >
                                    {isActive && <div className={`absolute left-0 top-1/2 -translate-y-1/2 bg-${themeColor}-500 rounded-r-lg ${isCollapsed ? 'w-[0.375em] h-[2em]' : 'w-[0.25em] h-[1.5em]'}`}></div>}
                                    <IconComp className={`shrink-0 transition-all duration-200 ${isCollapsed ? 'w-[2em] h-[2em]' : 'w-[1.75em] h-[1.75em]'} ${isActive ? `text-${themeColor}-600` : 'text-slate-400 group-hover:text-slate-900'}`} filled={isActive} />
                                    {!isCollapsed && (<div className="flex flex-col items-start animate-fade-in overflow-hidden whitespace-nowrap"><span className={`text-[0.875em] leading-tight transition-all ${activeFontClass} ${isActive ? `font-extrabold text-${themeColor}-600` : 'font-medium text-slate-700 group-hover:font-semibold group-hover:text-slate-900'}`}>{menu.label}</span><span className="text-[0.625em] font-normal text-slate-400 mt-[0.125em] leading-tight">{menu.subLabel}</span></div>)}
                                    {isCollapsed && (<div className="absolute left-full ml-[0.75em] px-[0.75em] py-[0.375em] bg-slate-900 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-xl flex flex-col items-start"><span className="text-[0.75em] font-bold">{menu.label}</span><span className="text-[0.625em] opacity-80">{menu.subLabel}</span><div className="absolute top-1/2 -left-[0.25em] -translate-y-1/2 w-[0.5em] h-[0.5em] bg-slate-900 rotate-45"></div></div>)}
                                </button>
                            );
                        })}
                    </nav>
                    <div className="p-[0.5em] border-t border-gray-100">
                        <div className={`flex items-center gap-[0.75em] p-[0.5em] rounded-xl transition-colors hover:bg-gray-50 cursor-pointer ${isCollapsed ? 'justify-center' : ''}`}>
                            <div className={`w-[2.75em] h-[2.75em] rounded-xl flex items-center justify-center shrink-0 transition-colors duration-300 ${bgClass} border ${currentStyle.split(' ')[2]}`}><span className={`text-[1em] font-extrabold font-school-smile ${currentStyle.replace('bg-', 'text-').replace('50', '600')}`}>{userLevel}</span></div>
                            {!isCollapsed && (<div className="animate-fade-in overflow-hidden whitespace-nowrap flex-1"><p className="text-[0.875em] font-bold text-slate-900 mb-[0.0625em] font-basic">학습자(Learner)</p><div className="mt-[0.0625em]"><span className={`block w-fit px-[0.125em] py-[0.125em] rounded text-[0.625em] font-semibold border uppercase tracking-wide shadow-sm text-left cursor-help font-basic ${currentStyle}`} onMouseEnter={handleLevelTextEnter} onMouseLeave={handleLevelTextLeave}>Level: {LEVEL_DEFINITIONS[userLevel].title}</span></div></div>)}
                        </div>
                    </div>
                    {tooltip.show && tooltip.info && createPortal(<div className="fixed z-[9999] pointer-events-none animate-fade-in" style={{ left: tooltip.x, top: tooltip.y }}><div className="relative bg-slate-900/95 backdrop-blur text-white text-[0.75em] rounded-xl p-[1em] shadow-2xl transform -translate-y-full -translate-x-[1.5em] -mt-[0.75em] w-[16em] border border-slate-700/50"><p className={`font-bold mb-[0.375em] text-[0.875em] text-${themeColor}-300`}>{userLevel} – {tooltip.info.title}</p><p className="opacity-90 leading-relaxed font-medium text-slate-200">{tooltip.info.desc}</p><div className="absolute -bottom-[0.375em] left-[1em] w-[0.75em] h-[0.75em] bg-slate-900/95 border-r border-b border-slate-700/50 rotate-45"></div></div></div>, document.body)}
                </aside>
            );
        };

        const LevelBadge = ({ levelCode }) => {
            const [isHovered, setIsHovered] = useState(false);
            const info = LEVEL_DEFINITIONS[levelCode] || LEVEL_DEFINITIONS["A2+"];
            const getLevelStyle = (code) => { if (LEVEL_STYLES[code]) return LEVEL_STYLES[code]; const base = code.substring(0, 2); return LEVEL_STYLES[base] || "bg-gray-50 text-slate-600 border-gray-100"; };
            const badgeStyle = getLevelStyle(levelCode);
            return (
                <div className="relative inline-flex items-center cursor-help z-50" onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}><span className={`px-[0.5em] py-[0.125em] rounded text-[0.625em] font-bold border uppercase tracking-wide shadow-sm font-sunflower ${badgeStyle}`}>Level: {info.title}</span>{isHovered && (<div className="absolute top-full left-0 mt-[0.5em] w-[16em] bg-slate-900/95 backdrop-blur text-white text-[0.75em] rounded-xl p-[1em] shadow-xl z-[100] animate-fade-in text-left"><p className={`font-bold mb-[0.375em] text-[0.875em] ${badgeStyle.split(' ')[1]}`}>{levelCode} – {info.title}</p><p className="opacity-90 leading-relaxed font-medium">{info.desc}</p><div className="absolute -top-[0.25em] left-[1em] w-[0.5em] h-[0.5em] bg-slate-900/95 rotate-45"></div></div>)}</div>
            );
        };

        const callGeminiWithBackoff = async (payload) => {
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i <= delays.length; i++) { try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) throw new Error(`API error: ${response.statusText}`); return await response.json(); } catch (error) { if (i === delays.length) throw error; await new Promise(resolve => setTimeout(resolve, delays[i])); } }
        };

        const FeedbackSection = ({ value, onChange, placeholder, question, keyPhrases, themeColor }) => {
            const [feedback, setFeedback] = useState(null); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(null);
            const checkSentence = async () => {
                if (!value || value.trim() === '') { setError("문장을 입력해야 피드백을 받을 수 있어요."); setFeedback(null); return; }
                setIsLoading(true); setError(null); setFeedback(null);
                const systemPrompt = `You are an advanced Korean language tutor AI for A2 level learners...`; 
                const payload = { contents: [{ role: "user", parts: [{ text: systemPrompt }, { text: `Question: "${question}"\nUser's Answer: "${value}"` }] }], generationConfig: { responseMimeType: "application/json", responseSchema: { type: "OBJECT", properties: { "is_relevant": { "type": "BOOLEAN" }, "relevance_feedback_eng": { "type": "STRING", "nullable": true }, "is_correct": { "type": "BOOLEAN", "nullable": true }, "feedback_message_eng": { "type": "STRING", "nullable": true }, "corrected_sentence": { "type": "STRING", "nullable": true }, "explanation_eng": { "type": "STRING", "nullable": true } } } } };
                try { const result = await callGeminiWithBackoff(payload); if (result.candidates?.[0]?.content?.parts?.[0]?.text) setFeedback(JSON.parse(result.candidates[0].content.parts[0].text)); else setError("AI의 응답을 처리하는 데 문제가 발생했어요."); } catch (err) { setError("문장 검사에 실패했어요. 다시 시도해 주세요."); } finally { setIsLoading(false); }
            };
            return (
                <div>
                    {keyPhrases}
                    <div>
                        <h4 className="font-bold text-slate-900 mb-[0.75em] text-[1em]">핵심 표현을 사용해서 질문에 대답해 보세요.</h4>
                        <textarea value={value} onChange={onChange} placeholder={placeholder} className={`w-full p-[1em] rounded-xl border border-gray-200 focus:border-${themeColor}-500 focus:ring-1 focus:ring-${themeColor}-500 outline-none min-h-[7.5em] resize-none text-[1em] text-slate-800 placeholder-gray-400 mb-[0.75em]`}></textarea>
                        <button onClick={checkSentence} disabled={!value.trim() || isLoading} className={`flex items-center gap-[0.5em] px-[1.25em] py-[0.375em] text-[0.75em] leading-tight rounded-xl font-bold transition-all shadow-sm ${!value.trim() || isLoading ? 'bg-gray-100 text-slate-400 cursor-not-allowed' : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md'}`}>{isLoading ? <span>분석 중...</span> : <> <SparklesIcon className="w-[1.25em] h-[1.25em]" /> <span>AI Feedback (피드백 받기)</span> </>}</button>
                        {error && <div className="mt-[1em] p-[1em] bg-red-50 text-red-600 rounded-xl border border-red-200 text-[0.875em] font-medium animate-fade-in">{error}</div>}
                        {feedback && (
                            <div className={`mt-[1.5em] rounded-2xl p-[1.5em] border animate-fade-in ${feedback.is_correct ? `bg-${themeColor}-50 border-${themeColor}-200` : 'bg-yellow-50 border-yellow-200'}`}>
                                <div className="flex items-center gap-[0.5em] mb-[1em]"><span className="text-[1.5em]">🤖</span><h4 className="font-extrabold text-slate-900 text-[1.125em]">AI Tutor Feedback</h4></div>
                                <div className="mb-[1em]"><span className={`font-black text-[0.875em] px-[0.75em] py-[0.25em] rounded-full bg-white border shadow-sm ${feedback.is_correct ? `text-${themeColor}-600 border-${themeColor}-200` : 'text-yellow-600 border-yellow-200'}`}>{feedback.is_correct ? '🎉 Great Job!' : '⚠️ Needs Improvement'}</span></div>
                                <div className="space-y-[1em]">{feedback.feedback_message_eng && <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]"><span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Feedback</span><p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.feedback_message_eng}</p></div>}{feedback.explanation_eng && <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]"><span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Explanation</span><p className="text-slate-800 text-[0.875em] font-medium leading-relaxed">{feedback.explanation_eng}</p></div>}{feedback.corrected_sentence && <div className="flex flex-col sm:flex-row gap-[0.25em] sm:gap-[1em]"><span className="font-bold text-slate-500 text-[0.875em] sm:w-[6em] shrink-0">Correction</span><p className="text-slate-900 text-[1.125em] font-black leading-relaxed">{feedback.corrected_sentence}</p></div>}</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const VocabCard = ({ word, themeColor }) => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="bg-white p-[1.5em] rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-all h-full flex flex-col">
                    <div className="flex justify-between mb-[1em]"><h3 className="text-[1.5em] font-extrabold text-slate-900">{word.term}</h3></div>
                    <div className={`pl-[1em] border-l-4 border-${themeColor}-500 mb-[1.5em]`}><p className="text-[1.3125em] text-slate-600 font-medium font-diary">{word.mainDef}</p></div>
                    <div className="flex-1 flex flex-col">
                        <button onClick={() => setIsOpen(!isOpen)} className="w-full flex items-center justify-between p-[1em] bg-gray-50 hover:bg-gray-100 rounded-xl transition-all group border border-transparent hover:border-gray-200"><div className="flex items-center gap-[0.5em]"><span className={`w-[0.375em] h-[0.375em] rounded-full transition-colors duration-300 ${isOpen ? `bg-${themeColor}-500` : 'bg-gray-400'}`}></span><span className={`text-[0.75em] font-bold uppercase tracking-wider transition-colors duration-300 ${isOpen ? `text-${themeColor}-700` : 'text-slate-500'}`}>Examples (예문)</span></div><ChevronRight className={`w-[1em] h-[1em] text-slate-400 transition-transform duration-300 ${isOpen ? 'rotate-90' : ''}`} /></button>
                        <div className={`overflow-hidden transition-all duration-300 ease-in-out ${isOpen ? 'max-h-[24em] opacity-100 mt-[0.5em]' : 'max-h-0 opacity-0'}`}><div className="bg-gray-50 rounded-xl p-[1em] space-y-[0.75em] border border-gray-100">{word.examples.map((ex, i) => (<div key={i}><p className="font-bold text-slate-800 text-[1.1875em] leading-relaxed font-marker">{ex.kor}</p><p className="text-slate-500 text-[1.0625em] mt-[0.125em] font-gowoonbam">{ex.eng}</p></div>))}</div></div>
                        {word.subDefs && word.subDefs.length > 0 && (<div className={`bg-${themeColor}-50 rounded-xl p-[1.25em] space-y-[0.5em] border border-${themeColor}-100 mt-[1em]`}><h4 className={`font-bold text-${themeColor}-800 text-[0.75em] mb-[0.5em] flex items-center gap-[0.5em] uppercase tracking-wider`}><span className={`w-[0.375em] h-[0.375em] rounded-full bg-${themeColor}-400`}></span>Related & Grammar</h4>{word.subDefs.map((sub, i) => (<div key={i} className="flex flex-col"><span className={`font-bold text-${themeColor}-900 text-[1.25em] font-school-free`}>{sub.subTerm}</span><span className={`text-[1.1875em] text-${themeColor}-600 font-dictation`}>{sub.subDef}</span></div>))}</div>)}
                    </div>
                </div>
            );
        };

        const HomeView = ({ setActiveTab, progress, userLevel, themeColor }) => {
            const completedCount = Object.values(progress).filter(val => val === true || (typeof val === 'number' && val > 0)).length;
            const percentage = Math.round((completedCount / 4) * 100);
            const quizScoreDisplay = typeof progress.quiz === 'number' ? `${progress.quiz}%` : (progress.quiz ? '100%' : '0%');
            const quizColorClass = (progress.quiz === 100 || progress.quiz === true) ? `text-${themeColor}-600` : 'text-slate-900';
            const quizIconBg = (progress.quiz === 100 || progress.quiz === true) ? `bg-${themeColor}-100 text-${themeColor}-600` : `bg-${themeColor}-50 text-${themeColor}-600`;

            return (
                <div style={{ fontSize: '1.25rem' }} className="space-y-[2.5em] animate-fade-in max-w-7xl mx-auto">
                    <div className="space-y-[0.75em]">
                        <div className="flex items-center gap-[0.5em]"><span className={`px-[0.5em] py-[0.25em] bg-${themeColor}-100 text-${themeColor}-700 text-[0.75em] font-extrabold rounded-md tracking-wider font-juache`}>팟캐스트 (Podcast)</span><span className={`text-[0.75em] font-bold text-${themeColor}-600 tracking-wide uppercase font-school-smile`}>이 주제로 이야기해 봐요! (Let's talk about this topic)</span></div>
                        <h1 className="text-[3em] font-black text-slate-900 tracking-tight font-cafe24-surround">체크리스트가 사람들을 멍청하게 만들까요?</h1>
                        <p className="text-slate-500 text-[1.125em] font-cafe24-surround">Do Checklists Make People Stupid?</p>
                    </div>
                    <div className="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden flex flex-col md:flex-row h-auto md:h-[20em]">
                        <div className="md:w-5/12 relative group bg-black cursor-pointer overflow-hidden" onClick={() => setActiveTab('learn')}>
                            <img src="https://img.youtube.com/vi/KXXFd4y57xY/maxresdefault.jpg" alt="Thumbnail" className="w-full h-full object-cover opacity-80 group-hover:opacity-60 transition-opacity duration-300" />
                            <div className="absolute top-[1.5em] left-[1.5em]"><span className="bg-[#ea3323] text-white text-[0.625em] font-bold px-[0.5em] py-[0.25em] rounded border border-[#ea3323] shadow-sm tracking-wider">ON AIR</span></div>
                            <div className="absolute inset-0 flex items-center justify-center"><div className="w-[3.5em] h-[3.5em] bg-white rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300"><PlayIconLine className={`w-[1.5em] h-[1.5em] text-${themeColor}-600 fill-current ml-[0.25em]`} /></div></div>
                        </div>
                        <div className="md:w-7/12 p-[2em] md:p-[2.5em] flex flex-col justify-center">
                            <div className="flex items-center gap-[0.5em] mb-[1em]"><span className="px-[0.5em] py-[0.25em] bg-gray-100 text-slate-600 text-[0.625em] font-bold rounded uppercase tracking-wide">Listening</span><LevelBadge levelCode={userLevel} /></div>
                            <div className="mb-[0.75em]"><h2 className="text-[1.5em] font-black text-slate-900 font-cafe24-surround">동영상 자료</h2><span className="text-[0.875em] font-bold text-slate-400 font-cafe24-surround">Video Resources</span></div>
                            <div className="text-slate-600 text-[0.875em] leading-relaxed mb-[2em] pr-[1em]"><p>팟캐스트를 듣고 음악 취향에 대한 이야기를 들어보세요.</p><p className="mt-[0.25em] text-slate-400 text-[0.75em]">Listen to the podcast about music preferences.</p></div>
                            <div className="flex items-center gap-[0.75em]"><button onClick={() => setActiveTab('learn')} className="px-[1.5em] py-[0.75em] bg-[#111827] text-white rounded-xl hover:bg-black transition-colors shadow-md flex flex-col items-center leading-tight"><span className="text-[0.875em] font-bold">동영상 보러 가기</span><span className="text-[0.625em] opacity-70 font-medium">Watch Video</span></button></div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-[1.5em]">
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between min-h-[10em] h-full hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">핵심 어휘</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Key Vocabulary</span></div><p className="text-[2.25em] font-black text-slate-900 mt-[0.25em] font-jua">{VOCAB_DATA.length}개</p></div><div className={`w-[2.5em] h-[2.5em] bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}><VocabIcon className="w-[1.25em] h-[1.25em]" /></div></div>
                            <button onClick={() => setActiveTab('vocab')} className="group flex items-center gap-[0.25em] transition-colors"><div className="flex flex-col items-start"><span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>핵심 어휘 확인</span><span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Check Vocabulary</span></div><span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-[0.25em]`}>→</span></button>
                        </div>
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between min-h-[10em] h-full hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">내용 확인 퀴즈</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Comprehension Quiz</span></div><p className={`text-[2.25em] font-black mt-[0.25em] transition-all duration-500 font-jua ${quizColorClass}`}>{quizScoreDisplay}</p></div><div className={`w-[2.5em] h-[2.5em] rounded-xl flex items-center justify-center transition-colors ${quizIconBg}`}><QuizIcon className="w-[1.25em] h-[1.25em]" /></div></div>
                            <button onClick={() => setActiveTab('quiz')} className="group flex items-center gap-[0.25em] transition-colors"><div className="flex flex-col items-start"><span className={`text-[0.75em] font-bold text-slate-400 group-hover:text-${themeColor}-600`}>퀴즈 시작하기</span><span className={`text-[0.625em] text-slate-300 group-hover:text-${themeColor}-400 font-medium`}>Start Quiz</span></div><span className={`text-[1.125em] leading-none text-slate-400 group-hover:text-${themeColor}-600 ml-[0.25em]`}>→</span></button>
                        </div>
                        <div className="bg-white p-[1.5em] rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between min-h-[10em] h-full hover:shadow-md transition-shadow">
                            <div className="flex justify-between items-start"><div><div className="flex flex-col"><span className="text-[0.75em] font-bold text-slate-500 font-cafe24-surround">생각해 보기</span><span className="text-[0.625em] text-slate-400 font-medium font-cafe24-surround">Food For Thought</span></div><div className="flex flex-col mt-[0.75em]"><a href="https://gemini.google.com/share/b241208a24dc" target="_blank" rel="noopener noreferrer" className={`text-[1.0625em] font-black text-${themeColor}-600 hover:text-${themeColor}-800 hover:underline transition-colors flex items-center gap-[0.25em] leading-tight`}>Gemini AI Feedback<ExternalLinkIcon className="w-[1em] h-[1em]" /></a></div></div><div className={`w-[2.5em] h-[2.5em] bg-${themeColor}-50 text-${themeColor}-600 rounded-xl flex items-center justify-center`}><DiscussIcon className="w-[1.25em] h-[1.25em]" /></div></div>
                            <button onClick={() => setActiveTab('discuss')} className="group flex items-center gap-[0.25em] transition-colors"><div className="flex flex-col items-start"><span className="text-[0.75em] font-bold text-slate-400 group-hover:text-blue-600">다음 질문들을 생각해 보세요.</span><span className="text-[0.625em] text-slate-300 group-hover:text-blue-400 font-medium">Have a think about the following questions.</span></div><span className="text-[1.125em] leading-none text-slate-400 group-hover:text-blue-600 ml-[0.25em]">→</span></button>
                        </div>
                    </div>
                </div>
            );
        };

        const VocabView = ({ updateProgress, themeColor }) => {
            useEffect(() => { updateProgress('vocab'); }, []);
            return (
            <div style={{ fontSize: '1.4rem' }} className="max-w-7xl animate-fade-in mx-auto">
                <div className="flex items-center gap-[1em] mb-[2em]"><div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><VocabIcon className={`w-[2.5em] h-[2.5em] text-${themeColor}-600`} /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">핵심 어휘</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Key Vocabulary</span></div></div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-[1.5em]">{VOCAB_DATA.map((word, idx) => (<VocabCard key={idx} word={word} themeColor={themeColor} />))}</div>
            </div>
            );
        };

        const QuizView = ({ updateProgress, themeColor }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [firstAttempts, setFirstAttempts] = useState({}); 
            const [showHint, setShowHint] = useState(false);
            const [showTranslation, setShowTranslation] = useState(false);
            const [isFinished, setIsFinished] = useState(false);
            const currentQuestion = QUIZ_LIST[currentQuestionIndex];
            const shuffledOptions = useMemo(() => [...currentQuestion.options].sort(() => Math.random() - 0.5), [currentQuestion]);
            const selectedOption = answers[currentQuestionIndex] || null;
            const isCorrect = selectedOption?.isCorrect;

            const handleOptionClick = (option) => { 
                if (firstAttempts[currentQuestionIndex] === undefined) setFirstAttempts(prev => ({ ...prev, [currentQuestionIndex]: option.isCorrect })); 
                setAnswers(prev => ({ ...prev, [currentQuestionIndex]: option })); 
                setShowHint(false); 
            };
            const handlePrev = () => { if (currentQuestionIndex > 0) { setCurrentQuestionIndex(prev => prev - 1); setShowHint(false); setShowTranslation(false); } };
            const handleNext = () => { if (currentQuestionIndex < QUIZ_LIST.length - 1) { setCurrentQuestionIndex(prev => prev + 1); setShowHint(false); setShowTranslation(false); } else { finishQuiz(); } };
            const finishQuiz = () => { setIsFinished(true); const totalQuestions = QUIZ_LIST.length; const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length; const finalScore = Math.round((correctCount / totalQuestions) * 100); updateProgress('quiz', finalScore); };
            const handleRetry = () => { setCurrentQuestionIndex(0); setAnswers({}); setFirstAttempts({}); setIsFinished(false); updateProgress('quiz', 0); };

            if (isFinished) {
                const correctCount = Object.values(firstAttempts).filter(isCorrect => isCorrect === true).length;
                return (
                    <div style={{ fontSize: '1.55rem' }} className="max-w-7xl animate-fade-in mx-auto text-center py-[2.5em]">
                        <div className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[2.5em]">
                            <div className={`w-[5em] h-[5em] bg-${themeColor}-100 text-${themeColor}-600 rounded-full flex items-center justify-center mx-auto mb-[1.5em]`}><QuizIcon className="w-[2.5em] h-[2.5em]" /></div>
                            <h2 className="text-[1.875em] font-black text-slate-900 mb-[0.5em] font-cafe24-surround">퀴즈 완료!</h2>
                            <p className="text-slate-500 mb-[2em]">총 {QUIZ_LIST.length}문제 중 {correctCount}문제를 한 번에 맞혔습니다.</p>
                            <div className={`text-[3em] font-black text-${themeColor}-600 mb-[2em] font-school-smile`}>{Math.round((correctCount / QUIZ_LIST.length) * 100)}%</div>
                            <button onClick={handleRetry} className={`px-[2em] py-[0.75em] rounded-xl bg-${themeColor}-600 text-white font-bold hover:bg-${themeColor}-700 transition-colors`}>다시 풀기 (Try Again)</button>
                        </div>
                    </div>
                );
            }

            return (
                <div style={{ fontSize: '1.55rem' }} className="max-w-7xl animate-fade-in mx-auto">
                    <div className="flex items-center gap-[1em] mb-[1.5em]"><div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><QuizIcon className="w-[2.5em] h-[2.5em] text-current" /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">내용 확인 퀴즈</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Comprehension Quiz ({currentQuestionIndex + 1}/{QUIZ_LIST.length})</span></div></div>
                    <div className="mb-[1.5em] p-[1em] bg-gray-50 rounded-xl border border-gray-200"><p className="font-bold text-slate-800">다음 빈칸에 알맞은 말을 고르세요.</p><p className="text-slate-500 text-[0.875em]">Choose the correct word for the blank.</p></div>
                    <div className="bg-white rounded-2xl border border-gray-200 shadow-sm p-[0.5em]">
                        <div className="flex items-start gap-[0.75em] p-[1em]"><span className={`bg-${themeColor}-100 text-${themeColor}-700 font-black rounded-lg px-[0.5em] py-[0.25em] text-[0.875em] shrink-0`}>Q{currentQuestion.id}</span><div className="flex flex-col"><h3 className="font-bold text-slate-900 text-[1.125em] leading-snug">{currentQuestion.questionKor}</h3><p className="text-slate-500 font-medium text-[0.875em] mt-[0.25em]">{currentQuestion.questionEng}</p></div></div>
                        <div className="bg-gray-50 rounded-xl p-[1em] mb-[1em] mx-[0.25em]">
                            <div>
                                <div className="leading-relaxed text-[1.25em] font-bold text-slate-900">
                                    {currentQuestion.sentence_pre}
                                    <div className={`inline-flex align-middle mx-[0.5em] px-[1em] py-[0.25em] rounded-md font-bold text-[1.25em] transition-all duration-300 min-w-[5em] text-center border-b-2 ${isCorrect ? `bg-${themeColor}-50 text-${themeColor}-700 border-${themeColor}-500` : (showHint ? 'bg-yellow-100 text-yellow-800 border-yellow-400' : (selectedOption ? 'bg-red-50 text-red-700 border-red-500' : 'bg-yellow-100 text-transparent border-yellow-400 select-none'))}`}>{isCorrect ? selectedOption.text : (showHint ? `[ ${currentQuestion.hint} ]` : (selectedOption ? selectedOption.text : "___"))}</div>
                                    {currentQuestion.sentence_post}{selectedOption && (<span className={`ml-[0.5em] text-[1.125em] ${isCorrect ? `text-${themeColor}-600` : 'text-red-600'}`}>{isCorrect ? '✓' : '✗'}</span>)}
                                </div>
                                {showTranslation && (
                                    <div className="mt-[1em] pt-[1em] border-t border-gray-200 text-slate-500 italic text-[0.875em] animate-fade-in font-medium">
                                        {currentQuestion.translation_pre}
                                        <span className={`inline-block border-b border-slate-400 px-1 mx-1 min-w-[3em] text-center transition-all ${isCorrect ? `text-${themeColor}-600 font-bold border-transparent not-italic` : 'text-transparent'}`}>
                                            {isCorrect ? currentQuestion.translation_answer : "____"}
                                        </span>
                                        {currentQuestion.translation_post}
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="flex gap-[0.5em] mb-[1em] px-[0.5em]"><button onClick={() => { setShowHint(!showHint); }} disabled={selectedOption?.isCorrect} className={`px-[0.75em] py-[0.375em] rounded-lg text-[0.75em] font-bold transition-colors ${selectedOption?.isCorrect ? 'opacity-50 cursor-not-allowed bg-gray-100 text-slate-400' : (showHint ? 'bg-yellow-200 text-yellow-800 ring-2 ring-yellow-400' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200')}`}>힌트 (Hint)</button><button onClick={() => setShowTranslation(!showTranslation)} className="inline-flex items-center gap-[0.25em] text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"><TranslateIcon className="w-[0.75em] h-[0.75em]" /><span>{showTranslation ? '번역 숨기기 (Hide)' : '번역 (Translation)'}</span></button></div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-[0.75em] mb-[1em] px-[0.5em]">{shuffledOptions.map((option, idx) => { 
                            const isSelected = selectedOption === option; 
                            let btnClass = "bg-white border-gray-200 text-slate-700 hover:bg-gray-50 hover:border-gray-300"; 
                            if (isSelected) { 
                                if (option.isCorrect) { 
                                    btnClass = `bg-${themeColor}-500 border-${themeColor}-600 text-white shadow-md ring-2 ring-${themeColor}-200`; 
                                } else { 
                                    btnClass = "bg-red-500 border-red-600 text-white shadow-md ring-2 ring-red-200"; 
                                } 
                            } 
                            return (<button key={idx} onClick={() => handleOptionClick(option)} className={`py-[0.75em] px-[1em] rounded-xl border font-bold text-[1em] transition-all duration-200 ${btnClass}`}>{option.text}</button>); 
                        })}</div>
                        {selectedOption && (<div className="p-[1em] rounded-xl border-l-4 mb-[1em] mx-[0.5em] animate-fade-in transition-all bg-[#f8fafc] border-gray-300"><div className={`${isCorrect ? `bg-${themeColor}-50 border-${themeColor}-500` : 'bg-red-50 border-red-500'} p-[1em] rounded-lg border-l-4`}><h4 className={`font-bold text-[0.875em] mb-[0.25em] ${isCorrect ? `text-${themeColor}-800` : 'text-red-800'}`}>{isCorrect ? 'Correct!' : 'Try again.'}</h4><p className={`text-[0.875em] italic ${isCorrect ? `text-${themeColor}-700` : 'text-red-700'}`}>{selectedOption.feedback}</p></div></div>)}
                        <div className="flex justify-between items-center mt-[1em] border-t border-gray-100 pt-[1em] px-[0.5em] pb-[0.5em]"><button onClick={handlePrev} disabled={currentQuestionIndex === 0} className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] transition-colors ${currentQuestionIndex === 0 ? 'text-slate-300 cursor-not-allowed' : 'text-slate-600 hover:bg-gray-100'}`}><span className="text-[1.125em]">←</span><span className="text-[0.75em]">이전 문제 (Prev)</span></button><span className="text-[0.75em] font-bold text-slate-600">{currentQuestionIndex + 1} / {QUIZ_LIST.length}</span><button onClick={handleNext} disabled={!isCorrect} className={`px-[1.5em] py-[0.25em] rounded-xl font-bold flex items-center gap-[0.5em] shadow-md transition-colors ${!isCorrect ? 'bg-gray-300 text-slate-500 cursor-not-allowed' : 'bg-gray-900 text-white hover:bg-black'}`}><span className="text-[0.75em]">{currentQuestionIndex < QUIZ_LIST.length - 1 ? '다음 문제 (Next)' : '결과 보기 (Finish)'}</span><span className="text-[1.125em]">→</span></button></div>
                    </div>
                </div>
            );
        };

        const DiscussView = ({ updateProgress, themeColor }) => {
            const [answers, setAnswers] = useState({});
            const [showTranslations, setShowTranslations] = useState({});
            const handleTextChange = (id, value) => { setAnswers(prev => ({ ...prev, [id]: value })); };
            const toggleTranslation = (id) => { setShowTranslations(prev => ({ ...prev, [id]: !prev[id] })); };
            
            return (
                <div style={{ fontSize: '1.35rem' }} className="max-w-7xl mx-auto animate-fade-in">
                    <div className="flex items-center gap-[1em] mb-[2em]"><div className={`w-[4em] h-[4em] bg-${themeColor}-100 rounded-2xl flex items-center justify-center shrink-0`}><DiscussIcon className="w-[2.5em] h-[2.5em] text-current" /></div><div className="flex flex-col"><h2 className="text-[1.875em] font-black text-slate-900 font-cafe24-surround">생각해 보기</h2><span className="text-[1em] text-slate-500 font-medium font-cafe24-surround">Food For Thought</span></div></div>
                    <div className={`mb-[2em] p-[1em] rounded-2xl bg-${themeColor}-50 border border-${themeColor}-100`}><div className="text-slate-800 text-[0.875em] font-medium leading-relaxed"><p>AI Feedback은 Gemini 웹페이지에서만 작용하기 때문에 Github 웹페이지에서 사용할 수 없어요.</p><p className="text-slate-500 text-[0.75em] mt-[0.25em] mb-[1em]">AI Feedback only works on the Gemini webpage, so it cannot be used on the GitHub webpage.</p><p className="flex flex-wrap items-center gap-[0.25em]">AI Feedback 기능을 사용하기 원할 경우, 다음 링크를 클릭하세요: <a href="https://gemini.google.com/share/b241208a24dc" target="_blank" rel="noopener noreferrer" className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-0.5`}>Gemini AI Feedback<ExternalLinkIcon className="w-[0.75em] h-[0.75em]" /></a></p><p className="text-slate-500 text-[0.75em] mt-[0.25em] flex flex-wrap items-center gap-[0.25em]">To use the AI feedback feature, please click the following link: <a href="https://gemini.google.com/share/b241208a24dc" target="_blank" rel="noopener noreferrer" className={`font-bold text-${themeColor}-600 hover:underline inline-flex items-center gap-0.5`}>Gemini AI Feedback<ExternalLinkIcon className="w-[0.75em] h-[0.75em]" /></a></p></div></div>
                    <div className="bg-white rounded-3xl border border-gray-200 shadow-sm p-[2em] md:p-[2.5em]">
                        {DISCUSS_DATA.map((item, index) => (
                            <div key={item.id} className={index < DISCUSS_DATA.length - 1 ? "mb-[3em] border-b border-gray-100 pb-[3em]" : "mb-[2em]"}>
                                <div className="mb-[2em]"><h3 className="text-[1.25em] font-bold text-slate-900 mb-[0.5em]">{item.question}</h3>{showTranslations[item.id] && (<p className="text-slate-500 text-[0.875em] mb-[0.75em] animate-fade-in font-medium">{item.translation}</p>)}<button onClick={() => toggleTranslation(item.id)} className="inline-flex items-center gap-[0.25em] text-[0.5em] font-normal text-slate-400 hover:text-slate-600 font-cafe24 bg-transparent transition-colors"><TranslateIcon className="w-[0.75em] h-[0.75em]" /><span>{showTranslations[item.id] ? '번역 숨기기 (Hide)' : '번역 (Translation)'}</span></button></div>
                                <FeedbackSection themeColor={themeColor} question={item.question} value={answers[item.id] || ''} onChange={(e) => handleTextChange(item.id, e.target.value)} placeholder="여기에 답변을 입력하세요 (Type your response here)" keyPhrases={<div className="mb-[2.5em] space-y-[1em]"><div className="flex items-center gap-[0.5em]"><span className="text-red-500 text-[1.125em]">📍</span><h4 className="font-bold text-slate-900 text-[1.125em]">핵심 표현 (Essential phrases)</h4></div><div className="space-y-[1em] pl-[0.25em]">{item.keyVocab.map((v, i) => (<div key={i} className={`pl-[1em] border-l-4 border-${themeColor}-500`}><p className="text-slate-700"><span className={`text-${themeColor}-600 font-bold text-[1.125em] mr-[0.5em]`}>{v.term}:</span><span>{v.meaning_eng}</span></p></div>))}</div></div>} />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const LearnView = ({ updateProgress, themeColor, autoScroll, showVocab, playbackRate, layoutMode, onPlayerReady, onPlayerStateChange, onTimeUpdate }) => {
            const [player, setPlayer] = useState(null); const playerRef = useRef(null); const [currentTime, setCurrentTime] = useState(0); const [activeLine, setActiveLine] = useState(null); const [translations, setTranslations] = useState({}); const [popup, setPopup] = useState({ show: false, fixed: false, data: null, x: 0, y: 0 }); const [activeVocabTerm, setActiveVocabTerm] = useState(null); const [isLoading, setIsLoading] = useState(true); const sidebarVocabRefs = useRef({}); const scriptRefs = useRef({}); const intervalRef = useRef(null);

            useEffect(() => {
                const loadVideo = () => { if (window.YT && window.YT.Player) { new window.YT.Player('youtube-player', { videoId: 'KXXFd4y57xY', width: '100%', height: '100%', playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0 }, events: { 'onReady': (event) => { playerRef.current = event.target; setPlayer(event.target); setIsLoading(false); if (onPlayerReady) onPlayerReady(event.target); }, 'onStateChange': (event) => { if (event.data === window.YT.PlayerState.PLAYING) { startInterval(); updateProgress('learn'); } else { stopInterval(); } if (onPlayerStateChange) onPlayerStateChange(event); } } }); } };
                if (!window.YT) { const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; const firstScriptTag = document.getElementsByTagName('script')[0]; firstScriptTag.parentNode.insertBefore(tag, firstScriptTag); window.onYouTubeIframeAPIReady = loadVideo; } else { loadVideo(); }
                return () => stopInterval();
            }, []);

            useEffect(() => { if (player && player.setPlaybackRate) player.setPlaybackRate(playbackRate); }, [playbackRate, player]);

            const startInterval = () => { stopInterval(); const updateTime = () => { const p = playerRef.current; if (p && p.getCurrentTime) { const time = p.getCurrentTime(); setCurrentTime(time); if (onTimeUpdate) onTimeUpdate(time); const currentLine = SCRIPT_DATA.find(line => time >= line.time[0] && time < line.time[1]); if (currentLine) { setActiveLine(currentLine.id); } } intervalRef.current = requestAnimationFrame(updateTime); }; intervalRef.current = requestAnimationFrame(updateTime); };
            const stopInterval = () => { if (intervalRef.current) { cancelAnimationFrame(intervalRef.current); intervalRef.current = null; } };
            
            useEffect(() => { if (popup.show) return; if (activeLine && autoScroll && scriptRefs.current[activeLine]) { scriptRefs.current[activeLine].scrollIntoView({ behavior: 'smooth', block: 'center' }); } }, [activeLine, autoScroll, popup.show]);

            const handleLineClick = (time) => { if (player) { player.seekTo(time, true); player.playVideo(); } };
            const toggleTranslation = (id) => setTranslations(prev => ({...prev, [id]: !prev[id]}));
            const scrollToVocab = (term) => { const element = sidebarVocabRefs.current[term]; if (element) element.scrollIntoView({ behavior: 'smooth', block: 'center' }); };

            const handleVocabEnter = (e, wordData) => { if (popup.fixed) return; const rect = e.target.getBoundingClientRect(); setPopup({ show: true, fixed: false, data: wordData, x: rect.left + rect.width / 2, y: rect.bottom }); if (showVocab) { setActiveVocabTerm(wordData.term); scrollToVocab(wordData.term); } };
            const handleVocabLeave = () => { if (popup.fixed) return; setPopup(prev => ({ ...prev, show: false })); };
            const handleVocabClick = (e, wordData) => { e.stopPropagation(); if (popup.fixed && popup.data && popup.data.term === wordData.term) { setPopup(prev => ({ ...prev, show: false, fixed: false })); return; } const rect = e.target.getBoundingClientRect(); setPopup({ show: true, fixed: true, data: wordData, x: rect.left + rect.width / 2, y: rect.bottom }); if (showVocab) { setActiveVocabTerm(wordData.term); scrollToVocab(wordData.term); } };

            const renderTextWithVocab = (text) => {
                const allTerms = VOCAB_DATA.flatMap(vocab => { 
                    const terms = [vocab.term]; 
                    if (vocab.variants) terms.push(...vocab.variants); 
                    // REMOVED: if (vocab.subDefs) terms.push(...vocab.subDefs.map(s => s.subTerm)); 
                    return terms.map(term => ({ term, vocab })); 
                }).sort((a, b) => b.term.length - a.term.length);
                const matches = []; allTerms.forEach(({ term, vocab }) => { let index = 0; while ((index = text.indexOf(term, index)) !== -1) { const end = index + term.length; const overlaps = matches.some(m => (index >= m.start && index < m.end) || (end > m.start && end <= m.end)); if (!overlaps) matches.push({ start: index, end, term, vocab }); index = end; } }); matches.sort((a, b) => a.start - b.start);
                const result = []; let lastIndex = 0; matches.forEach((match, idx) => { if (match.start > lastIndex) result.push(text.substring(lastIndex, match.start)); result.push({ isVocab: true, ...match.vocab, displayText: match.term, key: idx }); lastIndex = match.end; }); if (lastIndex < text.length) result.push(text.substring(lastIndex));
                return result.map((part, index) => { if (typeof part === 'string') return part; const isActive = (popup.show && popup.data && popup.data.term === part.term) || (showVocab && activeVocabTerm === part.term); return (<span key={part.key} className={`cursor-pointer border-b-2 transition-all duration-200 font-bold inline-block leading-tight ${isActive ? `text-${themeColor}-700 border-${themeColor}-500 bg-${themeColor}-100 rounded-sm px-0.5 mx-0.5` : `text-slate-900 border-dashed border-gray-400 hover:text-${themeColor}-600 hover:border-${themeColor}-400 hover:bg-${themeColor}-50`}`} onMouseEnter={(e) => handleVocabEnter(e, part)} onMouseLeave={handleVocabLeave} onClick={(e) => handleVocabClick(e, part)}>{part.displayText}</span>); });
            };

            const getSmartPosition = () => { if (!popup.show || !popup.data) return { left: 0, arrowLeft: 0 }; const POPUP_WIDTH = 288; const SCREEN_PADDING = 16; const screenW = window.innerWidth; let leftPos = popup.x - (POPUP_WIDTH / 2); if (leftPos < SCREEN_PADDING) leftPos = SCREEN_PADDING; else if (leftPos + POPUP_WIDTH > screenW - SCREEN_PADDING) leftPos = screenW - POPUP_WIDTH - SCREEN_PADDING; let arrowLeft = popup.x - leftPos; if (arrowLeft < 12) arrowLeft = 12; if (arrowLeft > POPUP_WIDTH - 12) arrowLeft = POPUP_WIDTH - 12; return { left: leftPos, arrowLeft }; };
            const { left: popupLeft, arrowLeft } = getSmartPosition();

            const getVideoClass = () => { if (layoutMode === 'script') return 'hidden'; if (layoutMode === 'video') { return `w-full h-full bg-black lg:h-full lg:aspect-auto ${showVocab ? 'xl:w-9/12 lg:w-full' : 'lg:w-full'}`; } let base = 'w-full sticky top-1 z-50 bg-black aspect-video lg:static lg:aspect-auto'; return `${base} flex-1 lg:h-full`; };
            const getScriptClass = () => { if (layoutMode === 'video') return 'hidden'; if (layoutMode === 'script') { return showVocab ? 'lg:flex-1 h-auto' : 'w-full max-w-7xl mx-auto h-auto'; } return `w-full lg:w-5/12 ${showVocab ? 'xl:w-4/12' : ''} lg:h-full`; };
            const getContainerClass = () => { if (layoutMode === 'script') return 'items-start min-h-full'; if (layoutMode === 'video') { return 'h-[calc(100vh-9rem)] lg:h-[calc(100vh-4rem)] lg:overflow-hidden flex-col lg:flex-row'; } return 'min-h-full lg:h-[calc(100vh-4rem)] lg:overflow-hidden flex-col lg:flex-row'; }
            // Added 1.3rem font size to script container
            const getInnerListStyle = () => { const baseStyle = "space-y-[1em] rounded-xl transition-all duration-300"; if (layoutMode === 'script') { return `${baseStyle} p-[1.5em] bg-slate-100 overflow-visible h-auto`; } else { return `${baseStyle} p-[1em] bg-gray-50 overflow-visible lg:overflow-y-auto flex-1`; } };

            return (
                <div className={`flex gap-[1em] animate-fade-in relative w-full mx-auto ${getContainerClass()}`}>
                    {popup.show && popup.data && createPortal(<div className="fixed z-[9999] bg-white rounded-xl shadow-xl border border-gray-200 p-[1em] w-[18em] animate-fade-in pointer-events-none" style={{ left: popupLeft, top: popup.y + 12 }}><div className="flex items-center justify-between mb-[0.5em]"><h3 className="text-[1.25em] font-black text-slate-900 font-ocarina">{popup.data.term}</h3></div><p className="text-[1.1875em] text-slate-700 font-medium mb-[0.75em] leading-snug font-diary">{popup.data.mainDef}</p>{popup.fixed && popup.data.subDefs && popup.data.subDefs.length > 0 && (<div className="space-y-[0.25em] mt-[0.5em]">{popup.data.subDefs.map((sub, idx) => (<div key={idx} className={`bg-${themeColor}-50 rounded-lg p-[0.5em] border border-${themeColor}-100`}><p className={`text-[1.125em] text-${themeColor}-900 font-bold font-school-free`}>{sub.subTerm}</p><p className={`text-[1.0625em] text-${themeColor}-700 font-dictation`}>{sub.subDef}</p></div>))}</div>)}<div className="absolute top-0 -translate-x-1/2 -translate-y-1/2 w-[0.75em] h-[0.75em] bg-white border-l border-t border-gray-200 rotate-45" style={{ left: arrowLeft }}></div></div>, document.body)}
                    <div className={`bg-black rounded-xl overflow-hidden shadow-lg transition-all duration-300 relative ${getVideoClass()}`}><div id="youtube-player" className="w-full h-full"></div>{isLoading && (<div className="absolute inset-0 bg-black/90 flex items-center justify-center z-10"><div className={`animate-spin rounded-full h-[3em] w-[3em] border-4 border-t-transparent border-${themeColor}-500 opacity-80`}></div></div>)}</div>
                    <div style={{ fontSize: '1.3rem' }} className={`flex flex-col rounded-xl border border-gray-200 shadow-sm transition-all duration-300 bg-gray-50 ${getScriptClass()}`}>
                        <div className={getInnerListStyle()}>
                            {SCRIPT_DATA.map(line => {
                                const isActive = activeLine === line.id; const isScriptMode = layoutMode === 'script';
                                if (isScriptMode) {
                                    const isLeft = line.speaker === '민지'; const bubbleBg = isActive ? 'bg-yellow-50' : 'bg-white'; const bubbleBorder = isActive ? 'border-yellow-100' : 'border-slate-200';
                                    return (
                                        <div key={line.id} ref={el => scriptRefs.current[line.id] = el} className={`flex flex-col w-full mb-[1.5em] ${isLeft ? 'items-start' : 'items-end'}`}>
                                            <div className={`text-[0.75em] font-bold text-slate-500 mb-[0.25em] px-[0.5em] ${isLeft ? 'text-left' : 'text-right'}`}>{line.speaker}</div>
                                            <div className={`relative p-[1.25em] rounded-xl border ${bubbleBg} ${bubbleBorder} ${isActive ? 'scale-[1.02] shadow-md z-10' : 'hover:shadow-md'} transition-all duration-300 max-w-[85%] sm:max-w-[70%] group`}>
                                                <div className={`absolute bottom-[1em] w-[0.75em] h-[0.75em] border ${bubbleBg} ${bubbleBorder} rotate-45 transform ${isLeft ? '-left-[0.375em] border-t-0 border-r-0' : '-right-[0.375em] border-b-0 border-l-0'}`}></div>
                                                <div className="relative z-10" onClick={() => handleLineClick(line.time[0])}><p className="text-[1.125em] sm:text-[1.25em] text-slate-800 leading-relaxed font-medium">{renderTextWithVocab(line.kor)}</p>{translations[line.id] && (<div className="mt-[0.75em] pt-[0.75em] border-t border-dashed border-gray-200/60 animate-fade-in"><p className="text-[1em] text-slate-500">{line.eng}</p></div>)}</div>
                                                <div className="flex justify-between items-center mt-[1em] pt-[0.25em]"><button onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }} className="flex items-center gap-[0.25em] text-[0.6875em] font-bold text-slate-400 hover:text-slate-600 transition-colors p-[0.25em] rounded-lg hover:bg-gray-100/50"><TranslateIcon className="w-[0.875em] h-[0.875em]" /><span>{translations[line.id] ? '숨기기' : '번역'}</span></button><button onClick={(e) => { e.stopPropagation(); handleLineClick(line.time[0]); }} className={`transition-all duration-200 hover:scale-110 ${isActive ? 'text-yellow-700' : 'text-slate-400 hover:text-slate-600'}`} title="Play this line"><PlayCircleIcon className="w-[1.25em] h-[1.25em]" /></button></div>
                                            </div>
                                        </div>
                                    );
                                }
                                return (
                                    <div key={line.id} ref={el => scriptRefs.current[line.id] = el} className="flex flex-col">
                                        <div className="flex items-center gap-[0.5em] mb-[0.25em] ml-[0.25em]"><span className="text-[0.75em] font-bold text-slate-600">{line.speaker}</span></div>
                                        <div onClick={() => handleLineClick(line.time[0])} className={`p-[1.25em] rounded-2xl border transition-all duration-300 cursor-pointer relative group ${isActive ? 'bg-yellow-50 border-yellow-100 shadow-md scale-[1.01]' : 'bg-white border-gray-200 hover:border-gray-300'}`}>
                                            <p className="text-[1.375em] text-slate-800 leading-relaxed font-medium">{renderTextWithVocab(line.kor)}</p>
                                            {translations[line.id] && (<div className="mt-[0.75em] pt-[0.75em] border-t border-dashed border-gray-200 animate-fade-in"><p className="text-[1.125em] text-slate-500">{line.eng}</p></div>)}
                                            <div className="flex justify-between items-center mt-[1em] pt-[0.75em] border-t border-dashed border-gray-100"><button onClick={(e) => { e.stopPropagation(); toggleTranslation(line.id); }} className="flex items-center gap-[0.25em] text-[0.6875em] font-bold text-slate-400 hover:text-slate-600 transition-colors p-[0.25em] rounded-lg hover:bg-gray-100/50"><TranslateIcon className="w-[0.875em] h-[0.875em]" /><span>{translations[line.id] ? '숨기기' : '번역'}</span></button><button onClick={(e) => { e.stopPropagation(); handleLineClick(line.time[0]); }} className={`transition-all duration-200 hover:scale-110 ${isActive ? 'text-yellow-700' : 'text-slate-400 hover:text-slate-600'}`} title="Play this line"><PlayCircleIcon className="w-[1.25em] h-[1.25em]" /></button></div>
                                        </div>
                                    </div>
                                );
                            })}
                            <div className="h-[8em]"></div>
                        </div>
                    </div>
                    {showVocab && (
                        <div className={`hidden xl:flex w-3/12 flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm animate-fade-in ${layoutMode === 'script' ? 'sticky top-[1em] h-[calc(100vh-6rem)]' : 'h-full'}`}>
                            <div className="p-[1em] border-b border-gray-100 flex items-center gap-[0.5em] bg-white rounded-t-xl"><VocabIcon className={`w-[1.25em] h-[1.25em] text-${themeColor}-600`} /><div className="flex flex-col leading-none"><h2 className="font-bold text-slate-900 text-[0.875em]">핵심 어휘</h2><span className="text-[0.625em] text-slate-400 font-medium">Key Vocabulary</span></div></div>
                            <div className="flex-1 overflow-y-auto p-[1em] space-y-[1em] bg-gray-50">{VOCAB_DATA.map((word, idx) => (<div key={idx} ref={el => sidebarVocabRefs.current[word.term] = el} className={`p-[1em] rounded-xl border transition-all duration-500 ${activeVocabTerm === word.term ? `border-${themeColor}-500 bg-${themeColor}-50 ring-2 ring-${themeColor}-200 shadow-md scale-105` : 'bg-white border-gray-200 shadow-sm'}`}><div className="flex justify-between items-start mb-[0.5em]"><h3 className="text-[1.25em] font-extrabold text-slate-900 font-ocarina">{word.term}</h3></div><p className="text-[1.1875em] text-slate-600 mb-[0.75em] font-medium font-diary">{word.mainDef}</p>{word.subDefs && word.subDefs.length > 0 && (<div className={`space-y-[0.5em] bg-${themeColor}-50 p-[0.625em] rounded-lg border border-${themeColor}-100`}>{word.subDefs.map((sub, i) => (<div key={i}><p className={`text-[1.125em] text-${themeColor}-900 font-bold leading-snug font-school-free`}>{sub.subTerm}</p><p className={`text-[1.0625em] text-${themeColor}-700 font-dictation`}>{sub.subDef}</p></div>))}</div>)}</div>))}</div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home'); const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false); const [userLevel, setUserLevel] = useState("B1"); const [autoScroll, setAutoScroll] = useState(true); const [showVocab, setShowVocab] = useState(false); const [playbackRate, setPlaybackRate] = useState(1.0); const [isSpeedMenuOpen, setIsSpeedMenuOpen] = useState(false); const [layoutMode, setLayoutMode] = useState('split'); const [progress, setProgress] = useState({ learn: false, vocab: false, quiz: 0, discuss: false }); const [videoState, setVideoState] = useState({ player: null, currentTime: 0, duration: 0, isPlaying: false });
            const themeColor = useMemo(() => getLevelTheme(userLevel), [userLevel]);
            const themeHexColors = { 'lime': '#a3e635', 'green': '#4ade80', 'sky': '#38bdf8', 'blue': '#60a5fa', 'violet': '#a78bfa', 'fuchsia': '#e879f9', 'purple': '#c084fc' };
            const currentThemeHex = themeHexColors[themeColor] || '#4ade80';
            const updateProgress = (key, value = true) => setProgress(prev => { if (prev[key] === value) return prev; return { ...prev, [key]: value }; });
            const handlePlayerReady = (player) => setVideoState(prev => ({ ...prev, player, duration: player.getDuration() }));
            const handlePlayerStateChange = (event) => setVideoState(prev => ({ ...prev, isPlaying: event.data === window.YT.PlayerState.PLAYING }));
            const handleTimeUpdate = (time) => setVideoState(prev => ({ ...prev, currentTime: time }));
            const mainPaddingClass = useMemo(() => { switch(activeTab) { case 'home': return 'p-[1.25rem]'; case 'learn': return 'p-[0.125rem]'; case 'vocab': return 'p-[1rem]'; case 'quiz': return 'p-[0.25rem]'; case 'discuss': return 'p-[0.125rem]'; default: return 'p-[1.25rem]'; } }, [activeTab]);
            const getScrollClass = () => { if (activeTab === 'learn') { if (layoutMode === 'video') return 'lg:overflow-hidden'; if (layoutMode === 'split') return 'lg:overflow-hidden'; } return ''; };
            useEffect(() => { const handleResize = () => { if (window.innerWidth < 1024) setIsSidebarCollapsed(true); else setIsSidebarCollapsed(false); }; window.addEventListener('resize', handleResize); handleResize(); return () => window.removeEventListener('resize', handleResize); }, []);
            const toggleSidebar = () => setIsSidebarCollapsed(!isSidebarCollapsed);

            const renderLearnHeaderContent = () => {
                 const modes = [ { id: 'split', labelKorDesktop: '동영상 & 스크립트', labelKorMobile: '동영상 & 스크립트', labelEng: 'Video & Transcript' }, { id: 'video', labelKorDesktop: '동영상만 보기', labelKorMobile: '동영상', labelEngDesktop: 'Watch Video', labelEngMobile: 'Video' }, { id: 'script', labelKorDesktop: '스크립트만 보기', labelKorMobile: '스크립트', labelEngDesktop: 'Read Transcript', labelEngMobile: 'Transcript' } ];
                const { player, currentTime, duration, isPlaying } = videoState;
                const formatTime = (seconds) => { if (isNaN(seconds)) return "00:00"; const date = new Date(seconds * 1000); const mm = date.getUTCMinutes(); const ss = date.getUTCSeconds(); return `${mm.toString().padStart(2, '0')}:${ss.toString().padStart(2, '0')}`; };
                const handleSeek = (e) => { const time = parseFloat(e.target.value); if (player) player.seekTo(time, true); setVideoState(prev => ({ ...prev, currentTime: time })); };
                const togglePlay = () => { if (player) { if (isPlaying) player.pauseVideo(); else player.playVideo(); } };
                const rewind2 = () => { if (player) player.seekTo(Math.max(0, currentTime - 1.5), true); };
                const forward2 = () => { if (player) player.seekTo(Math.min(duration, currentTime + 1.5), true); };
                const layoutBtnTextSizeKor = "text-[0.75em] md:text-[0.8125em] lg:text-[0.875em]"; const layoutBtnTextSizeEng = "text-[0.5em] md:text-[0.5625em] lg:text-[0.625em]"; const layoutBtnPadding = "px-[0.5em] py-[0.25em] lg:px-[1em] lg:py-[0.5em]"; const controlBtnHeight = "h-[2em] md:h-[2em] lg:h-[2.25em]"; const controlTextSize = "text-[0.625em] md:text-[0.6875em] lg:text-[0.75em]"; const controlPadding = "px-[0.75em]";

                return (
                    <div className="flex items-center h-full px-[1em] lg:px-[1.5em] border-b border-gray-100 bg-white/90 backdrop-blur gap-[1em]">
                        <div className="flex items-center gap-[0.5em] shrink-0">{modes.map((mode, index) => { const isActive = layoutMode === mode.id; const korFontClass = isActive ? "font-cafe24-surround text-green-700" : "font-cafe24 text-slate-500"; const engFontClass = isActive ? "font-bold text-green-500" : "font-medium text-slate-400"; const containerClass = isActive ? `bg-${themeColor}-50 border border-${themeColor}-100 shadow-sm` : 'bg-transparent border border-transparent hover:bg-gray-50'; return ( <React.Fragment key={mode.id}><button onClick={() => setLayoutMode(mode.id)} className={`flex flex-col items-center justify-center rounded-xl transition-all duration-300 ${layoutBtnPadding} ${containerClass}`}><span className={`leading-tight ${layoutBtnTextSizeKor} ${korFontClass}`}><span className="hidden md:inline">{mode.labelKorDesktop}</span><span className="md:hidden">{mode.labelKorMobile}</span></span><span className={`leading-tight font-nanum-round mt-[0.125em] ${layoutBtnTextSizeEng} ${engFontClass}`}><span className="hidden md:inline">{mode.labelEngDesktop || mode.labelEng}</span><span className="md:hidden">{mode.labelEngMobile || mode.labelEng}</span></span></button>{index < modes.length - 1 && <div className="w-px h-[0.75em] bg-gray-300"></div>}</React.Fragment> ); })}</div>
                        <div className="flex items-center gap-[0.5em] flex-1 justify-end min-w-0">
                            <div className={`hidden sm:flex flex-1 items-center gap-[0.25em] bg-white border border-gray-200 rounded-xl p-[0.25em] shadow-sm min-w-0 transition-all ${controlBtnHeight} ${showVocab ? '' : 'max-w-[25em]'}`}>
                                <div className="hidden md:flex flex-col flex-1 px-[0.5em] justify-center w-full min-w-[3.75em] lg:min-w-[5em]"><input type="range" min="0" max={duration || 100} value={currentTime} onChange={handleSeek} className="w-full h-[0.25em] bg-gray-200 rounded-lg appearance-none cursor-pointer" style={{ '--thumb-color': currentThemeHex }} /><div className="text-[0.5em] font-mono text-center leading-none mt-[0.25em] text-slate-400 font-bold whitespace-nowrap">{formatTime(currentTime)} / {formatTime(duration)}</div></div>
                                <button onClick={rewind2} className="p-[0.25em] hover:bg-gray-100 rounded-lg text-slate-600 transition-colors shrink-0" title="-1.5s"><RewindIcon className="w-[1em] h-[1em]" /></button><button onClick={togglePlay} className={`w-[1.25em] h-[1.25em] lg:w-[1.5em] lg:h-[1.5em] flex items-center justify-center rounded-xl transition-all duration-200 hover:scale-110 bg-${themeColor}-400 text-white shadow-md shrink-0`} title={isPlaying ? "Pause" : "Play"}>{isPlaying ? <PauseIcon className="w-[1em] h-[1em] lg:w-[1.25em] lg:h-[1.25em] fill-current" /> : <PlayIconSolid className="w-[1em] h-[1em] lg:w-[1.25em] lg:h-[1.25em] fill-current" />}</button><button onClick={forward2} className="p-[0.25em] hover:bg-gray-100 rounded-lg text-slate-600 transition-colors shrink-0" title="+1.5s"><ForwardIcon className="w-[1em] h-[1em]" /></button>
                            </div>
                            <div className="w-px h-[0.75em] bg-gray-300 shrink-0 hidden sm:block"></div>
                            <div className="relative shrink-0 hidden sm:block"><button onClick={() => setIsSpeedMenuOpen(!isSpeedMenuOpen)} className={`flex items-center gap-[0.5em] ${controlPadding} ${controlBtnHeight} rounded-xl border border-gray-200 bg-white hover:bg-gray-50 transition-all shadow-sm text-slate-600`}><SpeedSolidIcon className="w-[1em] h-[1em] text-slate-400" /><span className={`${controlTextSize} font-bold font-nanum-round min-w-[2em] text-center`}>{playbackRate.toFixed(2)}x</span></button>{isSpeedMenuOpen && (<><div className="fixed inset-0 z-40" onClick={() => setIsSpeedMenuOpen(false)}></div><div className="absolute top-full right-0 mt-[0.5em] bg-white border border-gray-100 rounded-xl shadow-xl p-[0.375em] z-50 w-[6em] flex flex-col gap-[0.125em] animate-fade-in">{[0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0].map(speed => (<button key={speed} onClick={() => { setPlaybackRate(speed); setIsSpeedMenuOpen(false); }} className={`text-center px-[0.5em] py-[0.375em] rounded-lg text-[0.625em] font-bold font-nanum-round transition-colors ${playbackRate === speed ? `bg-${themeColor}-50 text-${themeColor}-600` : 'text-slate-500 hover:bg-gray-50 hover:text-slate-700'}`}>{speed.toFixed(2)}x</button>))}</div></>)}</div>
                            <div className="w-px h-[0.75em] bg-gray-300 shrink-0 hidden sm:block"></div>
                            <button onClick={() => setAutoScroll(!autoScroll)} className={`hidden min-[400px]:flex items-center gap-[0.5em] ${controlPadding} ${controlBtnHeight} rounded-xl border border-gray-200 bg-white hover:bg-gray-50 transition-all shadow-sm text-slate-600 shrink-0`}><div className={`relative transition-colors duration-200 ease-in-out ${autoScroll ? `bg-${themeColor}-400` : 'bg-gray-300'} w-[1.5em] h-[0.5em] md:w-[1.75em] md:h-[0.75em] lg:w-[2em] lg:h-[1em] rounded-full`}><div className={`absolute top-[0.125em] bg-white rounded-full shadow-sm transition-transform duration-200 left-[0.125em] w-[0.25em] h-[0.25em] md:w-[0.5em] md:h-[0.5em] lg:w-[0.75em] lg:h-[0.75em] ${autoScroll ? 'translate-x-[1em]' : 'translate-x-0'}`}></div></div><span className={`${controlTextSize} font-bold font-nanum-round`}>Auto Scroll</span></button>
                            <div className="w-px h-[0.75em] bg-gray-300 hidden xl:block shrink-0"></div>
                            <button onClick={() => setShowVocab(!showVocab)} className={`hidden xl:flex items-center gap-[0.5em] ${controlPadding} ${controlBtnHeight} rounded-xl border transition-all shadow-sm shrink-0 ${showVocab ? `bg-${themeColor}-50 border-${themeColor}-200 text-${themeColor}-700` : 'bg-white border-gray-200 text-slate-600 hover:bg-gray-50'}`}><OpenBookSolidIcon className="w-[1em] h-[1em]" /><span className={`${controlTextSize} font-bold font-nanum-round hidden sm:inline`}>Vocabulary</span></button>
                        </div>
                    </div>
                );
            };

            const renderHomeHeaderContent = () => {
                return (
                    <div className="flex lg:hidden items-center gap-[0.75em] px-[1em] h-full border-b border-gray-100 bg-white/90 backdrop-blur"><img src="https://raw.githubusercontent.com/openkoreanlearninglab/hub/refs/heads/main/OpenKoreanLearningLab_Logo.jpeg" alt="Logo" className="w-[3em] h-[3em] rounded-2xl shadow-lg object-cover transition-all duration-300"/><div className="flex flex-col justify-center animate-fade-in"><span className="font-cafe24-deco text-[1.25em] text-black leading-tight">Open</span><span className={`font-mustache text-[0.6875em] leading-tight text-${themeColor}-600 font-bold`}>KoreanLearningLab</span></div></div>
                );
            };

            const renderContent = () => {
                switch(activeTab) {
                    case 'home': return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                    case 'learn': return <LearnView updateProgress={updateProgress} themeColor={themeColor} autoScroll={autoScroll} showVocab={showVocab} playbackRate={playbackRate} layoutMode={layoutMode} onPlayerReady={handlePlayerReady} onPlayerStateChange={handlePlayerStateChange} onTimeUpdate={handleTimeUpdate} />;
                    case 'vocab': return <VocabView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'quiz': return <QuizView updateProgress={updateProgress} themeColor={themeColor} />;
                    case 'discuss': return <DiscussView updateProgress={updateProgress} themeColor={themeColor} />;
                    default: return <HomeView setActiveTab={setActiveTab} progress={progress} userLevel={userLevel} themeColor={themeColor} />;
                }
            };

            // Dynamic width class based on collapsed state and font sizes
            // Since we use inline styles for widths, we adjust the margins here using styles as well or keep using a class if it matches
            // We'll use inline styles for the main content margin to match sidebar width
            const sidebarWidth = isSidebarCollapsed ? '5.5rem' : '18.4rem';
            const headerFontSize = activeTab === 'learn' ? '1rem' : '1.3rem';

            return (
                <div className="flex min-h-screen bg-[#f9fafb]">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} isCollapsed={isSidebarCollapsed} toggleSidebar={toggleSidebar} userLevel={userLevel} themeColor={themeColor} />
                    <div 
                        className="flex-1 flex flex-col transition-all duration-300 ease-in-out"
                        style={{ marginLeft: window.innerWidth >= 1024 ? sidebarWidth : 0 }}
                    >
                        <header 
                            className={`bg-white transition-all duration-300 z-40 ${activeTab === 'learn' && layoutMode === 'script' ? 'sticky top-0' : 'relative lg:sticky lg:top-0'}`}
                            style={{ height: '4rem', fontSize: headerFontSize }}
                        >
                            {activeTab === 'learn' ? renderLearnHeaderContent() : (activeTab === 'home' ? renderHomeHeaderContent() : null)}
                        </header>
                        <main className={`flex-1 ${mainPaddingClass} flex flex-col ${getScrollClass()}`}>{renderContent()}</main>
                    </div>
                    <nav className="lg:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-[0.75rem] z-50">{['home','learn','vocab','quiz','discuss'].map(t=><button key={t} onClick={()=>setActiveTab(t)} className={`p-[0.5rem] rounded-lg ${activeTab===t ? `text-${themeColor}-600 bg-${themeColor}-50` : 'text-slate-400'}`}>{t==='home'?<HomeIcon className="w-[1.5rem] h-[1.5rem]"/>:t==='learn'?<LearnIcon className="w-[1.5rem] h-[1.5rem]"/>:t==='vocab'?<VocabIcon className="w-[1.5rem] h-[1.5rem]"/>:t==='quiz'?<QuizIcon className="w-[1.5rem] h-[1.5rem]"/>:<DiscussIcon className="w-[1.5rem] h-[1.5rem]"/>}</button>)}</nav>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
